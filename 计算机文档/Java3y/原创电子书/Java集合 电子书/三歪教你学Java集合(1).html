<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>三歪教你学Java集合</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.701961); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; background-position: initial initial; background-repeat: initial initial; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); background-position: initial initial; background-repeat: initial initial; }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-mac'><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n3"><a class="md-toc-inner" href="#前言">前言</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n29"><a class="md-toc-inner" href="#一学习指南">一、学习指南</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n30"><a class="md-toc-inner" href="#一java集合学习指南">一、Java集合学习指南</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n34"><a class="md-toc-inner" href="#11学习一项技术之前必须知道为什么要学它">1.1学习一项技术之前，必须知道为什么要学它！</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n42"><a class="md-toc-inner" href="#12如何入门学习java集合">1.2如何入门学习Java集合</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n64"><a class="md-toc-inner" href="#13-集合进阶与面试">1.3 集合进阶与面试</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n96"><a class="md-toc-inner" href="#二collection">二、Collection</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n98"><a class="md-toc-inner" href="#一集合collection介绍">一、集合(Collection)介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n99"><a class="md-toc-inner" href="#11为什么需要collection">1.1为什么需要Collection</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n112"><a class="md-toc-inner" href="#12数组和集合的区别">1.2数组和集合的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n137"><a class="md-toc-inner" href="#13collection的由来与功能">1.3Collection的由来与功能</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n161"><a class="md-toc-inner" href="#二迭代器iterator介绍">二、迭代器(Iterator)介绍</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n184"><a class="md-toc-inner" href="#三list集合介绍">三、List集合介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n196"><a class="md-toc-inner" href="#31list集合常用子类">3.1List集合常用子类</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n215"><a class="md-toc-inner" href="#四set集合介绍">四、Set集合介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n222"><a class="md-toc-inner" href="#41set集合常用子类">4.1Set集合常用子类</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n244"><a class="md-toc-inner" href="#三list集合">三、List集合</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n267"><a class="md-toc-inner" href="#一arraylist解析">一、ArrayList解析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n273"><a class="md-toc-inner" href="#11构造方法">1.1构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n276"><a class="md-toc-inner" href="#12add方法">1.2Add方法</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n280"><a class="md-toc-inner" href="#121adde-e">1.2.1add(E e)</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n317"><a class="md-toc-inner" href="#122addint-index-e-element">1.2.2add(int index, E element)</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n332"><a class="md-toc-inner" href="#13-get方法">1.3 get方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n342"><a class="md-toc-inner" href="#14-set方法">1.4 set方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n352"><a class="md-toc-inner" href="#15remove方法">1.5remove方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n365"><a class="md-toc-inner" href="#16细节再说明">1.6细节再说明</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n381"><a class="md-toc-inner" href="#二vector与arraylist区别">二、Vector与ArrayList区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n397"><a class="md-toc-inner" href="#三linkedlist解析">三、LinkedList解析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n406"><a class="md-toc-inner" href="#31构造方法">3.1构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n409"><a class="md-toc-inner" href="#32add方法">3.2add方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n416"><a class="md-toc-inner" href="#33remove方法">3.3remove方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n421"><a class="md-toc-inner" href="#34get方法">3.4get方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n426"><a class="md-toc-inner" href="#35set方法">3.5set方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n432"><a class="md-toc-inner" href="#四list集合总结">四、List集合总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n469"><a class="md-toc-inner" href="#四map集合">四、Map集合</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n471"><a class="md-toc-inner" href="#一map介绍">一、Map介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n473"><a class="md-toc-inner" href="#11为什么需要map">1.1为什么需要Map</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n483"><a class="md-toc-inner" href="#12map与collection的区别">1.2Map与Collection的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n485"><a class="md-toc-inner" href="#13map的功能">1.3Map的功能</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n492"><a class="md-toc-inner" href="#二散列表介绍">二、散列表介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n508"><a class="md-toc-inner" href="#21散列表工作原理">2.1散列表工作原理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n530"><a class="md-toc-inner" href="#三红黑树介绍">三、红黑树介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n537"><a class="md-toc-inner" href="#31回顾二叉查找树">3.1回顾二叉查找树</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n546"><a class="md-toc-inner" href="#32知新2-3树">3.2知新2-3树</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n560"><a class="md-toc-inner" href="#33从2-3树到红黑树">3.3从2-3树到红黑树</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n574"><a class="md-toc-inner" href="#34红黑树基础知识">3.4红黑树基础知识</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n602"><a class="md-toc-inner" href="#五hashmap">五、HashMap</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n603"><a class="md-toc-inner" href="#一hashmap剖析">一、HashMap剖析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n626"><a class="md-toc-inner" href="#11hashmap构造方法">1.1HashMap构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n642"><a class="md-toc-inner" href="#12put方法">1.2put方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n659"><a class="md-toc-inner" href="#13get方法">1.3get方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n664"><a class="md-toc-inner" href="#14remove方法">1.4remove方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n669"><a class="md-toc-inner" href="#二hashmap与hashtable对比">二、HashMap与Hashtable对比</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n674"><a class="md-toc-inner" href="#三hashmap总结">三、HashMap总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n697"><a class="md-toc-inner" href="#六linkedhashmap">六、LinkedHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n698"><a class="md-toc-inner" href="#一linkedhashmap">一、LinkedHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n721"><a class="md-toc-inner" href="#11linkedhashmap的域">1.1LinkedHashMap的域</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n723"><a class="md-toc-inner" href="#12linkedhashmap重写的方法">1.2LinkedHashMap重写的方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n731"><a class="md-toc-inner" href="#13构造方法">1.3构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n737"><a class="md-toc-inner" href="#14put方法">1.4put方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n744"><a class="md-toc-inner" href="#15get方法">1.5get方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n776"><a class="md-toc-inner" href="#16remove方法">1.6remove方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n781"><a class="md-toc-inner" href="#17遍历的方法">1.7遍历的方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n788"><a class="md-toc-inner" href="#二linkedhashmap总结">二、LinkedHashMap总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n807"><a class="md-toc-inner" href="#七treemap">七、TreeMap</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n809"><a class="md-toc-inner" href="#一treemap剖析">一、TreeMap剖析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n827"><a class="md-toc-inner" href="#11treemap的域">1.1TreeMap的域</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n830"><a class="md-toc-inner" href="#12treemap构造方法">1.2TreeMap构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n841"><a class="md-toc-inner" href="#13put方法">1.3put方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n848"><a class="md-toc-inner" href="#14get方法">1.4get方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n855"><a class="md-toc-inner" href="#15remove方法-n855">1.5remove方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n860"><a class="md-toc-inner" href="#16遍历方法">1.6遍历方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n879"><a class="md-toc-inner" href="#二treemap总结">二、TreeMap总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1429"><a class="md-toc-inner" href="#八concurrenthashmap">八、ConcurrentHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1431"><a class="md-toc-inner" href="#一concurrenthashmap剖析">一、ConCurrentHashMap剖析</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1436"><a class="md-toc-inner" href="#11初识concurrenthashmap">1.1初识ConCurrentHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1452"><a class="md-toc-inner" href="#12jdk17底层实现">1.2JDK1.7底层实现</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1460"><a class="md-toc-inner" href="#13有了hashtable为啥需要concurrenthashmap">1.3有了Hashtable为啥需要ConCurrentHashMap</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1466"><a class="md-toc-inner" href="#14cas算法和volatile简单介绍">1.4CAS算法和volatile简单介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1498"><a class="md-toc-inner" href="#15concurrenthashmap域">1.5ConCurrentHashMap域</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1504"><a class="md-toc-inner" href="#16concurrenthashmap构造方法">1.6ConCurrentHashMap构造方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1515"><a class="md-toc-inner" href="#17put方法">1.7put方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1522"><a class="md-toc-inner" href="#18get方法">1.8get方法</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1527"><a class="md-toc-inner" href="#二concurrenthashmap总结">二、ConcurrentHashMap总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1428"><a class="md-toc-inner" href="#九set">九、Set</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n906"><a class="md-toc-inner" href="#一hashset剖析">一、HashSet剖析</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n938"><a class="md-toc-inner" href="#二treeset剖析">二、TreeSet剖析</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n955"><a class="md-toc-inner" href="#三linkedhashset剖析">三、LinkedHashSet剖析</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n974"><a class="md-toc-inner" href="#四set集合总结">四、Set集合总结</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n993"><a class="md-toc-inner" href="#十copyonwritearraylist">十、CopyOnWriteArrayList</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1028"><a class="md-toc-inner" href="#一vector和synchronizedlist">一、Vector和SynchronizedList</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1030"><a class="md-toc-inner" href="#11回顾线程安全的vector和synchronizedlist">1.1回顾线程安全的Vector和SynchronizedList</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1035"><a class="md-toc-inner" href="#12vector和synchronizedlist可能会出现的问题">1.2Vector和SynchronizedList可能会出现的问题</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1091"><a class="md-toc-inner" href="#二copyonwritearraylistset介绍">二、CopyOnWriteArrayList(Set)介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1104"><a class="md-toc-inner" href="#21copyonwritearraylist实现原理">2.1CopyOnWriteArrayList实现原理</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1124"><a class="md-toc-inner" href="#211看一下copyonwritearraylist基本的结构">2.1.1看一下CopyOnWriteArrayList基本的结构</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1128"><a class="md-toc-inner" href="#212常见方法的实现">2.1.2常见方法的实现</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1148"><a class="md-toc-inner" href="#213剖析为什么遍历时不用调用者显式加锁">2.1.3剖析为什么遍历时不用调用者显式加锁</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1153"><a class="md-toc-inner" href="#214copyonwritearraylist缺点">2.1.4CopyOnWriteArrayList缺点</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n1167"><a class="md-toc-inner" href="#215copyonwriteset">2.1.5CopyOnWriteSet</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1173"><a class="md-toc-inner" href="#十一java集合面试题">十一、Java集合面试题</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1217"><a class="md-toc-inner" href="#一arraylist和vector的区别">一、ArrayList和Vector的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1238"><a class="md-toc-inner" href="#二hashmap和hashtable的区别">二、HashMap和Hashtable的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1277"><a class="md-toc-inner" href="#三list和map的区别">三、List和Map的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1306"><a class="md-toc-inner" href="#四set里的元素是不能重复的那么用什么方法来区分重复与否呢-是用还是equals">四、Set里的元素是不能重复的，那么用什么方法来区分重复与否呢? 是用==还是equals()?</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1312"><a class="md-toc-inner" href="#五collection和collections的区别">五、Collection和Collections的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1319"><a class="md-toc-inner" href="#六说出arraylistlinkedlist的存储性能和特性">六、说出ArrayList,LinkedList的存储性能和特性</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1327"><a class="md-toc-inner" href="#61扩展">6.1扩展：</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1339"><a class="md-toc-inner" href="#七enumeration和iterator接口的区别">七、Enumeration和Iterator接口的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1356"><a class="md-toc-inner" href="#八listiterator有什么特点">八、ListIterator有什么特点</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1365"><a class="md-toc-inner" href="#九并发集合类是什么">九、并发集合类是什么？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1380"><a class="md-toc-inner" href="#十java中hashmap的key值要是为类对象则该类需要满足什么条件">十、Java中HashMap的key值要是为类对象则该类需要满足什么条件？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1392"><a class="md-toc-inner" href="#十一与java集合框架相关的有哪些最好的实践">十一、与Java集合框架相关的有哪些最好的实践</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1421"><a class="md-toc-inner" href="#十二arraylist集合加入1万条数据应该怎么提高效率">十二、ArrayList集合加入1万条数据，应该怎么提高效率</a></span></p></div><p>&nbsp;</p><h1><a name="前言" class="md-header-anchor"></a><span>前言</span></h1><p><span>这个文档的内容</span><strong><span>纯手打</span></strong><span>，如果想要看更多的干货文章，关注我的公众号：</span><strong><span>Java3y</span></strong><span>。有更多的原创技术文章和干货！</span></p><p>&nbsp;</p><p><span>目前疯狂处于</span><strong><span>疯狂</span></strong><span>更新PDF中，只要是Java后端的知识，都会有！</span><strong><span>欢迎来我公众号催更！</span></strong><span>微信搜索：</span><strong><span>Java3y</span></strong></p><p>&nbsp;</p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！公众号有我的</span><strong><span>联系方式</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><ul><li><span>🔥</span><strong><span>Java精美脑图</span></strong></li><li><span>🔥</span><strong><span>Java学习路线</span></strong></li><li><span>🔥</span><strong><span>开发常用工具</span></strong></li><li><span>🔥</span><strong><span>精美电子书、文档</span></strong></li></ul><p><span>在公众号下回复「</span><strong><span>888</span></strong><span>」即可获取！！</span></p><p>&nbsp;</p><p><strong><span>学习不能盲目，跟着我，会让你事半功倍</span></strong></p><p>&nbsp;</p><p><strong><span>文档允许随意传播，但不能修改任何内容。</span></strong></p><p>&nbsp;</p><p><span>电子书的整理也是挺不容易，如果你觉得有帮助，想要打赏作者，那么可以通过这个收款码打赏我，</span><strong><span>金额不重要，心意最重要</span></strong><span>。主要是我可以通过这个打赏情况来预计大家对这本电子书的评价，嘻嘻</span></p><p>&nbsp;</p><p><img src='https://tva1.sinaimg.cn/large/00831rSTly1gcuu0j4wwqj30u014qako.jpg' width=200px height=200px /><img src='https://tva1.sinaimg.cn/large/00831rSTly1gcuuckh3s4j30rc0yo7jr.jpg' width=200px height=200px /></p><p>&nbsp;</p><h1><a name="一学习指南" class="md-header-anchor"></a><span>一、学习指南</span></h1><h2><a name="一java集合学习指南" class="md-header-anchor"></a><span>一、Java集合学习指南</span></h2><blockquote><p><span>本文会提出很多可能新手会想到的问题，但不会一一解答，只会往大方向去说明白。本文的内容偏向于</span><strong><span>指南</span></strong><span>，而非技术教程讲解。</span></p><p><span>如果想要得到具体的答案，可以翻阅我曾经写过的资料：</span><a href='https://github.com/ZhongFuCheng3y/3y'><span>https://github.com/ZhongFuCheng3y/3y</span></a><span>，或者加入</span><strong><span>人才交流群</span></strong><span>跟众多开发者讨论，前面的</span><strong><span>Github</span></strong><span>链接有我的联系方式。</span></p></blockquote><h3><a name="11学习一项技术之前必须知道为什么要学它" class="md-header-anchor"></a><span>1.1学习一项技术之前，必须知道为什么要学它！</span></h3><p><strong><span>Q:</span></strong><span> 我们得知道为什么要学习Java集合，学到Java集合的时候已经学过了数组了，为什么我不用数组反而用Java集合。数组和Java集合有什么区别？</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ebfaf824c5b1d5?w=686&amp;h=205&amp;f=png&amp;s=20846" referrerpolicy="no-referrer" alt="学习Java集合先需要知道"></p><p>&nbsp;</p><p><strong><span>A:</span></strong><span>Java是一门面向对象的语言，就免不了处理对象，为了方便操作多个对象，那么我们就得把这多个对象存储起来，想要存储多个对象(变量),很容易就能想到一个</span><strong><span>容器</span></strong><span>(集合)来装载</span></p><p>&nbsp;</p><p><span>总的来说：就是Java给我们</span><strong><span>提供了工具方便我们去操作多个Java对象</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ebfb00828f0dca?w=566&amp;h=172&amp;f=png&amp;s=11855" referrerpolicy="no-referrer" alt="方便操作多个对象"></p><h3><a name="12如何入门学习java集合" class="md-header-anchor"></a><span>1.2如何入门学习Java集合</span></h3><p><strong><span>Q:</span></strong><span> 从上面我们已经知道了为什么要学Java集合，下面我们就该知道Java集合的基本用法，以及从它整体的知识点去了解它是什么</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ebfb09d0fc07b3?w=669&amp;h=165&amp;f=png&amp;s=17441" referrerpolicy="no-referrer" alt="入门Java集合"></p><p><strong><span>A：</span></strong><span> 我们学习Java集合实际上就是为了方便操作多个对象，而Java给我们提供一系列的API(方法)供我们去操作。所以在初学Java集合的时候我们更多的是学习这些API(方法)分别是什么意思。</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ebfb167aa66b29?w=693&amp;h=182&amp;f=png&amp;s=13714" referrerpolicy="no-referrer" alt="API的用法以及效果"></p><p><strong><span>Q：</span></strong><span> 对Java集合的API使用有一定的了解之后，我们就应该从</span><strong><span>面向对象</span></strong><span>的角度去理解它。为什么会抽象出多个接口，以及每个接口的有什么特性。</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ec00d00af190c8?w=947&amp;h=362&amp;f=png&amp;s=32666" referrerpolicy="no-referrer" alt="从面向对象的角度去理解接口以及每个接口下的常用类"></p><p><strong><span>A:</span></strong><span> 我们可以总结出几个</span><strong><span>常用的实现类</span></strong><span>，这几个常用的实现类我们必须要知道它的</span><strong><span>数据结构</span></strong><span>是什么，什么时候使用这个类。</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ec0118a51a82fb?w=1167&amp;h=573&amp;f=png&amp;s=57844" referrerpolicy="no-referrer" alt="需要知道每个常用子类的数据结构"></p><p>&nbsp;</p><p><span>需要学习和了解的数据结构：</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/4/16ed114ec29bf0d5?w=644&amp;h=390&amp;f=png&amp;s=29126" referrerpolicy="no-referrer" alt="数据结构"></p><p>&nbsp;</p><p><span>到这里，我们简单了解各个实现类的数据结构以后，我们可能会简单记住下面的</span><strong><span>结论</span></strong><span>：</span></p><ul><li><span>如果是集合类型，有List和Set供我们选择。List的特点是插入有序的，元素是可重复的。Set的特点是插入无序的，元素不可重复的。至于选择哪个实现类来作为我们的存储容器，我们就得看具体的应用场景。是希望可重复的就得用List，选择List下常见的子类。是希望不可重复，选择Set下常见的子类。</span></li><li><span>如果是</span><code>Key-Value</code><span>型，那我们会选择Map。如果要保持插入顺序的，我们可以选择LinkedHashMap，如果不需要则选择HashMap，如果要排序则选择TreeMap。</span></li><li><span>总之：学完</span><strong><span>常见</span></strong><span>实现类的数据结构之后，你对它的使用场景就有一个清楚的认知了。</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ec0181b8ce1cf2?w=1117&amp;h=329&amp;f=png&amp;s=30943" referrerpolicy="no-referrer" alt="选择什么样的容器来存储我们的对象，关键在于了解每个常用集合类的数据结构"></p><h3><a name="13-集合进阶与面试" class="md-header-anchor"></a><span>1.3 集合进阶与面试</span></h3><p><span>如果我们在写代码的时候</span><strong><span>懂得</span></strong><span>选择什么样的集合作为我们的容器，那已经是入门了。但要知道的是，如果去面试之前，你懂的不应该只有这么少。</span></p><p><span>（如果还在</span><strong><span>初学或者零基础</span></strong><span>的同学我建议可以跳过这一部分，在网上有可能很多言论，比如：</span><strong><span>“如果你Java基础扎实的话，那你以后找工作就不愁了。在学Java基础的时候一定要把基础学好，看源码！”</span></strong><span>。但我认为，这一块是建立在有一定的编码/项目或者是去找工作的时候才成立的，</span><strong><span>一个刚入门学Java的，就不应该看源码，这很容易把自己劝退了</span></strong><span>）</span></p><p>&nbsp;</p><p><span>我的观点是：如果刚入门学Java，首先你要十分清楚知道为什么要学这个，这个到底有什么用，用在哪些地方，以及熟悉常用的方法，就足够了。即便你花了两周左右时间去看源码实现了，可能看懂了。但是，你相信我，你</span><strong><span>大概率会忘掉</span></strong><span>。</span></p><p>&nbsp;</p><p><span>Java集合是面试的</span><strong><span>重点</span></strong><span>，我在面试的时候几乎每家公司都会问集合的问题，从基础到源码，一步一步深入。Java集合面试的知识点就不限于基本的用法了。可能面试官会问你：</span></p><ul><li><span>HashMap的数据结构是什么？他是怎么扩容的？底层有没有用红黑树？取Key Hash值是JDK源码是怎么实现的？为什么要这样做？</span></li><li><span>HashMap是线程安全的吗？什么是线程安全？有什么更好的解决方案？那线程安全的HashMap是怎么实现的？</span></li><li><span>HashSet是如何判断Key是重复的？</span></li><li><span>.....很多很多</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ec0ce951bac1af?w=4144&amp;h=1716&amp;f=png&amp;s=659247" referrerpolicy="no-referrer" alt="总结"></p><p><span>总的来说，入门Java集合并不难，归根到底我认为就是三件事：</span></p><ul><li><span>了解为什么要学习Java集合</span></li><li><span>学习Java集合的各个接口以及常用的实现类用法</span></li><li><span>学习常用实现类的数据结构是什么，能在写代码的时候选择一个合适的实现类装载自己的对象。</span></li></ul><p>&nbsp;</p><p><span>零基础入门不需要阅读源码，面试前一定要回顾和阅读源码（这是面试必考的知识点）！</span></p><p><img src="https://user-gold-cdn.xitu.io/2019/12/1/16ec0d2898643dda?w=1013&amp;h=431&amp;f=png&amp;s=45480" referrerpolicy="no-referrer" alt="总结本文"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmr7fsc1j3073073aa5.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h1><a name="二collection" class="md-header-anchor"></a><span>二、Collection</span></h1><p>&nbsp;</p><h2><a name="一集合collection介绍" class="md-header-anchor"></a><span>一、集合(Collection)介绍</span></h2><h3><a name="11为什么需要collection" class="md-header-anchor"></a><span>1.1为什么需要Collection</span></h3><ol start='' ><li><span>Java是一门面向对象的语言，就免不了处理对象</span></li><li><span>为了方便操作多个对象，那么我们就得把这多个对象存储起来</span></li><li><span>想要存储多个对象(变量),很容易就能想到一个</span><strong><span>容器</span></strong></li><li><span>常用的容器我们知道有--&gt;StringBuffered,数组(虽然有对象数组，但是数组的长度是不可变的！)</span></li><li><span>所以，Java就为我们提供了集合(Collection)～</span></li></ol><h3><a name="12数组和集合的区别" class="md-header-anchor"></a><span>1.2数组和集合的区别</span></h3><p><span>接下来，我们可以对数组和集合的区别来分析一下：</span></p><p><span>数组和集合的区别:</span></p><ul><li><p><span>1:长度的区别</span></p><ul><li><strong><span>数组的长度固定</span></strong></li><li><strong><span>集合的长度可变</span></strong></li></ul></li><li><p><span>2:元素的数据类型</span></p><ul><li><span>数组可以存储基本数据类型,也可以存储引用类型</span></li><li><strong><span>集合只能存储引用类型(你存储的是简单的int，它会自动装箱成Integer)</span></strong></li></ul></li></ul><h3><a name="13collection的由来与功能" class="md-header-anchor"></a><span>1.3Collection的由来与功能</span></h3><p><strong><span>Collection的由来：</span></strong></p><ul><li><p><span>集合可以存储多个元素,但我们</span><strong><span>对多个元素也有不同的需求</span></strong></p><ul><li><span>多个元素,不能有相同的</span></li><li><span>多个元素,能够按照某个规则排序</span></li></ul></li><li><p><span>针对不同的需求：java就提供了很多集合类，多个集合类的数据结构不同。但是，结构不重要，重要的是</span><strong><span>能够存储东西,能够判断,获取</span></strong></p></li><li><p><span>把集合</span><strong><span>共性的内容不断往上提取</span></strong><span>,最终形成集合的继承体系----&gt;Collection</span></p></li></ul><p><span>Collection的大致结构体系是这样的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e1f6a487f2?w=720&amp;h=385&amp;f=jpeg&amp;s=27756" referrerpolicy="no-referrer"></p><p><span>但是，一般我们要掌握的并不需要那么多，只需要掌握一些常用的集合类就行了。下面我</span><strong><span>圈出来的那些</span></strong><span>：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e1f69d1124?w=1328&amp;h=763&amp;f=png&amp;s=100521" referrerpolicy="no-referrer"></p><p><strong><span>再次精减：</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e211b855e9?w=1213&amp;h=556&amp;f=bmp&amp;s=2023894" referrerpolicy="no-referrer"></p><p><span>Collection的基础功能：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e1f73ea209?w=1651&amp;h=827&amp;f=png&amp;s=94001" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e1f75125d8?w=1292&amp;h=578&amp;f=png&amp;s=42527" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="二迭代器iterator介绍" class="md-header-anchor"></a><span>二、迭代器(Iterator)介绍</span></h2><p><span>我们可以发现Collection的源码中继承了Iterable，有iterator()这个方法...</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e1f8ddab70?w=1590&amp;h=312&amp;f=png&amp;s=40117" referrerpolicy="no-referrer"></p><p><span>点进去看了一下，Iterable是一个接口：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e23f10a829?w=1023&amp;h=539&amp;f=png&amp;s=17609" referrerpolicy="no-referrer"></p><p><span>它有iterator()这个方法，返回的是</span><strong><span>Iterator</span></strong></p><p><span>再来看一下，Iterator也是一个接口，它只有三个方法：</span></p><ul><li><span>hasNext()</span></li><li><span>next()</span></li><li><span>remove()</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e24a68a5e0?w=1351&amp;h=775&amp;f=png&amp;s=58200" referrerpolicy="no-referrer"></p><p><span>可是，我们没能找到对应的实现方法，只能往Collection的子类下找找了，于是我们找到了---&gt;ArrayList(该类后面会说)</span></p><p><span>于是，我们在ArrayList下找到了iterator实现的身影：它是在ArrayList以</span><strong><span>内部类的方式实现</span></strong><span>的！并且，从源码可知：</span><strong><span>Iterator实际上就是在遍历集合</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e2671465f5?w=1578&amp;h=791&amp;f=png&amp;s=107948" referrerpolicy="no-referrer"></p><p><span>所以说：我们</span><strong><span>遍历集合(Collection)的元素都可以使用Iterator</span></strong><span>，至于它的具体实现是以内部类的方式实现的！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e4e2686de25a?w=1213&amp;h=556&amp;f=bmp&amp;s=2023894" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnythvd93j307806qglo.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="三list集合介绍" class="md-header-anchor"></a><span>三、List集合介绍</span></h2><p><span>从上面已经可以看到了，Collection主要学习集合的类型两种：</span><strong><span>Set和List</span></strong><span>，这里主要讲解List！</span></p><p><span>我们来看一下List接口的方法，比Collection多了一点点：</span></p><ul><li><span>List集合的</span><strong><span>特点</span></strong><span>就是：</span><strong><span>有序(存储顺序和取出顺序一致),可重复</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e548c08430c7?w=1805&amp;h=594&amp;f=png&amp;s=70406" referrerpolicy="no-referrer"></p><p><span>Collection返回的是Iterator迭代器接口，而List中又有它自己对应的实现--&gt;</span><strong><span>ListIterator接口</span></strong></p><p><span>该接口比普通的Iterator接口多了几个方法：</span>
<img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e548c0cb32c8?w=496&amp;h=269&amp;f=png&amp;s=12715" referrerpolicy="no-referrer"></p><p><span>从方法名就可以知道：</span><strong><span>ListIterator可以往前遍历，添加元素，设置元素</span></strong></p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="31list集合常用子类" class="md-header-anchor"></a><span>3.1List集合常用子类</span></h3><p><span>List集合常用的子类有三个：</span></p><ul><li><p><span>ArrayList</span></p><ul><li><span>底层数据结构是数组。线程不安全</span></li></ul></li><li><p><span>LinkedList</span></p><ul><li><span>底层数据结构是链表。线程不安全</span></li></ul></li><li><p><span>Vector</span></p><ul><li><span>底层数据结构是数组。线程安全</span></li></ul></li></ul><p><strong><span>现在知道有三个常用的集合类即可，后面会开新的文章来讲解的</span></strong><span>～</span></p><h2><a name="四set集合介绍" class="md-header-anchor"></a><span>四、Set集合介绍</span></h2><p><span>从Set集合的方法我们可以看到：方法没有比Collection要多</span></p><ul><li><span>Set集合的特点是：</span><strong><span>元素不可重复</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/4/1628e5a1c8f7f9d9?w=1839&amp;h=683&amp;f=png&amp;s=96178" referrerpolicy="no-referrer"></p><h3><a name="41set集合常用子类" class="md-header-anchor"></a><span>4.1Set集合常用子类</span></h3><ul><li><p><span>HashSet集合</span></p><ul><li><span>A:底层数据结构是哈希表(是一个元素为链表的数组) </span></li></ul></li><li><p><span>TreeSet集合</span></p><ul><li><span>A:底层数据结构是红黑树(是一个自平衡的二叉树)</span></li><li><span>B:保证元素的排序方式</span></li></ul></li><li><p><span>LinkedHashSet集合       </span></p><ul><li><span>A:：底层数据结构由哈希表和链表组成。</span></li></ul></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnywo71jrg308c08caa4.gif" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="三list集合" class="md-header-anchor"></a><span>三、List集合</span></h1><p><span>现在这篇主要讲List集合的三个子类：</span></p><ul><li><p><span>ArrayList</span></p><ul><li><span>底层数据结构是数组。线程不安全</span></li></ul></li><li><p><span>LinkedList</span></p><ul><li><span>底层数据结构是链表。线程不安全</span></li></ul></li><li><p><span>Vector</span></p><ul><li><span>底层数据结构是数组。线程安全</span></li></ul></li></ul><p><span>这篇主要来看看它们比较重要的方法是如何实现的，需要注意些什么，最后比较一下哪个时候用哪个～</span></p><p>&nbsp;</p><p>&nbsp;</p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ff8aa0d652?w=1213&amp;h=556&amp;f=bmp&amp;s=2023894" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ff8fdf1b62?w=1213&amp;h=556&amp;f=bmp&amp;s=2023894" referrerpolicy="no-referrer"></p><h2><a name="一arraylist解析" class="md-header-anchor"></a><span>一、ArrayList解析</span></h2><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ff9010e432?w=987&amp;h=527&amp;f=png&amp;s=19181" referrerpolicy="no-referrer"></p><p><span>首先，我们来讲解的是ArrayList集合，它是我们用得非常非常多的一个集合~</span></p><p><span>首先，我们来看一下ArrayList的属性：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac14c83dd9?w=1323&amp;h=748&amp;f=png&amp;s=65575" referrerpolicy="no-referrer"></p><p><span>根据上面我们可以清晰的发现：</span><strong><span>ArrayList底层其实就是一个数组</span></strong><span>，ArrayList中有</span><strong><span>扩容</span></strong><span>这么一个概念，正因为它扩容，所以它能够</span><strong><span>实现“动态”增长</span></strong></p><h3><a name="11构造方法" class="md-header-anchor"></a><span>1.1构造方法</span></h3><p><span>我们来看看构造方法来印证我们上面说得对不对：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ff903d247c?w=874&amp;h=717&amp;f=png&amp;s=49435" referrerpolicy="no-referrer"></p><h3><a name="12add方法" class="md-header-anchor"></a><span>1.2Add方法</span></h3><p><span>add方法可以说是ArrayList比较重要的方法了，我们来总览一下：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a4842e35deb9b?w=957&amp;h=642&amp;f=png&amp;s=41396" referrerpolicy="no-referrer"></p><h4><a name="121adde-e" class="md-header-anchor"></a><span>1.2.1add(E e)</span></h4><p><span>步骤：</span></p><ul><li><strong><span>检查是否需要扩容</span></strong></li><li><strong><span>插入元素</span></strong></li></ul><p><span>首先，我们来看看这个方法：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">boolean</span> <span class="cm-def">add</span>(<span class="cm-variable">E</span> <span class="cm-variable">e</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ensureCapacityInternal</span>(<span class="cm-variable">size</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>); &nbsp;<span class="cm-comment">// Increments modCount!!</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">elementData</span>[<span class="cm-variable">size</span><span class="cm-operator">++</span>] <span class="cm-operator">=</span> <span class="cm-variable">e</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>该方法很短，我们可以根据方法名就猜到他是干了什么：</span></p><ul><li><strong><span>确认list容量，尝试容量加1，看看有无必要</span></strong></li><li><strong><span>添加元素</span></strong></li></ul><p><span>接下来我们来看看这个小容量(+1)是否满足我们的需求：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ffce5e519d?w=1048&amp;h=237&amp;f=png&amp;s=16138" referrerpolicy="no-referrer"></p><p><span>随后调用</span><code>ensureExplicitCapacity()</code><span>来确定明确的容量，我们也来看看这个方法是怎么实现的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47ffdfdce509?w=1111&amp;h=260&amp;f=png&amp;s=22235" referrerpolicy="no-referrer"></p><p><span>所以，接下来看看</span><code>grow()</code><span>是怎么实现的~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fff99d4ae1?w=1235&amp;h=793&amp;f=png&amp;s=64651" referrerpolicy="no-referrer"></p><p><span>进去看</span><code>copyOf()</code><span>方法：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a48001c426601?w=1260&amp;h=290&amp;f=png&amp;s=18128" referrerpolicy="no-referrer"></p><p><span>到目前为止，我们就可以知道</span><code>add(E e)</code><span>的基本实现了：</span></p><ul><li><p><span>首先去检查一下数组的容量是否足够</span></p><ul><li><p><span>足够：直接添加</span></p></li><li><p><span>不足够：扩容</span></p><ul><li><strong><span>扩容到原来的1.5倍</span></strong></li><li><span>第一次扩容后，如果容量还是小于minCapacity，就将容量扩充为minCapacity。</span></li></ul></li></ul></li></ul><h4><a name="122addint-index-e-element" class="md-header-anchor"></a><span>1.2.2add(int index, E element)</span></h4><p><span>步骤：</span></p><ul><li><strong><span>检查角标</span></strong></li><li><strong><span>空间检查，如果有需要进行扩容</span></strong></li><li><strong><span>插入元素</span></strong></li></ul><p><span>我们来看看插入的实现：</span>
<img src="https://user-gold-cdn.xitu.io/2018/4/8/162a4800231ba6fe?w=1099&amp;h=499&amp;f=png&amp;s=38920" referrerpolicy="no-referrer"></p><p><span>我们发现，与扩容相关ArrayList的add方法底层其实都是</span><code>arraycopy()</code><span>来实现的</span></p><p><span>看到</span><code>arraycopy()</code><span>，我们可以发现：</span><strong><span>该方法是由C/C++来编写的</span></strong><span>，并不是由Java实现：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a480046336dd0?w=1024&amp;h=126&amp;f=png&amp;s=8667" referrerpolicy="no-referrer"></p><p><span>总的来说：</span><code>arraycopy()</code><span>还是比较可靠高效的一个方法。</span></p><p>&nbsp;</p><h3><a name="13-get方法" class="md-header-anchor"></a><span>1.3 get方法</span></h3><ul><li><strong><span>检查角标</span></strong></li><li><strong><span>返回元素</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a48004fb8e759?w=963&amp;h=337&amp;f=png&amp;s=20381" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 检查角标</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">void</span> <span class="cm-def">rangeCheck</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">index</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">size</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">IndexOutOfBoundsException</span>(<span class="cm-variable">outOfBoundsMsg</span>(<span class="cm-variable">index</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 返回元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">E</span> <span class="cm-def">elementData</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">E</span>) <span class="cm-variable">elementData</span>[<span class="cm-variable">index</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><h3><a name="14-set方法" class="md-header-anchor"></a><span>1.4 set方法</span></h3><p><span>步骤：</span></p><ul><li><strong><span>检查角标</span></strong></li><li><strong><span>替代元素</span></strong></li><li><strong><span>返回旧值</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fd7115715d?w=1013&amp;h=453&amp;f=png&amp;s=38341" referrerpolicy="no-referrer"></p><h3><a name="15remove方法" class="md-header-anchor"></a><span>1.5remove方法</span></h3><p><span>步骤：</span></p><ul><li><strong><span>检查角标</span></strong></li><li><strong><span>删除元素</span></strong></li><li><strong><span>计算出需要移动的个数，并移动</span></strong></li><li><span>设置为null，让Gc回收</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fd72d05022?w=1163&amp;h=638&amp;f=png&amp;s=35905" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="16细节再说明" class="md-header-anchor"></a><span>1.6细节再说明</span></h3><ul><li><span>ArrayList是</span><strong><span>基于动态数组实现的</span></strong><span>，在</span><strong><span>增删时候，需要数组的拷贝复制</span></strong><span>。</span></li><li><strong><span>ArrayList的默认初始化容量是10，每次扩容时候增加原先容量的一半，也就是变为原来的1.5倍</span></strong></li><li><span>删除元素时不会减少容量，</span><strong><span>若希望减少容量则调用trimToSize()</span></strong></li><li><span>它不是线程安全的。它能存放null值。</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fd7372e624?w=1060&amp;h=378&amp;f=png&amp;s=18257" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmr7fsc1j3073073aa5.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h2><a name="二vector与arraylist区别" class="md-header-anchor"></a><span>二、Vector与ArrayList区别</span></h2><p><span>Vector是jdk1.2的类了，比较老旧的一个集合类。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac14ef76d4?w=1264&amp;h=714&amp;f=png&amp;s=55105" referrerpolicy="no-referrer"></p><p><span>Vector底层也是数组，与ArrayList最大的区别就是：</span><strong><span>同步(线程安全)</span></strong></p><p><span>Vector是同步的，我们可以从方法上就可以看得出来~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fd756c6822?w=1768&amp;h=829&amp;f=png&amp;s=116649" referrerpolicy="no-referrer"></p><p><span>在要求非同步的情况下，我们一般都是使用ArrayList来替代Vector的了~</span></p><p><span>如果想要ArrayList实现同步，可以使用Collections的方法：</span><code>List list = Collections.synchronizedList(new ArrayList(...));</code><span>，就可以实现同步了~</span></p><p><span>还有另一个区别：</span></p><ul><li><strong><span>ArrayList在底层数组不够用时在原来的基础上扩展0.5倍，Vector是扩展1倍。</span></strong><span>、</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fd7863dcf9?w=1092&amp;h=292&amp;f=png&amp;s=14770" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fdc940ee72?w=1184&amp;h=378&amp;f=png&amp;s=22956" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="三linkedlist解析" class="md-header-anchor"></a><span>三、LinkedList解析</span></h2><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fdcc0c1095?w=902&amp;h=565&amp;f=png&amp;s=23073" referrerpolicy="no-referrer"></p><p><span>LinkedList底层是</span><strong><span>双向链表</span></strong><span>~如果对于链表不熟悉的同学可先看看我的</span><strong><span>单向链表</span></strong><span>(双向链表的练习我还没做)【</span><a href='https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247484086&amp;idx=1&amp;sn=24127ceb5e0fed7f832f82579c4fbc19&amp;chksm=ebd743b7dca0caa1dce912d47251548225aa59b4b48742a963ac52b05e13ec923a738ebcb836#rd'><span>Java实现单向链表</span></a><span>】</span></p><p><span>理解了单向链表，双向链表也就不难了。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fdcc30ca90?w=1787&amp;h=688&amp;f=png&amp;s=81323" referrerpolicy="no-referrer"></p><p><span>从结构上，我们还看到了</span><strong><span>LinkedList实现了Deque接口</span></strong><span>，因此，我们可以</span><strong><span>操作LinkedList像操作队列和栈一样</span></strong><span>~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a47fde94ebaec?w=580&amp;h=842&amp;f=png&amp;s=53096" referrerpolicy="no-referrer"></p><p><span>LinkedList变量就这么几个，因为我们操作单向链表的时候也发现了：有了头结点，其他的数据我们都可以获取得到了。(双向链表也同理)</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac1501d206?w=942&amp;h=458&amp;f=png&amp;s=15282" referrerpolicy="no-referrer"></p><h3><a name="31构造方法" class="md-header-anchor"></a><span>3.1构造方法</span></h3><p><span>LinkedList的构造方法有两个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac154b3d14?w=980&amp;h=431&amp;f=png&amp;s=17664" referrerpolicy="no-referrer"></p><h3><a name="32add方法" class="md-header-anchor"></a><span>3.2add方法</span></h3><p><span>如果做过链表的练习，对于下面的代码并不陌生的~</span></p><ul><li><strong><span>add方法实际上就是往链表最后添加元素</span></strong></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">boolean</span> <span class="cm-def">add</span>(<span class="cm-variable">E</span> <span class="cm-variable">e</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">linkLast</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-def">linkLast</span>(<span class="cm-variable">E</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Node</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span> <span class="cm-variable">l</span> <span class="cm-operator">=</span> <span class="cm-variable">last</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">Node</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span> <span class="cm-variable">newNode</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Node</span><span class="cm-operator">&lt;&gt;</span>(<span class="cm-variable">l</span>, <span class="cm-variable">e</span>, <span class="cm-atom">null</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">last</span> <span class="cm-operator">=</span> <span class="cm-variable">newNode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">l</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">first</span> <span class="cm-operator">=</span> <span class="cm-variable">newNode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">l</span>.<span class="cm-variable">next</span> <span class="cm-operator">=</span> <span class="cm-variable">newNode</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">size</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">modCount</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><h3><a name="33remove方法" class="md-header-anchor"></a><span>3.3remove方法</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a4842e381e45f?w=873&amp;h=452&amp;f=png&amp;s=23841" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac157dbcd0?w=494&amp;h=604&amp;f=png&amp;s=14924" referrerpolicy="no-referrer"></p><p><span>实际上就是下面那个图的操作：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49ac1584333b?w=393&amp;h=167&amp;f=jpeg&amp;s=9224" referrerpolicy="no-referrer"></p><h3><a name="34get方法" class="md-header-anchor"></a><span>3.4get方法</span></h3><p><span>可以看到get方法实现就两段代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">E</span> <span class="cm-def">get</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">checkElementIndex</span>(<span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">node</span>(<span class="cm-variable">index</span>).<span class="cm-variable">item</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>我们进去看一下具体的实现是怎么样的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/8/162a49b16091c1fa?w=892&amp;h=581&amp;f=png&amp;s=27674" referrerpolicy="no-referrer"></p><h3><a name="35set方法" class="md-header-anchor"></a><span>3.5set方法</span></h3><p>&nbsp;</p><p><span>set方法和get方法其实差不多，</span><strong><span>根据下标来判断是从头遍历还是从尾遍历</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">E</span> <span class="cm-def">set</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>, <span class="cm-variable">E</span> <span class="cm-variable">element</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">checkElementIndex</span>(<span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Node</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-variable">node</span>(<span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">E</span> <span class="cm-variable">oldVal</span> <span class="cm-operator">=</span> <span class="cm-variable">x</span>.<span class="cm-variable">item</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span>.<span class="cm-variable">item</span> <span class="cm-operator">=</span> <span class="cm-variable">element</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">oldVal</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p>&nbsp;</p><h2><a name="四list集合总结" class="md-header-anchor"></a><span>四、List集合总结</span></h2><p><span>其实集合的源码看起来并不是很困难，遇到问题可以翻一翻，应该是能够看懂的~</span></p><p><span>ArrayList、LinkedList、Vector算是在面试题中比较常见的的知识点了。下面我就来做一个简单的总结：</span></p><p><strong><span>ArrayList：</span></strong></p><ul><li><span>底层实现是数组</span></li><li><span>ArrayList的默认初始化容量是10，每次扩容时候增加原先容量的一半，也就是变为原来的1.5倍</span></li><li><span>在</span><strong><span>增删时候，需要数组的拷贝复制(navite 方法由C/C++实现)</span></strong></li></ul><p><strong><span>LinkedList：</span></strong></p><ul><li><span>底层实现是</span><strong><span>双向链表</span></strong><span>[双向链表方便实现往前遍历]</span></li></ul><p><strong><span>Vector：</span></strong></p><ul><li><p><span>底层是数组，现在已少用，被ArrayList替代，原因有两个：</span></p><ul><li><span>Vector所有方法都是同步，</span><strong><span>有性能损失</span></strong><span>。</span></li><li><span>Vector初始length是10 超过length时 以100%比率增长，</span><strong><span>相比于ArrayList更多消耗内存</span></strong><span>。</span></li></ul></li></ul><p><strong><span>总的来说：查询多用ArrayList，增删多用LinkedList。</span></strong></p><p><strong><span>ArrayList增删慢不是绝对</span></strong><span>的(</span><strong><span>在数量大的情况下，已测试</span></strong><span>)：</span></p><ul><li><span>如果增加元素一直是使用</span><code>add()</code><span>(增加到末尾)的话，那是ArrayList要快</span></li><li><span>一直</span><strong><span>删除末尾的元素也是ArrayList要快</span></strong><span>【不用复制移动位置】</span></li><li><span>至于如果</span><strong><span>删除的是中间的位置的话，还是ArrayList要快</span></strong><span>！</span></li></ul><p><span>但一般来说：</span><strong><span>增删多还是用LinkedList，因为上面的情况是极端的~</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyzin9wzj3073073mx3.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="四map集合" class="md-header-anchor"></a><span>四、Map集合</span></h1><p>&nbsp;</p><h2><a name="一map介绍" class="md-header-anchor"></a><span>一、Map介绍</span></h2><h3><a name="11为什么需要map" class="md-header-anchor"></a><span>1.1为什么需要Map</span></h3><p><span>前面我们学习的Collection叫做集合，它可以快速查找现有的元素。</span></p><p><span>而Map在《Core Java》中称之为--&gt;映射..</span></p><p><span>映射的模型图是这样的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c668c7c9e8?w=739&amp;h=428&amp;f=png&amp;s=9127" referrerpolicy="no-referrer"></p><p><span>那为什么我们需要这种数据存储结构呢？？？举个例子</span></p><ul><li><span>作为学生来说，我们是根据学号来区分不同的学生。</span><strong><span>只要我们知道学号，就可以获取对应的学生信息</span></strong><span>。这就是Map映射的作用！</span></li></ul><p><span>生活中还有很多这样的例子：</span><strong><span>只要你掏出身份证(key)，那就可以证明是你自己(value)</span></strong></p><h3><a name="12map与collection的区别" class="md-header-anchor"></a><span>1.2Map与Collection的区别</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c668df6d01?w=1149&amp;h=360&amp;f=png&amp;s=22949" referrerpolicy="no-referrer"></p><h3><a name="13map的功能" class="md-header-anchor"></a><span>1.3Map的功能</span></h3><p><span>下面我们来看看Map的源码：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c668d59f7e?w=1885&amp;h=841&amp;f=png&amp;s=161462" referrerpolicy="no-referrer"></p><p><span>简单常用的Map功能有这么一些：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4bf8dce30?w=991&amp;h=703&amp;f=png&amp;s=49294" referrerpolicy="no-referrer"></p><p><span>下面用红色框框圈住的就是</span><strong><span>Map值得关注的子类：</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4bf76e0d9?w=1411&amp;h=648&amp;f=png&amp;s=28802" referrerpolicy="no-referrer"></p><h2><a name="二散列表介绍" class="md-header-anchor"></a><span>二、散列表介绍</span></h2><p><span>无论是Set还是Map，我们会发现都会有对应的--&gt;</span><strong><span>Hash</span></strong><span>Set,</span><strong><span>Hash</span></strong><span>Map</span></p><p><span>首先我们也先得</span><strong><span>回顾一下数据和链表</span></strong><span>：</span></p><ul><li><span>链表和数组都可以按照人们的意愿来排列元素的次序，他们可以说是</span><strong><span>有序</span></strong><span>的(存储的顺序和取出的顺序是一致的)</span></li><li><span>但同时，这会带来缺点：</span><strong><span>想要获取某个元素，就要访问所有的元素，直到找到为止。</span></strong></li><li><span>这会让我们消耗很多的时间在里边，遍历访问元素~</span></li></ul><p>&nbsp;</p><p><span>而还有另外的一些存储结构：</span><strong><span>不在意元素的顺序，能够快速的查找元素的数据</span></strong></p><ul><li><span>其中就有一种非常常见的：</span><strong><span>散列表</span></strong></li></ul><h3><a name="21散列表工作原理" class="md-header-anchor"></a><span>2.1散列表工作原理</span></h3><p><span>散列表</span><strong><span>为每个对象计算出一个整数，称为散列码</span></strong><span>。</span><strong><span>根据</span></strong><span>这些计算出来的</span><strong><span>整数(散列码)保存在对应的位置上</span></strong><span>！</span></p><p><span>在Java中，散列表用的是链表数组实现的，</span><strong><span>每个列表称之为桶。</span></strong><span>【之前也写过</span><a href='https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247484071&amp;idx=2&amp;sn=5195363e7a5c5e3e7cac2a733c2695e9&amp;chksm=ebd743a6dca0cab0b79aec38ff835116af9079114c9266ef673c6c1009b32b2abf262bf35e0c#rd'><span>桶排序就这么简单</span></a><span>，可以回顾回顾】</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4bfcecf91?w=2448&amp;h=3264&amp;f=jpeg&amp;s=635016" referrerpolicy="no-referrer"></p><p><span>一个桶上可能会</span><strong><span>遇到被占用的情况(hashCode散列码相同，就存储在同一个位置上)</span></strong><span>，这种情况是无法避免的，这种现象称之为：</span><strong><span>散列冲突</span></strong></p><ul><li><span>此时需要</span><strong><span>用该对象与桶上的对象进行比较，看看该对象是否存在桶子上了</span></strong><span>~如果存在，就不添加了，如果不存在则添加到桶子上</span></li><li><span>当然了，如果hashcode函数设计得足够好，桶的数目也足够，这种比较是很少的~</span></li><li><span>在</span><strong><span>JDK1.8</span></strong><span>中，</span><strong><span>桶满时</span></strong><span>会从</span><strong><span>链表变成平衡二叉树</span></strong></li></ul><p><span>如果散列表太满，</span><strong><span>是需要对散列表再散列，创建一个桶数更多的散列表，并将原有的元素插入到新表中，丢弃原来的表</span></strong><span>~</span></p><ul><li><span>装填因子(load factor)</span><strong><span>决定了何时</span></strong><span>对散列表再散列~</span></li><li><span>装填因子默认为0.75，如果表中</span><strong><span>超过了75%的位置</span></strong><span>已经填入了元素，那么这个表就会用</span><strong><span>双倍的桶数</span></strong><span>自动进行再散列</span></li></ul><p><span>当然了， 在后面阅读源码的时候会继续说明的，现在简单了解一下即可~</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmu1lb2vg306o06ojtg.gif" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="三红黑树介绍" class="md-header-anchor"></a><span>三、红黑树介绍</span></h2><p><span>上面散列表中已经提过了：如果桶数满的时候，JDK8是将</span><strong><span>链表转成红黑树</span></strong><span>的~。并且，我们的TreeSet、TreeMap底层都是红黑树来实现的。</span></p><p><span>所以，在这里学习一波红黑树到底是啥玩意。</span></p><p><span>在未学习之前，我们可能是听过红黑树这么一个数据结构类型的，还有其他什么B/B+树等等，反正是</span><strong><span>比较复杂的数据结构了</span></strong><span>~~~</span></p><p><span>各种常见的树的用途：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4c013be70?w=853&amp;h=403&amp;f=png&amp;s=34703" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="31回顾二叉查找树" class="md-header-anchor"></a><span>3.1回顾二叉查找树</span></h3><p><span>首先我们来回顾一下：利用二叉查找树的特性，我们一般来说可以很快地查找出对应的元素。</span></p><p><span>可是二叉查找树也有</span><strong><span>个例(最坏)</span></strong><span>的情况(线性)：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4bff5dc04?w=406&amp;h=306&amp;f=png&amp;s=20756" referrerpolicy="no-referrer"></p><p><span>上面符合二叉树的特性，但是它是线性的，完全没树的用处~</span></p><p><span>树是要</span><strong><span>“均衡”</span></strong><span>才能将它的优点展示出来的~，比如下面这种：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c4c00eb4d8?w=267&amp;h=216&amp;f=png&amp;s=16913" referrerpolicy="no-referrer"></p><p><span>因此，就有了</span><strong><span>平衡树</span></strong><span>这么一个概念~红黑树就是一种平衡树，它可以</span><strong><span>保证二叉树基本符合矮矮胖胖(均衡)的结构</span></strong></p><h3><a name="32知新2-3树" class="md-header-anchor"></a><span>3.2知新2-3树</span></h3><p><span>讲到了平衡树就不得不说</span><strong><span>最基础</span></strong><span>的2-3树，2-3树</span><strong><span>长的是这个样子：</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c5343df147?w=1136&amp;h=462&amp;f=png&amp;s=69918" referrerpolicy="no-referrer"></p><p><span>在二叉查找树上，我们插入节点的过程是这样的：小于节点值往右继续与左子节点比，大于则继续与右子节点比，直到某节点左或右子节点为空，把值插入进去。</span><strong><span>这样无法避免偏向问题</span></strong></p><p><span>而2-3树不一样：</span><strong><span>它插入的时候可以保持树的平衡</span></strong><span>！</span></p><p><span>在2-3树插入的时可以简单总结为两个操作：</span></p><ul><li><strong><span>合并2-节点为3-节点，扩充将3-节点扩充为一个4-节点</span></strong></li><li><strong><span>分解4-节点为3-节点，节点3-节点为2-节点</span></strong></li><li><span>........</span><strong><span>至使得树平衡</span></strong><span>~</span></li></ul><p><span>合并分解的操作还是</span><strong><span>比较复杂的，要分好几种情况</span></strong><span>，代码量很大~这里我就不介绍了，因为要学起来是一大堆的，很麻烦~</span></p><h3><a name="33从2-3树到红黑树" class="md-header-anchor"></a><span>3.3从2-3树到红黑树</span></h3><p><span>由于2-3树为了保持平衡性，在维护的时候是需要大量的节点交换的！这些变换在实际代码中是很复杂的，大佬们</span><strong><span>在2-3树的理论基础上发明了红黑树</span></strong><span>(2-3-4树也是同样的道理，只是2-3树是最简单的一种情况，所以我就不说2-3-4树了)。</span></p><ul><li><span>红黑树是对2-3查找树的改进，它能用一种</span><strong><span>统一的方式完成所有变换</span></strong><span>。</span></li></ul><p><span>红黑树是一种</span><strong><span>平衡二叉树</span></strong><span>,因此它没有3-节点。那红黑树是怎么将3-节点来改进成全都是二叉树呢？</span></p><p><span>红黑树就字面上的意思，</span><strong><span>有红色的节点，有黑色的节点</span></strong><span>：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c527fa9621?w=842&amp;h=486&amp;f=png&amp;s=245153" referrerpolicy="no-referrer"></p><p><span>我们可以将红色节点的</span><strong><span>左链接</span></strong><span>画平看看：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c5345d5cfb?w=346&amp;h=420&amp;f=png&amp;s=19591" referrerpolicy="no-referrer"></p><p><span>一颗典型的二叉树：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c544a2fa28?w=766&amp;h=472&amp;f=png&amp;s=78824" referrerpolicy="no-referrer"></p><p><strong><span>将红色节点的左链接画平之后：得到2-3平衡树:</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/9/162a98c5802d3394?w=1007&amp;h=341&amp;f=png&amp;s=61333" referrerpolicy="no-referrer"></p><h3><a name="34红黑树基础知识" class="md-header-anchor"></a><span>3.4红黑树基础知识</span></h3><p><span>前面已经说了，红黑树是在2-3的基础上实现的一种树，它能够用统一的方式完成所有变换。很好理解：红黑树也是平衡树的一种，在插入元素的时候它也得保持树的平衡，那红黑树是以什么的方式来保持树的平衡的呢？</span></p><p><span>红黑树用的是也是两种方式来替代2-3树不断的节点交换操作：</span></p><ul><li><strong><span>旋转</span></strong><span>：顺时针旋转和逆时针旋转</span></li><li><strong><span>反色</span></strong><span>：交换红黑的颜色</span></li><li><span>这个两个实现比2-3树交换的节点(合并，分解)要方便一些</span></li></ul><p>&nbsp;</p><p><span>红黑树为了保持平衡，还有制定一些约束，遵守这些约束的才能叫做红黑树：</span></p><ol start='' ><li><span>红黑树是二叉搜索树。</span></li><li><strong><span>根节点是黑色</span></strong><span>。</span></li><li><strong><span>每个叶子节点都是黑色的空节点（NIL节点）</span></strong><span>。</span></li><li><strong><span>每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)</span></strong></li><li><strong><span>从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点(每一条树链上的黑色节点数量（称之为“黑高”）必须相等)</span></strong><span>。</span></li></ol><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyzin9wzj3073073mx3.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h1><a name="五hashmap" class="md-header-anchor"></a><span>五、HashMap</span></h1><h2><a name="一hashmap剖析" class="md-header-anchor"></a><span>一、HashMap剖析</span></h2><p><span>首先看看HashMap的顶部注释说了些什么：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af937c93cdef6?w=1918&amp;h=3204&amp;f=png&amp;s=401056" referrerpolicy="no-referrer"></p><p><span>再来看看HashMap的类继承图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af938010aba80?w=653&amp;h=336&amp;f=png&amp;s=10307" referrerpolicy="no-referrer"></p><p><span>下面我们来看一下HashMap的属性：</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gd1l4umh86j30ya0u0dwv.jpg" referrerpolicy="no-referrer"></p><p><span>成员属性有这么几个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af937fb0ec0da?w=512&amp;h=156&amp;f=png&amp;s=5947" referrerpolicy="no-referrer"></p><p><span>再来看一下hashMap的一个内部类Node：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af9380220c754?w=1076&amp;h=764&amp;f=png&amp;s=41254" referrerpolicy="no-referrer"></p><p><span>我们知道Hash的底层是散列表，而在Java中散列表的实现是通过数组+链表的~</span></p><p><span>再来简单看看put方法就可以印证我们的说法了：</span><strong><span>数组+链表--&gt;散列表</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93802eac5e0?w=820&amp;h=86&amp;f=png&amp;s=5384" referrerpolicy="no-referrer"></p><p><span>我们可以简单总结出HashMap：</span></p><ul><li><strong><span>无序，允许为null，非同步</span></strong></li><li><strong><span>底层由散列表(哈希表)实现</span></strong></li><li><strong><span>初始容量和装载因子对HashMap影响挺大的</span></strong><span>，设置小了不好，设置大了也不好</span></li></ul><h3><a name="11hashmap构造方法" class="md-header-anchor"></a><span>1.1HashMap构造方法</span></h3><p><span>HashMap的构造方法有4个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af95d47ae4286?w=480&amp;h=104&amp;f=png&amp;s=5442" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af95d47933b6c?w=1380&amp;h=581&amp;f=png&amp;s=56374" referrerpolicy="no-referrer"></p><p><span>在上面的构造方法最后一行，我们会发现调用了</span><code>tableSizeFor()</code><span>，我们进去看看：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af95d47aaf53b?w=1147&amp;h=479&amp;f=png&amp;s=20927" referrerpolicy="no-referrer"></p><p><span>看完上面可能会感到奇怪的是：</span><strong><span>为啥是将2的整数幂的数赋给threshold</span></strong><span>？</span></p><ul><li><span>threshold这个成员变量是阈值，决定了是否要将散列表再散列。它的值应该是：</span><code>capacity * load factor</code><span>才对的。</span></li></ul><p><span>其实这里仅仅是一个初始化，当创建哈希表的时候，它会重新赋值的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af938b6338ab4?w=1021&amp;h=150&amp;f=png&amp;s=11210" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>至于别的构造方法都差不多，这里我就不细讲了：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af938b67cf682?w=1164&amp;h=716&amp;f=png&amp;s=38464" referrerpolicy="no-referrer"></p><h3><a name="12put方法" class="md-header-anchor"></a><span>1.2put方法</span></h3><p><span>put方法可以说是HashMap的核心，我们来看看：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af938d92f7922?w=1199&amp;h=193&amp;f=png&amp;s=14926" referrerpolicy="no-referrer"></p><p><span>我们来看看它是怎么计算哈希值的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93916375d72?w=1387&amp;h=579&amp;f=png&amp;s=24464" referrerpolicy="no-referrer"></p><p><span>为什么要这样干呢？？我们一般来说直接将key作为哈希值不就好了吗，做异或运算是干嘛用的？？</span></p><p><span>我们看下来：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93924747fde?w=1076&amp;h=434&amp;f=png&amp;s=26670" referrerpolicy="no-referrer"></p><p><span>我们是根据key的哈希值来保存在散列表中的，我们表默认的初始容量是16，要放到散列表中，就是0-15的位置上。也就是</span><code>tab[i = (n - 1) &amp; hash]</code><span>。可以发现的是：在做</span><code>&amp;</code><span>运算的时候，仅仅是</span><strong><span>后4位有效</span></strong><span>~那如果我们key的哈希值高位变化很大，低位变化很小。直接拿过去做</span><code>&amp;</code><span>运算，这就会导致计算出来的Hash值相同的很多。</span></p><p><span>而设计者</span><strong><span>将key的哈希值的高位也做了运算(与高16位做异或运算，使得在做&amp;运算时，此时的低位实际上是高位与低位的结合)，这就增加了随机性</span></strong><span>，减少了碰撞冲突的可能性！</span></p><p><span>下面我们再来看看流程是怎么样的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93963a2de0e?w=1918&amp;h=1575&amp;f=png&amp;s=191878" referrerpolicy="no-referrer"></p><p><span>新值覆盖旧值，返回旧值测试：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af939656de4be?w=1152&amp;h=438&amp;f=png&amp;s=20739" referrerpolicy="no-referrer"></p><p><span>接下来我们看看</span><code>resize()</code><span>方法，在初始化的时候要调用这个方法，当散列表元素大于</span><code>capacity * load factor</code><span>的时候也是调用</span><code>resize()</code></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af939881bfb80?w=1918&amp;h=2682&amp;f=png&amp;s=245904" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="13get方法" class="md-header-anchor"></a><span>1.3get方法</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af939ca9ea5df?w=1106&amp;h=321&amp;f=png&amp;s=22408" referrerpolicy="no-referrer"></p><p><span>接下来我们看看</span><code>getNode()</code><span>是怎么实现的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af939f6e95dbc?w=1453&amp;h=714&amp;f=png&amp;s=53051" referrerpolicy="no-referrer"></p><h3><a name="14remove方法" class="md-header-anchor"></a><span>1.4remove方法</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93a099814ad?w=1060&amp;h=270&amp;f=png&amp;s=19546" referrerpolicy="no-referrer"></p><p><span>再来看看</span><code>removeNode()</code><span>的实现：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93a0b663581?w=1918&amp;h=1758&amp;f=png&amp;s=179699" referrerpolicy="no-referrer"></p><h2><a name="二hashmap与hashtable对比" class="md-header-anchor"></a><span>二、HashMap与Hashtable对比</span></h2><blockquote><p><span>从存储结构和实现来讲基本上都是相同的。它和HashMap的最大的不同是它是线程安全的，另外它不允许key和value为null。Hashtable是个过时的集合类，不建议在新代码中使用，不需要线程安全的场合可以用HashMap替换，需要线程安全的场合可以用ConcurrentHashMap替换</span></p></blockquote><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af93a329c3635?w=999&amp;h=535&amp;f=png&amp;s=29128" referrerpolicy="no-referrer"></p><h2><a name="三hashmap总结" class="md-header-anchor"></a><span>三、HashMap总结</span></h2><p><span>在JDK8中HashMap的底层是：</span><strong><span>数组+链表(散列表)+红黑树</span></strong></p><p><span>在散列表中有装载因子这么一个属性，当装载因子*初始容量小于散列表元素时，该散列表会再散列，扩容2倍！</span></p><p><span>装载因子的</span><strong><span>默认值是0.75</span></strong><span>，无论是初始大了还是初始小了对我们HashMap的性能都不好</span></p><ul><li><span>装载因子初始值大了，可以减少散列表再散列(扩容的次数)，但同时会导致散列冲突的可能性变大(</span><strong><span>散列冲突也是耗性能的一个操作，要得操作链表(红黑树)</span></strong><span>！</span></li><li><span>装载因子初始值小了，可以减小散列冲突的可能性，但同时扩容的次数可能就会变多！</span></li></ul><p><span>初始容量的</span><strong><span>默认值是16</span></strong><span>，它也一样，无论初始大了还是小了，对我们的HashMap都是有影响的：</span></p><ul><li><span>初始容量过大，那么遍历时我们的速度就会受影响~</span></li><li><span>初始容量过小，散列表再散列(扩容的次数)可能就变得多，扩容也是一件非常耗费性能的一件事~</span></li></ul><p><span>从源码上我们可以发现：HashMap并不是直接拿key的哈希值来用的，它会将key的哈希值的高16位进行异或操作，使得我们将元素放入哈希表的时候</span><strong><span>增加了一定的随机性</span></strong><span>。</span></p><p><span>还要值得注意的是：</span><strong><span>并不是桶子上有8位元素的时候它就能变成红黑树，它得同时满足我们的散列表容量大于64才行的</span></strong><span>~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af95d47d6e490?w=810&amp;h=481&amp;f=png&amp;s=24112" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/10/162af95d47c40565?w=1113&amp;h=607&amp;f=png&amp;s=33442" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyxk0p5kj3073073glh.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="六linkedhashmap" class="md-header-anchor"></a><span>六、LinkedHashMap</span></h1><h2><a name="一linkedhashmap" class="md-header-anchor"></a><span>一、LinkedHashMap</span></h2><p><span>首先我们来看看类继承图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b474575fafe4c?w=944&amp;h=521&amp;f=png&amp;s=18618" referrerpolicy="no-referrer"></p><p><span>我简单翻译了一下顶部的注释(我英文水平渣，如果有错的地方请多多包涵~欢迎在评论区下指正)</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b474575e967e3?w=1918&amp;h=3945&amp;f=png&amp;s=476864" referrerpolicy="no-referrer"></p><p><span>从顶部翻译我们就可以归纳总结出LinkedHashMap几点：</span></p><ul><li><span>底层是散列表和双向链表</span></li><li><span>允许为null，不同步</span></li><li><span>插入的顺序是有序的(底层链表致使有序)</span></li><li><span>装载因子和初始容量对LinkedHashMap影响是很大的~</span></li></ul><p><span>同时也给我带了几个疑问：</span></p><ul><li><span>access-ordered和insertion-ordered具体的使用和意思</span></li><li><span>为什么说初始容量对遍历没有影响？</span></li></ul><p><span>希望可以在看源码的过程中可以解决掉我这两个疑问~~~那接下来就开始吧</span></p><h3><a name="11linkedhashmap的域" class="md-header-anchor"></a><span>1.1LinkedHashMap的域</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47457600a1b8?w=1895&amp;h=752&amp;f=png&amp;s=111297" referrerpolicy="no-referrer"></p><h3><a name="12linkedhashmap重写的方法" class="md-header-anchor"></a><span>1.2LinkedHashMap重写的方法</span></h3><p><span>下面我列举就这两个比较重要的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47457616a684?w=1123&amp;h=408&amp;f=png&amp;s=22461" referrerpolicy="no-referrer"></p><p><span>这就印证了我们的LinkedHashMap</span><strong><span>底层确确实实是散列表和双向链表</span></strong><span>~</span></p><ul><li><span>在构建新节点时，构建的是</span><code>LinkedHashMap.Entry</code><span> 不再是</span><code>Node</code><span>.</span></li></ul><h3><a name="13构造方法" class="md-header-anchor"></a><span>1.3构造方法</span></h3><p><span>可以发现，LinkedHashMap有</span><strong><span>5个构造方法</span></strong><span>：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b474576141755?w=498&amp;h=146&amp;f=png&amp;s=8442" referrerpolicy="no-referrer"></p><p><span>下面我们来看看构造方法的定义是怎么样的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47346bf82692?w=1918&amp;h=2244&amp;f=png&amp;s=212727" referrerpolicy="no-referrer"></p><p><span>从构造方法上我们可以知道的是：</span><strong><span>LinkedHashMap默认使用的是插入顺序</span></strong></p><h3><a name="14put方法" class="md-header-anchor"></a><span>1.4put方法</span></h3><p><span>原本我是想要找put方法，看看是怎么实现的，</span><strong><span>后来没找着，就奇了个怪</span></strong><span>~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47357022f53f?w=550&amp;h=812&amp;f=png&amp;s=55174" referrerpolicy="no-referrer"></p><p><span>再顿了一下，原来LinkedHashMap和HashMap的put方法是一样的！LinkedHashMap继承着HashMap，LinkedHashMap没有重写HashMap的put方法</span></p><p><span>所以，LinkedHashMap的put方法和HashMap是一样的。</span></p><p><span>当然了，</span><strong><span>在创建节点的时候，调用的是LinkedHashMap重写的方法</span></strong><span>~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4735a03c2d83?w=1093&amp;h=788&amp;f=png&amp;s=43822" referrerpolicy="no-referrer"></p><h3><a name="15get方法" class="md-header-anchor"></a><span>1.5get方法</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4736552c3400?w=957&amp;h=268&amp;f=png&amp;s=20080" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b473658809fd8?w=1130&amp;h=664&amp;f=png&amp;s=27257" referrerpolicy="no-referrer"></p><p><span>get方法也是多了：</span><strong><span>判断是否为访问顺序</span></strong><span>~~~</span></p><p><span>讲到了这里，感觉我们可以简单测试一波了：</span></p><p><span>首先我们来看看已</span><strong><span>插入顺序</span></strong><span>来进行插入和遍历：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">insertOrder</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 默认是插入顺序</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span>,<span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> &nbsp;<span class="cm-variable">insertOrder</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedHashMap</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-string">"关注公众号Java3y"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insertOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insertOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insertOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insertOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">insertOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//遍历</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">set</span> <span class="cm-operator">=</span> <span class="cm-variable">insertOrder</span>.<span class="cm-variable">keySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">Integer</span> <span class="cm-variable">s</span> : <span class="cm-variable">set</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">mapValue</span> <span class="cm-operator">=</span> <span class="cm-variable">insertOrder</span>.<span class="cm-variable">get</span>(<span class="cm-variable">s</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">s</span> <span class="cm-operator">+</span> <span class="cm-string">"---"</span> <span class="cm-operator">+</span> <span class="cm-variable">mapValue</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>测试一波：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4736cf833cb2?w=1174&amp;h=684&amp;f=png&amp;s=45180" referrerpolicy="no-referrer"></p><p><span>接着，我们来测试一下以</span><strong><span>访问顺序</span></strong><span>来进行插入和遍历：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">accessOrder</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 设置为访问顺序的方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span>,<span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">accessOrder</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedHashMap</span>(<span class="cm-number">16</span>, <span class="cm-number">0.75f</span>, <span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-string">"关注公众号Java3y"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 遍历</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">sets</span> <span class="cm-operator">=</span> <span class="cm-variable">accessOrder</span>.<span class="cm-variable">keySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">Integer</span> <span class="cm-variable">key</span> : <span class="cm-variable">sets</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">mapValue</span> <span class="cm-operator">=</span> <span class="cm-variable">accessOrder</span>.<span class="cm-variable">get</span>(<span class="cm-variable">key</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">key</span> <span class="cm-operator">+</span> <span class="cm-string">"---"</span> <span class="cm-operator">+</span> <span class="cm-variable">mapValue</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="display: none; height: 484px;"></div></div></div></pre><p><span>代码</span><strong><span>看似</span></strong><span>是没有问题，但是运行会出错的！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4736d0bc28a9?w=1452&amp;h=252&amp;f=png&amp;s=19798" referrerpolicy="no-referrer"></p><p><span>前面在看源码注释的时候我们就发现了：</span><strong><span>在AccessOrder的情况下，使用get方法也是结构性的修改</span></strong><span>！</span></p><p><span>为了简单看出他俩的区别，下面我就</span><strong><span>直接用key来进行看了</span></strong><span>~</span></p><p><span>以下是</span><strong><span>访问顺序的测试</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">accessOrder</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 设置为访问顺序的方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span>,<span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">accessOrder</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedHashMap</span>(<span class="cm-number">16</span>, <span class="cm-number">0.75f</span>, <span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-string">"关注公众号Java3y"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">put</span>(<span class="cm-variable">i</span><span class="cm-operator">++</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 访问一下key为3的元素再进行遍历</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">accessOrder</span>.<span class="cm-variable">get</span>(<span class="cm-number">3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 遍历</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">sets</span> <span class="cm-operator">=</span> <span class="cm-variable">accessOrder</span>.<span class="cm-variable">keySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">Integer</span> <span class="cm-variable">key</span> : <span class="cm-variable">sets</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">key</span> );</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;"></div><div class="CodeMirror-gutters" style="display: none; height: 572px;"></div></div></div></pre><p><span>测试结果：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4736d5290da7?w=1096&amp;h=615&amp;f=png&amp;s=25532" referrerpolicy="no-referrer"></p><p><span>以下是</span><strong><span>插入顺序的测试</span></strong><span>(代码就不贴了，和上面几乎一样)：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4736d7747fd5?w=1270&amp;h=548&amp;f=png&amp;s=29777" referrerpolicy="no-referrer"></p><p><span>我们可以这样理解：</span><strong><span>最常用的将其放在链表的最后，不常用的放在链表的最前</span></strong><span>~</span></p><p><span>这个知识点以我的理解而言，它这个</span><strong><span>访问顺序在LinkedHashMap如果不重写用处并不大</span></strong><span>~它是用来给别的实现进行</span><strong><span>扩展</span></strong><span>的</span></p><ul><li><strong><span>因为最常被使用的元素再遍历的时候却放在了最后边，在LinkedHashMap中我也没找到对应的方法来进行调用</span></strong><span>~</span></li><li><span>一个</span><code>removeEldestEntry(Map.Entry&lt;K,V&gt; eldest)</code><span>方法，</span><strong><span>重写它可以删除最久未被使用的元素</span></strong><span>！！</span></li><li><span>还有一个是</span><code>afterNodeInsertion(boolean evict)</code><span>方法，</span><strong><span>新增时判断是否需要删除最久未被使用的元素</span></strong><span>！！</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47376603e968?w=1132&amp;h=210&amp;f=png&amp;s=24923" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="16remove方法" class="md-header-anchor"></a><span>1.6remove方法</span></h3><p><span>对于remove方法，在LinkedHashMap中也没有重写，它调用的还是父类的HashMap的</span><code>remove()</code><span>方法，在LinkedHashMap中重写的是：</span><code>afterNodeRemoval(Node&lt;K,V&gt; e)</code><span>这个方法</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47375e7352f0?w=986&amp;h=380&amp;f=png&amp;s=14863" referrerpolicy="no-referrer"></p><p><span>当然了，在remove的时候会涉及到上面重写的方法：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47426a9c2804?w=1088&amp;h=682&amp;f=png&amp;s=37576" referrerpolicy="no-referrer"></p><h3><a name="17遍历的方法" class="md-header-anchor"></a><span>1.7遍历的方法</span></h3><p><code>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</code><span>是被重写的了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b4742a2e3d959?w=1913&amp;h=453&amp;f=png&amp;s=77981" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/11/162b47433e2ac791?w=849&amp;h=607&amp;f=png&amp;s=30780" referrerpolicy="no-referrer"></p><p><span>看到了这里，我们就知道为啥注释说：</span><strong><span>初始容量对遍历没有影响</span></strong></p><p><span>因为它遍历的是</span><strong><span>LinkedHashMap内部维护的一个双向链表</span></strong><span>，而不是散列表(当然了，链表双向链表的元素都来源于散列表)</span></p><p>&nbsp;</p><h2><a name="二linkedhashmap总结" class="md-header-anchor"></a><span>二、LinkedHashMap总结</span></h2><p><span>LinkedHashMap比HashMap多了一个双向链表的维护，在数据结构而言它要复杂一些，阅读源码起来比较轻松一些，因为大多都由HashMap实现了..</span></p><p><span>阅读源码的时候我们会发现多态是无处不在的~子类用父类的方法，子类重写了父类的</span><strong><span>部分</span></strong><span>方法即可达到不一样的效果！</span></p><ul><li><span>比如：LinkedHashMap并没有重写put方法，而put方法内部的</span><code>newNode()</code><span>方法重写了。LinkedHashMap调用父类的put方法，里面回调的是重写后的</span><code>newNode()</code><span>，从而达到目的！</span></li></ul><p><span>LinkedHashMap可以设置两种遍历顺序：</span></p><ul><li><span>访问顺序（access-ordered）</span></li><li><span>插入顺序（insertion-ordered）</span></li><li><strong><span>默认是插入顺序的</span></strong></li></ul><p><span>对于访问顺序，它是LRU(最近最少使用)算法的实现，要使用它要么</span><strong><span>重写LinkedListMap的几个方法</span></strong><span>(</span><code>removeEldestEntry(Map.Entry&lt;K,V&gt; eldest)</code><span>和</span><code>afterNodeInsertion(boolean evict)</code><span>)，要么是</span><strong><span>扩展</span></strong><span>成LRUMap来使用，不然设置为访问顺序（access-ordered）的用处不大~</span></p><p><strong><span>LinkedHashMap遍历的是内部维护的双向链表</span></strong><span>，所以说初始容量对LinkedHashMap遍历是不受影响的</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmrl1ylng306o06oq3t.gif" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="七treemap" class="md-header-anchor"></a><span>七、TreeMap</span></h1><p>&nbsp;</p><h2><a name="一treemap剖析" class="md-header-anchor"></a><span>一、TreeMap剖析</span></h2><p><span>按照惯例，我简单翻译了一下顶部的注释(我英文水平渣，如果有错的地方请多多包涵~欢迎在评论区下指正)</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9081b33a8896?w=1918&amp;h=2568&amp;f=png&amp;s=294659" referrerpolicy="no-referrer"></p><p><span>接着我们来看看类继承图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9081b33b7ebc?w=917&amp;h=535&amp;f=png&amp;s=20392" referrerpolicy="no-referrer"></p><p><span>在注释中提到的要点，我来总结一下：</span></p><ul><li><span>TreeMap实现了NavigableMap接口，而NavigableMap接口继承着SortedMap接口，致使我们的</span><strong><span>TreeMap是有序的</span></strong><span>！</span></li><li><span>TreeMap底层是红黑树，它方法的时间复杂度都不会太高:log(n)~</span></li><li><span>非同步</span></li><li><span>使用Comparator或者Comparable来比较key是否相等与排序的问题~</span></li></ul><p>&nbsp;</p><p><span>对我而言，Comparator和Comparable我都忘得差不多了~~~下面就开始看TreeMap的源码来看看它是怎么实现的，并且回顾一下Comparator和Comparable的用法吧！</span></p><h3><a name="11treemap的域" class="md-header-anchor"></a><span>1.1TreeMap的域</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9081b341a94d?w=1082&amp;h=567&amp;f=png&amp;s=35071" referrerpolicy="no-referrer"></p><h3><a name="12treemap构造方法" class="md-header-anchor"></a><span>1.2TreeMap构造方法</span></h3><p><span>TreeMap的构造方法有4个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9081b3545c52?w=477&amp;h=126&amp;f=png&amp;s=7267" referrerpolicy="no-referrer"></p><p><span>可以发现，TreeMap的构造方法大多数与comparator有关：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce819c105?w=1918&amp;h=2487&amp;f=png&amp;s=232085" referrerpolicy="no-referrer"></p><p><span>也就是顶部注释说的：TreeMap有序是通过Comparator来进行比较的，</span><strong><span>如果comparator为null，那么就使用自然顺序</span></strong><span>~</span></p><p><span>打个比方：如果value是整数，自然顺序指的就是我们平常排序的顺序(1,2,3,4,5..)~</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">TreeMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span>, <span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">treeMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">TreeMap</span><span class="cm-operator">&lt;&gt;</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">treeMap</span>.<span class="cm-variable">put</span>(<span class="cm-number">1</span>, <span class="cm-number">5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">treeMap</span>.<span class="cm-variable">put</span>(<span class="cm-number">2</span>, <span class="cm-number">4</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">treeMap</span>.<span class="cm-variable">put</span>(<span class="cm-number">3</span>, <span class="cm-number">3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">treeMap</span>.<span class="cm-variable">put</span>(<span class="cm-number">4</span>, <span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">treeMap</span>.<span class="cm-variable">put</span>(<span class="cm-number">5</span>, <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">Integer</span>, <span class="cm-variable-3">Integer</span><span class="cm-operator">&gt;</span> <span class="cm-variable">entry</span> : <span class="cm-variable">treeMap</span>.<span class="cm-variable">entrySet</span>()) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">s</span> <span class="cm-operator">=</span> <span class="cm-variable">entry</span>.<span class="cm-variable">getKey</span>() <span class="cm-operator">+</span><span class="cm-string">"关注公众号：Java3y----&gt;"</span> <span class="cm-operator">+</span> <span class="cm-variable">entry</span>.<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">s</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9081b3706f3c?w=878&amp;h=319&amp;f=png&amp;s=19498" referrerpolicy="no-referrer"></p><h3><a name="13put方法" class="md-header-anchor"></a><span>1.3put方法</span></h3><p><span>我们来看看TreeMap的核心put方法，阅读它就可以获取不少关于TreeMap特性的东西了~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce85f2498?w=1918&amp;h=2244&amp;f=png&amp;s=216677" referrerpolicy="no-referrer"></p><p><span>下面是</span><code>compare(Object k1, Object k2)</code><span>方法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* Compares two keys using the correct comparison method for this TreeMap.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">@SuppressWarnings</span>(<span class="cm-string">"unchecked"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">int</span> <span class="cm-def">compare</span>(<span class="cm-variable-3">Object</span> <span class="cm-variable">k1</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">k2</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">comparator</span><span class="cm-operator">==</span><span class="cm-atom">null</span> <span class="cm-operator">?</span> ((<span class="cm-variable">Comparable</span><span class="cm-operator">&lt;?</span> <span class="cm-keyword">super</span> <span class="cm-variable">K</span><span class="cm-operator">&gt;</span>)<span class="cm-variable">k1</span>).<span class="cm-variable">compareTo</span>((<span class="cm-variable">K</span>)<span class="cm-variable">k2</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  : <span class="cm-variable">comparator</span>.<span class="cm-variable">compare</span>((<span class="cm-variable">K</span>)<span class="cm-variable">k1</span>, (<span class="cm-variable">K</span>)<span class="cm-variable">k2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>如果我们设置key为null，会抛出异常的，就不执行下面的代码了。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce8706e20?w=1538&amp;h=147&amp;f=png&amp;s=10737" referrerpolicy="no-referrer"></p><h3><a name="14get方法" class="md-header-anchor"></a><span>1.4get方法</span></h3><p><span>接下来我们来看看get方法的实现：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce89482cd?w=893&amp;h=260&amp;f=png&amp;s=16535" referrerpolicy="no-referrer"></p><p><span>点进去</span><code>getEntry()</code><span>看看实现：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce8b59295?w=1108&amp;h=588&amp;f=png&amp;s=38843" referrerpolicy="no-referrer"></p><p><span>如果Comparator不为null，接下来我们进去看看</span><code>getEntryUsingComparator(Object key)</code><span>，是怎么实现的</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b908ce8efee59?w=1127&amp;h=507&amp;f=png&amp;s=27799" referrerpolicy="no-referrer"></p><h3><a name="15remove方法-n855" class="md-header-anchor"></a><span>1.5remove方法</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9088f6d7aa89?w=929&amp;h=276&amp;f=png&amp;s=17275" referrerpolicy="no-referrer"></p><p><span>删除节点的时候调用的是</span><code>deleteEntry(Entry&lt;K,V&gt; p)</code><span>方法，这个方法主要是</span><strong><span>删除节点并且平衡红黑树</span></strong></p><p><span>平衡红黑树的代码是比较复杂的，我就不说了，你们去看吧(反正我看不懂)....</span></p><h3><a name="16遍历方法" class="md-header-anchor"></a><span>1.6遍历方法</span></h3><p><span>在看源码的时候可能不知道哪个是核心的遍历方法，因为Iterator有非常非常多~</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b906fb1353aed?w=548&amp;h=502&amp;f=png&amp;s=32582" referrerpolicy="no-referrer"></p><p><span>此时，我们只需要debug一下看看，跟下去就好！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b907b8809ec82?w=921&amp;h=145&amp;f=png&amp;s=7336" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b906fb530fdfa?w=1111&amp;h=216&amp;f=png&amp;s=10360" referrerpolicy="no-referrer"></p><p><span>于是乎，我们可以找到：</span><strong><span>TreeMap遍历是使用EntryIterator这个内部类的</span></strong></p><p><span>首先来看看EntryIterator的类结构图吧：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b906fb667e33b?w=558&amp;h=472&amp;f=png&amp;s=8500" referrerpolicy="no-referrer"></p><p><span>可以发现，EntryIterator大多的实现都是在父类中：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b906ffefa7fe7?w=1068&amp;h=240&amp;f=png&amp;s=9641" referrerpolicy="no-referrer"></p><p><span>那接下来我们去看看PrivateEntryIterator比较重要的方法：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b907052f0878b?w=903&amp;h=669&amp;f=png&amp;s=35061" referrerpolicy="no-referrer"></p><p><span>我们进去</span><code>successor(e)</code><span>方法看看实现：</span></p><blockquote><p><span>successor 其实就是一个结点的 下一个结点，所谓 下一个，是按次序排序后的下一个结点。从代码中可以看出，如果右子树不为空，就返回右子树中最小结点。如果右子树为空，就要向上回溯了。在这种情况下，t 是以其为根的树的最后一个结点。如果它是其父结点的左孩子，那么父结点就是它的下一个结点，否则，t 就是以其父结点为根的树的最后一个结点，需要再次向上回溯。一直到 ch 是 p 的左孩子为止。</span></p></blockquote><p><span>来源：</span><a href='https://blog.csdn.net/on_1y/article/details/27231855'><span>https://blog.csdn.net/on_1y/article/details/27231855</span></a></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9070922e2920?w=933&amp;h=586&amp;f=png&amp;s=19321" referrerpolicy="no-referrer"></p><h2><a name="二treemap总结" class="md-header-anchor"></a><span>二、TreeMap总结</span></h2><p><span>TreeMap底层是红黑树，能够实现该Map集合有序~</span></p><p><span>如果在构造方法中传递了Comparator对象，那么就会以Comparator对象的方法进行比较。否则，则使用Comparable的</span><code>compareTo(T o)</code><span>方法来比较。</span></p><ul><li><span>值得说明的是：如果使用的是</span><code>compareTo(T o)</code><span>方法来比较，</span><strong><span>key一定是不能为null</span></strong><span>，并且得实现了Comparable接口的。</span></li><li><span>即使是传入了Comparator对象，不用</span><code>compareTo(T o)</code><span>方法来比较，key</span><strong><span>也是</span></strong><span>不能为null的</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TreeMap</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span>, <span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">map</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">TreeMap</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span>, <span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>((<span class="cm-variable">o1</span>, <span class="cm-variable">o2</span>) <span class="cm-operator">-&gt;</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//主要条件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">num</span> <span class="cm-operator">=</span> <span class="cm-variable">o1</span>.<span class="cm-variable">getAge</span>() <span class="cm-operator">-</span> <span class="cm-variable">o2</span>.<span class="cm-variable">getAge</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//次要条件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">num2</span> <span class="cm-operator">=</span> <span class="cm-variable">num</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-variable">o1</span>.<span class="cm-variable">getName</span>().<span class="cm-variable">compareTo</span>(<span class="cm-variable">o2</span>.<span class="cm-variable">getName</span>()) : <span class="cm-variable">num</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">num2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//创建学生对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Student</span> <span class="cm-variable">s1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Student</span>(<span class="cm-string">"潘安"</span>, <span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Student</span> <span class="cm-variable">s2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Student</span>(<span class="cm-string">"柳下惠"</span>, <span class="cm-number">35</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//添加元素进集合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">map</span>.<span class="cm-variable">put</span>(<span class="cm-variable">s1</span>, <span class="cm-string">"宋朝"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">map</span>.<span class="cm-variable">put</span>(<span class="cm-variable">s2</span>, <span class="cm-string">"元朝"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">map</span>.<span class="cm-variable">put</span>(<span class="cm-atom">null</span>, <span class="cm-string">"汉朝"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//获取key集合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable">Student</span><span class="cm-operator">&gt;</span> <span class="cm-variable">set</span> <span class="cm-operator">=</span> <span class="cm-variable">map</span>.<span class="cm-variable">keySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//遍历key集合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Student</span> <span class="cm-variable">student</span> : <span class="cm-variable">set</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">map</span>.<span class="cm-variable">get</span>(<span class="cm-variable">student</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">student</span> <span class="cm-operator">+</span> <span class="cm-string">"---------"</span> <span class="cm-operator">+</span> <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 638px;"></div><div class="CodeMirror-gutters" style="display: none; height: 638px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/4/12/162b9070e1a2d227?w=990&amp;h=695&amp;f=png&amp;s=41707" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>我们从源码中的很多地方中发现：Comparator和Comparable出现的频率是很高的，因为TreeMap实现有序要么就是外界传递进来Comparator对象，要么就使用默认key的Comparable接口(实现自然排序)</span></p><p><span>最后我就来总结一下TreeMap要点吧：</span></p><ol start='' ><li><p><span>由于底层是红黑树，那么时间复杂度可以保证为log(n)</span></p></li><li><p><span>key不能为null，为null为抛出NullPointException的</span></p></li><li><p><span>想要自定义比较，在构造方法中传入Co smparator对象，否则使用key的自然排序来进行比较</span></p></li><li><p><span>TreeMap非同步的，想要同步可以使用Collections来进行封装</span></p><p>&nbsp;</p></li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyxk0p5kj3073073glh.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h1><a name="八concurrenthashmap" class="md-header-anchor"></a><span>八、ConcurrentHashMap</span></h1><p>&nbsp;</p><h2><a name="一concurrenthashmap剖析" class="md-header-anchor"></a><span>一、ConCurrentHashMap剖析</span></h2><p><span>ConCurrentHashMap在初学的时候反正我是没有接触过的，不知道你们接触过了没有~</span></p><p><span>这个类听得也挺少的，在集合中是比较复杂的一个类了，它涉及到了一些多线程的知识点。</span></p><p><span>不了解或忘记多线程知识点的同学也不要怕，哪儿用到了多线程的知识点，我都会简单介绍一下，并给出对应的资料去阅读的~</span></p><p><span>好了，我们就来开始吧~</span></p><h3><a name="11初识concurrenthashmap" class="md-header-anchor"></a><span>1.1初识ConCurrentHashMap</span></h3><p><span>ConCurrentHashMap的</span><strong><span>底层是：散列表+红黑树</span></strong><span>，与HashMap是一样的。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260d64e630de?w=1636&amp;h=726&amp;f=png&amp;s=71326" referrerpolicy="no-referrer"></p><p><span>从前面的章节我们也可以发现：最快了解一下类是干嘛的，我们</span><strong><span>看源码的顶部注释</span></strong><span>就可以了！</span></p><p><span>我简单翻译了一下顶部的注释(我英文水平渣，如果有错的地方请多多包涵~欢迎在评论区下指正)</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260db23db861?w=1918&amp;h=3000&amp;f=png&amp;s=438631" referrerpolicy="no-referrer"></p><p><span>根据上面注释我们可以简单总结：</span></p><ul><li><span>JDK1.8底层是</span><strong><span>散列表+红黑树</span></strong></li><li><span>ConCurrentHashMap支持</span><strong><span>高并发</span></strong><span>的访问和更新，它是</span><strong><span>线程安全</span></strong><span>的</span></li><li><span>检索操作不用加锁，get方法是非阻塞的</span></li><li><span>key和value都不允许为null</span></li></ul><h3><a name="12jdk17底层实现" class="md-header-anchor"></a><span>1.2JDK1.7底层实现</span></h3><p><span>上面指明的是JDK1.8底层是：散列表+红黑树，也就意味着，JDK1.7的底层跟JDK1.8是不同的~</span></p><p><span>JDK1.7的底层是：segments+HashEntry数组：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260da3b611c4?w=548&amp;h=418&amp;f=png&amp;s=6013" referrerpolicy="no-referrer"></p><p><span>图来源：</span><a href='https://blog.csdn.net/panweiwei1994/article/details/78897275' target='_blank' class='url'>https://blog.csdn.net/panweiwei1994/article/details/78897275</a></p><ul><li><span>Segment</span><strong><span>继承了ReentrantLock</span></strong><span>,每个片段都有了一个锁，叫做“</span><strong><span>锁分段</span></strong><span>”</span></li></ul><h3><a name="13有了hashtable为啥需要concurrenthashmap" class="md-header-anchor"></a><span>1.3有了Hashtable为啥需要ConCurrentHashMap</span></h3><ul><li><span>Hashtable是在</span><strong><span>每个方法上都加上了Synchronized</span></strong><span>完成同步，效率低下。</span></li><li><span>ConcurrentHashMap通过在</span><strong><span>部分加锁</span></strong><span>和</span><strong><span>利用CAS算法</span></strong><span>来实现同步。</span></li></ul><h3><a name="14cas算法和volatile简单介绍" class="md-header-anchor"></a><span>1.4CAS算法和volatile简单介绍</span></h3><p><span>在看ConCurrentHashMap源码之前，我们来简单讲讲CAS算法和volatile关键字</span></p><p><span>CAS（比较与交换，Compare and swap） 是一种有名的</span><strong><span>无锁算法</span></strong></p><p><span>CAS有</span><strong><span>3个</span></strong><span>操作数</span></p><ul><li><strong><span>内存值V</span></strong></li><li><strong><span>旧的预期值A</span></strong></li><li><strong><span>要修改的新值B</span></strong></li></ul><p><strong><span>当且仅当预期值A和内存值V相同时，将内存值V修改为B，否则什么都不做</span></strong></p><ul><li><span>当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值(</span><strong><span>A和内存值V相同时，将内存值V修改为B)</span></strong><span>，而其它线程都失败，失败的线程</span><strong><span>并不会被挂起</span></strong><span>，而是被告知这次竞争中失败，并可以再次尝试</span><strong><span>(否则什么都不做)</span></strong></li></ul><p><span>看了上面的描述应该就很容易理解了，先</span><strong><span>比较</span></strong><span>是否相等，如果相等则</span><strong><span>替换</span></strong><span>(CAS算法)</span></p><hr /><p><span>接下来我们看看</span><strong><span>volatile关键字</span></strong><span>，在初学的时候也很少使用到volatile这个关键字。反正我没用到，而又经常在看Java相关面试题的时候看到它，觉得是一个挺神秘又很难的一个关键字。其实不然，还是挺容易理解的~</span></p><p><span>volatile经典总结：</span><strong><span>volatile仅仅用来保证该变量对所有线程的可见性，但不保证原子性</span></strong></p><p><span>我们将其拆开来解释一下：</span></p><ul><li><p><span>保证</span><strong><span>该变量对所有线程的可见性</span></strong></p><ul><li><span>在多线程的环境下：当这个变量修改时，</span><strong><span>所有的线程都会知道该变量被修改了</span></strong><span>，也就是所谓的“可见性”</span></li></ul></li><li><p><span>不保证原子性</span></p><ul><li><span>修改变量(赋值)</span><strong><span>实质上</span></strong><span>是在JVM中</span><strong><span>分了好几步</span></strong><span>，而</span><strong><span>在这几步内(从装载变量到修改)，它是不安全的</span></strong><span>。</span></li></ul></li></ul><p>&nbsp;</p><h3><a name="15concurrenthashmap域" class="md-header-anchor"></a><span>1.5ConCurrentHashMap域</span></h3><p><span>域对象有这么几个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260da3564412?w=547&amp;h=245&amp;f=png&amp;s=6028" referrerpolicy="no-referrer"></p><p><span>我们来简单看一下他们是什么东东：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260da474a6d5?w=1918&amp;h=1839&amp;f=png&amp;s=116831" referrerpolicy="no-referrer"></p><p><span>初次阅读完之后，有的属性我也不太清楚它是干什么的，在</span><strong><span>继续阅读之后可能就明朗了</span></strong><span>~</span></p><h3><a name="16concurrenthashmap构造方法" class="md-header-anchor"></a><span>1.6ConCurrentHashMap构造方法</span></h3><p><span>ConcurrentHashMap的构造方法有5个：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c260d69b1064b?w=525&amp;h=122&amp;f=png&amp;s=3805" referrerpolicy="no-referrer"></p><p><span>具体的实现是这样子的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2612fb0c7ae7?w=1918&amp;h=2568&amp;f=png&amp;s=158065" referrerpolicy="no-referrer"></p><p><span>可以发现，在构造方法中有几处都调用了</span><code>tableSizeFor()</code><span>，我们来看一下他是干什么的：</span></p><p><span>点进去之后发现，啊，原来我看过这个方法，在HashMap的时候.....</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2612fafb74d4?w=1189&amp;h=386&amp;f=png&amp;s=9531" referrerpolicy="no-referrer"></p><p><span>它就是用来获取</span><strong><span>大于参数且最接近2的整次幂的数</span></strong><span>...</span></p><p><strong><span>赋值给sizeCtl属性也就说明了：这是下次扩容的大小</span></strong><span>~</span></p><p>&nbsp;</p><h3><a name="17put方法" class="md-header-anchor"></a><span>1.7put方法</span></h3><p><span>终于来到了最核心的方法之一：put方法啦~~~~</span></p><p><span>我们先来</span><strong><span>整体看一下</span></strong><span>put方法干了什么事：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2612fb1efb1f?w=1918&amp;h=2163&amp;f=png&amp;s=122353" referrerpolicy="no-referrer"></p><p><span>接下来，我们来看看初始化散列表的时候干了什么事：</span><code>initTable()</code></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2612fb0721da?w=1271&amp;h=615&amp;f=png&amp;s=26865" referrerpolicy="no-referrer"></p><p><strong><span>只让一个线程对散列表进行初始化</span></strong><span>！</span></p><h3><a name="18get方法" class="md-header-anchor"></a><span>1.8get方法</span></h3><p><span>从顶部注释我们可以读到，get方法是</span><strong><span>不用加锁</span></strong><span>的，是非阻塞的。</span></p><p><span>我们可以发现，Node节点是重写的，设置了volatile关键字修饰，致使它每次获取的都是</span><strong><span>最新</span></strong><span>设置的值</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2612fb18c413?w=1260&amp;h=752&amp;f=png&amp;s=29908" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/14/162c2611f6e77393?w=1327&amp;h=543&amp;f=png&amp;s=22510" referrerpolicy="no-referrer"></p><h2><a name="二concurrenthashmap总结" class="md-header-anchor"></a><span>二、ConcurrentHashMap总结</span></h2><p><span>上面简单介绍了ConcurrentHashMap的核心知识，还有很多知识点都没有提及到，作者的水平也不能将其弄懂~~有兴趣进入的同学可到下面的链接继续学习。</span></p><p><span>下面我来简单总结一下ConcurrentHashMap的核心要点：</span></p><ul><li><strong><span>底层结构是散列表(数组+链表)+红黑树</span></strong><span>，这一点和HashMap是一样的。</span></li><li><span>Hashtable是将所有的方法进行同步，效率低下。而ConcurrentHashMap作为一个高并发的容器，它是通过</span><strong><span>部分锁定+CAS算法来进行实现线程安全的</span></strong><span>。CAS算法也可以认为是</span><strong><span>乐观锁</span></strong><span>的一种~</span></li><li><span>在高并发环境下，统计数据(计算size...等等)其实是无意义的，因为在下一时刻size值就变化了。</span></li><li><span>get方法是非阻塞，无锁的。重写Node类，通过volatile修饰next来实现每次获取都是</span><strong><span>最新</span></strong><span>设置的值</span></li><li><strong><span>ConcurrentHashMap的key和Value都不能为null</span></strong></li></ul><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmu1lb2vg306o06ojtg.gif" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="九set" class="md-header-anchor"></a><span>九、Set</span></h1><h2><a name="一hashset剖析" class="md-header-anchor"></a><span>一、HashSet剖析</span></h2><p><span>首先，我们来看一下HashSet的继承结构图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9ac0661b1?w=674&amp;h=502&amp;f=png&amp;s=16546" referrerpolicy="no-referrer"></p><p><span>按照惯例，我们来看看HashSet顶部注释：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9ad6d6bc1?w=1918&amp;h=1920&amp;f=png&amp;s=134885" referrerpolicy="no-referrer"></p><p><span>从顶部注释来看，我们就可以归纳HashSet的要点了：</span></p><ul><li><span>实现Set接口</span></li><li><span>不保证迭代顺序</span></li><li><span>允许元素为null</span></li><li><strong><span>底层实际上是一个HashMap实例</span></strong></li><li><span>非同步</span></li><li><span>初始容量非常影响迭代性能</span></li></ul><p>&nbsp;</p><p>&nbsp;</p><p><span>顶部注释说底层实际上是一个HashMap实例，那证据呢？</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78e26af1152c?w=1127&amp;h=191&amp;f=png&amp;s=6978" referrerpolicy="no-referrer"></p><p><span>我们再来看一下HashSet整个类的方法和属性：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78e26b0a776d?w=1706&amp;h=734&amp;f=png&amp;s=54584" referrerpolicy="no-referrer"></p><p><span>对于学习过HashMap的人来说，简直简单得让人开心，哈哈哈~</span></p><p><span>我们知道Map是一个映射，有key有value，</span><strong><span>既然HashSet底层用的是HashMap，那么value在哪里呢</span></strong><span>？？？</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9a80bef4e?w=940&amp;h=100&amp;f=png&amp;s=4385" referrerpolicy="no-referrer"></p><p><span>value是一个Object，</span><strong><span>所有的value都是它</span></strong></p><p><span>所以可以直接总结出：HashSet实际上就是封装了HashMap，</span><strong><span>操作HashSet元素实际上就是操作HashMap</span></strong><span>。这也是面向对象的一种体现，</span><strong><span>重用性贼高</span></strong><span>！</span></p><p>&nbsp;</p><h2><a name="二treeset剖析" class="md-header-anchor"></a><span>二、TreeSet剖析</span></h2><p><span>首先，我们也来看看TreeSet的类继承结构图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9ae86ae16?w=943&amp;h=626&amp;f=png&amp;s=10688" referrerpolicy="no-referrer"></p><p><span>按照惯例，我们来看看TreeSet顶部注释：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9edf64adc?w=1918&amp;h=1920&amp;f=png&amp;s=149594" referrerpolicy="no-referrer"></p><p><span>从顶部注释来看，我们就可以归纳TreeSet的要点了：</span></p><ul><li><span>实现NavigableSet接口</span></li><li><span>可以实现排序功能</span></li><li><strong><span>底层实际上是一个TreeMap实例</span></strong></li><li><span>非同步</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9f4f3da97?w=1382&amp;h=704&amp;f=png&amp;s=35015" referrerpolicy="no-referrer"></p><h2><a name="三linkedhashset剖析" class="md-header-anchor"></a><span>三、LinkedHashSet剖析</span></h2><p><span>首先，我们也来看看TreeSet的类继承结构图：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9f5b7c47f?w=717&amp;h=589&amp;f=png&amp;s=10853" referrerpolicy="no-referrer"></p><p><span>按照惯例，我们来看看LinkedHashSet顶部注释：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/15/162c78d9fba031fb?w=1918&amp;h=2649&amp;f=png&amp;s=194461" referrerpolicy="no-referrer"></p><p><span>从顶部注释来看，我们就可以归纳LinkedHashSet的要点了：</span></p><ul><li><span>迭代是有序的</span></li><li><span>允许为null</span></li><li><strong><span>底层实际上是一个HashMap+双向链表实例(其实就是LinkedHashMap)...</span></strong></li><li><span>非同步</span></li><li><span>性能比HashSet差一丢丢，因为要维护一个双向链表</span></li><li><span>初始容量与迭代无关，LinkedHashSet迭代的是双向链表</span></li></ul><h2><a name="四set集合总结" class="md-header-anchor"></a><span>四、Set集合总结</span></h2><p><span>可以很明显地看到，</span><strong><span>Set集合的底层就是Map</span></strong><span>，所以我都没有做太多的分析在上面，也没什么好分析的了。</span></p><p><span>下面总结一下Set集合常用的三个子类吧：</span></p><p><strong><span>HashSet：</span></strong></p><ul><li><span>无序，允许为null，底层是HashMap(散列表+红黑树)，非线程同步</span></li></ul><p><strong><span>TreeSet：</span></strong></p><ul><li><span>有序，不允许为null，底层是TreeMap(红黑树),非线程同步</span></li></ul><p><strong><span>LinkedHashSet：</span></strong></p><ul><li><span>迭代有序，允许为null，底层是HashMap+双向链表，非线程同步</span></li></ul><p><span>从结论而言我们就可以根据自己的实际情况来使用了。</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmrl1ylng306o06oq3t.gif" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="十copyonwritearraylist" class="md-header-anchor"></a><span>十、CopyOnWriteArrayList</span></h1><p>&nbsp;</p><p><span>CopyWriteOn 可能大家对这个技术</span><strong><span>比较陌生</span></strong><span>吧，但这项技术是</span><strong><span>挺多应用场景</span></strong><span>的。除了上文所说的Linux、文件系统外，其实在</span><strong><span>Java</span></strong><span>也有其身影。</span></p><p><span>大家对线程安全容器可能最熟悉的就是ConcurrentHashMap了，因为这个容器经常会在面试的时候考查。</span></p><p><span>比如说，一个常见的面试场景：</span></p><ul><li><span>面试官问：“HashMap是线程安全的吗？如果HashMap线程不安全的话，那有没有安全的Map容器”</span></li><li><span>3y：“线程安全的Map有两个，一个是Hashtable，一个是ConcurrentHashMap”</span></li><li><span>面试官继续问：“那Hashtable和ConcurrentHashMap有什么区别啊？”</span></li><li><span>3y：“balabalabalabalabalabala&quot;</span></li><li><span>面试官：”ok,ok,ok,看你Java基础挺不错的呀“</span></li></ul><p><span>那如果有这样的面试呢？</span></p><ul><li><span>面试官问：“ArrayList是线程安全的吗？如果ArrayList线程不安全的话，那有没有安全的类似ArrayList的容器”</span></li><li><span>3y：“线程安全的ArrayList我们可以使用Vector，或者说我们可以使用Collections下的方法来包装一下”</span></li><li><span>面试官继续问：“嗯，我相信你也知道Vector是一个比较老的容器了，还有没有其他的呢？”</span></li><li><span>3y：“Emmmm,这个...“</span></li><li><span>面试官</span><strong><span>提示</span></strong><span>：“就比如JUC中有ConcurrentHashMap，那JUC中有类似&quot;ArrayList&quot;的线程安全容器类吗？“</span></li><li><span>3y：“Emmmm,这个...“</span></li><li><span>面试官：”ok,ok,ok,</span><strong><span>今天的面试时间也差不多了，你回去等通知吧</span></strong><span>。“</span></li></ul><p><span>今天主要讲解的是CopyOnWriteArrayList~</span></p><p><span>本文</span><strong><span>力求简单讲清每个知识点</span></strong><span>，希望大家看完能有所收获</span></p><h2><a name="一vector和synchronizedlist" class="md-header-anchor"></a><span>一、Vector和SynchronizedList</span></h2><h3><a name="11回顾线程安全的vector和synchronizedlist" class="md-header-anchor"></a><span>1.1回顾线程安全的Vector和SynchronizedList</span></h3><p><span>我们知道ArrayList是用于替代Vector的，Vector是线程安全的容器。因为它几乎在每个方法声明处都加了</span><strong><span>synchronized关键字</span></strong><span>来使容器安全。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc4cffc34d11?w=967&amp;h=688&amp;f=png&amp;s=19152" referrerpolicy="no-referrer" alt="Vector实现"></p><p><span>如果使用</span><code>Collections.synchronizedList(new ArrayList())</code><span>来使ArrayList变成是线程安全的话，也是几乎都是每个方法都加上synchronized关键字的，只不过</span><strong><span>它不是加在方法的声明处，而是方法的内部</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c2fcdf351?w=1534&amp;h=662&amp;f=png&amp;s=33951" referrerpolicy="no-referrer" alt="Collections.synchronizedList()的实现"></p><h3><a name="12vector和synchronizedlist可能会出现的问题" class="md-header-anchor"></a><span>1.2Vector和SynchronizedList可能会出现的问题</span></h3><p><span>在讲解CopyOnWrite容器之前，我们还是先来看一下线程安全容器的一些</span><strong><span>可能没有注意到</span></strong><span>的地方~</span></p><p><span>下面我们直接来看一下这段代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 得到Vector最后一个元素</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-def">getLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">list</span>.<span class="cm-variable">get</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 删除Vector最后一个元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">deleteLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">remove</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>以我们第一反应来分析一下上面两个方法：</span><strong><span>在多线程环境下，是否有问题</span></strong><span>？</span></p><ul><li><span>我们可以知道的是Vector的</span><code>size()和get()以及remove()</code><span>都被synchronized修饰的。</span></li></ul><p><span>答案：从调用者的角度是</span><strong><span>有问题</span></strong><span>的</span></p><p><span>我们可以写段代码测试一下：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Vector</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">UnsafeVectorHelpers</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 初始化Vector</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Vector</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">vector</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Vector</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"关注公众号"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"Java3y"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"买Linux可到我下面的链接，享受最低价"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"给3y加鸡腿"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> <span class="cm-variable">getLast</span>(<span class="cm-variable">vector</span>)).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> <span class="cm-variable">deleteLast</span>(<span class="cm-variable">vector</span>)).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> <span class="cm-variable">getLast</span>(<span class="cm-variable">vector</span>)).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Thread</span>(() <span class="cm-operator">-&gt;</span> <span class="cm-variable">deleteLast</span>(<span class="cm-variable">vector</span>)).<span class="cm-variable">start</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 得到Vector最后一个元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-variable">getLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">list</span>.<span class="cm-variable">get</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 删除Vector最后一个元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">deleteLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">remove</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 726px;"></div><div class="CodeMirror-gutters" style="display: none; height: 726px;"></div></div></div></pre><p><span>可以发现的是，有可能会抛出异常的：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c2d0bd6cb?w=1780&amp;h=177&amp;f=png&amp;s=14468" referrerpolicy="no-referrer" alt="代码抛出异常"></p><p><span>原因也很简单，我们照着流程走一下就好了：</span></p><ul><li><span>线程A执行</span><code>getLast()</code><span>方法，线程B执行</span><code>deleteLast()</code><span>方法</span></li><li><span>线程A执行</span><code>int lastIndex = list.size() - 1;</code><span>得到lastIndex的值是3。</span><strong><span>同时</span></strong><span>，线程B执行</span><code>int lastIndex = list.size() - 1;</code><span>得到的lastIndex的值</span><strong><span>也</span></strong><span>是3</span></li><li><span>此时线程B先得到CPU执行权，执行</span><code>list.remove(lastIndex)</code><span>将下标为3的元素删除了</span></li><li><span>接着线程A得到CPU执行权，执行</span><code>list.get(lastIndex);</code><span>，发现已经没有下标为3的元素，抛出异常了.</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c2baa3a57?w=1012&amp;h=342&amp;f=png&amp;s=16566" referrerpolicy="no-referrer" alt="交替执行导致异常发生"></p><p><span>出现这个问题的原因也很简单：</span></p><ul><li><p><code>getLast()</code><span>和</span><code>deleteLast()</code><span>这两个方法并不是原子性的，即使他们</span><strong><span>内部的每一步操作是原子性</span></strong><span>的(被Synchronize修饰就可以实现原子性)，但是内部之间还是可以</span><strong><span>交替</span></strong><span>执行。</span></p><ul><li><span>这里的意思就是：</span><code>size()和get()以及remove()</code><span>都是原子性的，但是如果并发执行</span><code>getLast()</code><span>和</span><code>deleteLast()</code><span>，方法里面的</span><code>size()和get()以及remove()</code><span>是可以交替执行的。</span></li></ul></li></ul><p><span>要解决上面这种情况也很简单，因为我们都是对Vector进行操作的，</span><strong><span>只要操作Vector前把它锁住就没毛病了</span></strong><span>！</span></p><p><span>所以我们可以改成这样子：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 得到Vector最后一个元素</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">Object</span> <span class="cm-def">getLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">list</span>.<span class="cm-variable">get</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 删除Vector最后一个元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">deleteLast</span>(<span class="cm-variable">Vector</span> <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">synchronized</span> (<span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">lastIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">remove</span>(<span class="cm-variable">lastIndex</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><blockquote><p><span>ps:如果有人去测试一下，发现会抛出异常java.lang.ArrayIndexOutOfBoundsException: -1，这是</span><strong><span>没有检查角标的异常</span></strong><span>，不是并发导致的问题。</span></p></blockquote><p><span>经过上面的例子我们可以看看下面的代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 初始化Vector</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Vector</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">vector</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Vector</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"关注公众号"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"Java3y"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"买Linux可到我下面的链接，享受最低价"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">add</span>(<span class="cm-string">"给3y加鸡腿"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 遍历Vector</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">vector</span>.<span class="cm-variable">size</span>(); <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 比如在这执行vector.clear();</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//new Thread(() -&gt; vector.clear()).start();</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">vector</span>.<span class="cm-variable">get</span>(<span class="cm-variable">i</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 396px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><p><span>同样地：如果在遍历Vector的时候，有别的线程修改了Vector的长度，那还是会</span><strong><span>有问题</span></strong><span>！</span></p><ul><li><span>线程A遍历Vector，执行</span><code>vector.size()</code><span>时，发现Vector的长度为5</span></li><li><span>此时</span><strong><span>很有可能存在</span></strong><span>线程B对Vector进行</span><code>clear()</code><span>操作</span></li><li><span>随后线程A执行</span><code>vector.get(i)</code><span>时，抛出异常</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c2bcfaf35?w=1739&amp;h=168&amp;f=png&amp;s=10464" referrerpolicy="no-referrer" alt="Vector遍历抛出异常"></p><p><span>在JDK5以后，Java推荐使用</span><code>for-each</code><span>(迭代器)来遍历我们的集合，好处就是</span><strong><span>简洁、数组索引的边界值只计算一次</span></strong><span>。</span></p><p><span>如果使用</span><code>for-each</code><span>(迭代器)来做上面的操作，会抛出ConcurrentModificationException异常</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c86bb67f7?w=1507&amp;h=554&amp;f=png&amp;s=30364" referrerpolicy="no-referrer" alt="迭代器遍历会抛出ConcurrentModificationException"></p><p><span>SynchronizedList在使用</span><strong><span>迭代器遍历</span></strong><span>的时候同样会有问题的，源码已经提醒我们要手动加锁了。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c9c077a76?w=1319&amp;h=257&amp;f=png&amp;s=10570" referrerpolicy="no-referrer" alt="SynchronizedList在遍历的时候同样会有问题的"></p><p><span>如果想要完美解决上面所讲的问题，我们可以在</span><strong><span>遍历前加锁</span></strong><span>：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 遍历Vector</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">synchronized</span> (<span class="cm-variable">vector</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">vector</span>.<span class="cm-variable">size</span>(); <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">vector</span>.<span class="cm-variable">get</span>(<span class="cm-variable">i</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>有经验的同学就可以知道：</span><strong><span>哇，遍历一下容器都要我加上锁，这这这不是要慢死了吗</span></strong><span>.的确是挺慢的..</span></p><p><span>所以我们的CopyOnWriteArrayList就登场了！</span></p><h2><a name="二copyonwritearraylistset介绍" class="md-header-anchor"></a><span>二、CopyOnWriteArrayList(Set)介绍</span></h2><p><span>一般来说，我们会认为：CopyOnWriteArrayList是同步List的替代品，CopyOnWriteArraySet是同步Set的替代品。</span></p><p><span>无论是Hashtable--&gt;ConcurrentHashMap，还是说Vector--&gt;CopyOnWriteArrayList。JUC下支持并发的容器与老一代的线程安全类相比，总结起来就是加锁</span><strong><span>粒度</span></strong><span>的问题</span></p><ul><li><span>Hashtable、Vector加锁的粒度大(直接在方法声明处使用synchronized)</span></li><li><span>ConcurrentHashMap、CopyOnWriteArrayList加锁粒度小(用各种的方式来实现线程安全，比如我们知道的ConcurrentHashMap用了cas锁、volatile等方式来实现线程安全..)</span></li><li><span>JUC下的线程安全容器在遍历的时候</span><strong><span>不会</span></strong><span>抛出ConcurrentModificationException异常</span></li></ul><p><span>所以一般来说，我们都会</span><strong><span>使用JUC包下给我们提供的线程安全容器</span></strong><span>，而不是使用老一代的线程安全容器。</span></p><p><span>下面我们来看看CopyOnWriteArrayList是怎么实现的，为什么使用</span><strong><span>迭代器遍历</span></strong><span>的时候就</span><strong><span>不用额外加锁</span></strong><span>，也不会抛出ConcurrentModificationException异常。</span></p><h3><a name="21copyonwritearraylist实现原理" class="md-header-anchor"></a><span>2.1CopyOnWriteArrayList实现原理</span></h3><p><span>我们还是先来回顾一下COW：</span></p><blockquote><p><span>如果有多个调用者（callers）同时请求相同资源（如内存或磁盘上的数据存储），他们会共同获取</span><strong><span>相同的指针指向相同的资源</span></strong><span>，直到某个调用者</span><strong><span>试图修改</span></strong><span>资源的内容时，系统才会</span><strong><span>真正复制一份专用副本</span></strong><span>（private copy）给该调用者，而其他调用者所见到的最初的资源仍然保持不变。</span><strong><span>优点</span></strong><span>是如果调用者</span><strong><span>没有修改该资源，就不会有副本</span></strong><span>（private copy）被建立，因此多个调用者只是读取操作时可以</span><strong><span>共享同一份资源</span></strong><span>。</span></p></blockquote><p><span>参考自维基百科：</span><a href='https://zh.wikipedia.org/wiki/%E5%AF%AB%E5%85%A5%E6%99%82%E8%A4%87%E8%A3%BD'><span>https://zh.wikipedia.org/wiki/%E5%AF%AB%E5%85%A5%E6%99%82%E8%A4%87%E8%A3%BD</span></a></p><blockquote><p><span>之前写博客的时候，如果是要看源码，一般会翻译一下源码的注释并用图贴在文章上的。Emmm，发现阅读体验并不是很好，所以我这里就</span><strong><span>直接概括一下源码注释</span></strong><span>说了什么吧。另外，如果使用IDEA的话，可以下一个插件</span><strong><span>Translation</span></strong><span>(免费好用).</span></p></blockquote><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3c8738d4e0?w=868&amp;h=478&amp;f=png&amp;s=14375" referrerpolicy="no-referrer" alt="Translation插件"></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3cb3f773d4?w=967&amp;h=315&amp;f=png&amp;s=17982" referrerpolicy="no-referrer" alt="Translation插件"></p><hr /><p><span>概括一下CopyOnWriteArrayList源码注释介绍了什么：</span></p><ul><li><span>CopyOnWriteArrayList是线程安全容器(相对于ArrayList)，底层通过</span><strong><span>复制数组</span></strong><span>的方式来实现。</span></li><li><span>CopyOnWriteArrayList在遍历的使用不会抛出ConcurrentModificationException异常，并且遍历的时候就不用额外加锁</span></li><li><span>元素可以为null</span></li></ul><h4><a name="211看一下copyonwritearraylist基本的结构" class="md-header-anchor"></a><span>2.1.1看一下CopyOnWriteArrayList基本的结构</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/** 可重入锁对象 */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-keyword">transient</span> <span class="cm-variable">ReentrantLock</span> <span class="cm-variable">lock</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ReentrantLock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/** CopyOnWriteArrayList底层由数组实现，volatile修饰 */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">transient</span> <span class="cm-keyword">volatile</span> <span class="cm-variable-3">Object</span>[] <span class="cm-variable">array</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 得到数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span>[] <span class="cm-def">getArray</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">array</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 设置数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable-3">void</span> <span class="cm-def">setArray</span>(<span class="cm-variable-3">Object</span>[] <span class="cm-variable">a</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">array</span> <span class="cm-operator">=</span> <span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* 初始化CopyOnWriteArrayList相当于初始化数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">CopyOnWriteArrayList</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">setArray</span>(<span class="cm-keyword">new</span> <span class="cm-variable-3">Object</span>[<span class="cm-number">0</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;"></div><div class="CodeMirror-gutters" style="display: none; height: 572px;"></div></div></div></pre><p><span>看起来挺简单的，CopyOnWriteArrayList底层就是数组，加锁就交由ReentrantLock来完成。</span></p><h4><a name="212常见方法的实现" class="md-header-anchor"></a><span>2.1.2常见方法的实现</span></h4><p>&nbsp;</p><p><span>根据上面的分析我们知道如果遍历</span><code>Vector/SynchronizedList</code><span>是需要自己手动加锁的。</span></p><p><span>CopyOnWriteArrayList使用迭代器遍历时不需要显示加锁，看看</span><code>add()、clear()、remove()</code><span>与</span><code>get()</code><span>方法的实现可能就有点眉目了。</span></p><p><span>首先我们可以看看</span><code>add()</code><span>方法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable-3">boolean</span> <span class="cm-def">add</span>(<span class="cm-variable">E</span> <span class="cm-variable">e</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 加锁</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">final</span> <span class="cm-variable">ReentrantLock</span> <span class="cm-variable">lock</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">lock</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 得到原数组的长度和元素</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span>[] <span class="cm-variable">elements</span> <span class="cm-operator">=</span> <span class="cm-variable">getArray</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-variable">elements</span>.<span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 复制出一个新数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">Object</span>[] <span class="cm-variable">newElements</span> <span class="cm-operator">=</span> <span class="cm-variable">Arrays</span>.<span class="cm-variable">copyOf</span>(<span class="cm-variable">elements</span>, <span class="cm-variable">len</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 添加时，将新元素添加到新数组中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newElements</span>[<span class="cm-variable">len</span>] <span class="cm-operator">=</span> <span class="cm-variable">e</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 将volatile Object[] array 的指向替换成新数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">setArray</span>(<span class="cm-variable">newElements</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 550px;"></div><div class="CodeMirror-gutters" style="display: none; height: 550px;"></div></div></div></pre><p><span>通过代码我们可以知道：在添加的时候就上锁，并</span><strong><span>复制一个新数组，增加操作在新数组上完成，将array指向到新数组中</span></strong><span>，最后解锁。</span></p><p><span>再来看看</span><code>size()</code><span>方法：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">public</span> <span class="cm-variable-3">int</span> <span class="cm-def">size</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 直接得到array数组的长度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">getArray</span>().<span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>再来看看</span><code>get()</code><span>方法：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">E</span> <span class="cm-def">get</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">get</span>(<span class="cm-variable">getArray</span>(), <span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span>[] <span class="cm-def">getArray</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">array</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>那再来看看</span><code>set()</code><span>方法</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">E</span> <span class="cm-def">set</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>, <span class="cm-variable">E</span> <span class="cm-variable">element</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">final</span> <span class="cm-variable">ReentrantLock</span> <span class="cm-variable">lock</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">lock</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">lock</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 得到原数组的旧值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable-3">Object</span>[] <span class="cm-variable">elements</span> <span class="cm-operator">=</span> <span class="cm-variable">getArray</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">E</span> <span class="cm-variable">oldValue</span> <span class="cm-operator">=</span> <span class="cm-variable">get</span>(<span class="cm-variable">elements</span>, <span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 判断新值和旧值是否相等</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">if</span> (<span class="cm-variable">oldValue</span> <span class="cm-operator">!=</span> <span class="cm-variable">element</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 复制新数组，新值在新数组中完成</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable-3">int</span> <span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-variable">elements</span>.<span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable-3">Object</span>[] <span class="cm-variable">newElements</span> <span class="cm-operator">=</span> <span class="cm-variable">Arrays</span>.<span class="cm-variable">copyOf</span>(<span class="cm-variable">elements</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">newElements</span>[<span class="cm-variable">index</span>] <span class="cm-operator">=</span> <span class="cm-variable">element</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 将array引用指向新数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">setArray</span>(<span class="cm-variable">newElements</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// Not quite a no-op; enssures volatile write semantics</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">setArray</span>(<span class="cm-variable">elements</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">return</span> <span class="cm-variable">oldValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span>} <span class="cm-keyword">finally</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 638px;"></div><div class="CodeMirror-gutters" style="display: none; height: 638px;"></div></div></div></pre><p><span>对于</span><code>remove()、clear()</code><span>跟</span><code>set()和add()</code><span>是类似的，这里我就不再贴出代码了。</span></p><p><span>总结：</span></p><ul><li><strong><span>在修改时，复制出一个新数组，修改的操作在新数组中完成，最后将新数组交由array变量指向</span></strong><span>。</span></li><li><strong><span>写加锁，读不加锁</span></strong></li></ul><h4><a name="213剖析为什么遍历时不用调用者显式加锁" class="md-header-anchor"></a><span>2.1.3剖析为什么遍历时不用调用者显式加锁</span></h4><p><span>常用的方法实现我们已经基本了解了，但还是不知道为啥能够在容器遍历的时候对其进行修改而不抛出异常。所以，来看一下他的迭代器吧：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 1. 返回的迭代器是COWIterator</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">public</span> <span class="cm-variable">Iterator</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span> <span class="cm-def">iterator</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">COWIterator</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">getArray</span>(), <span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 2. 迭代器的成员属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">Object</span>[] <span class="cm-variable">snapshot</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">int</span> <span class="cm-variable">cursor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 3. 迭代器的构造方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">private</span> <span class="cm-variable">COWIterator</span>(<span class="cm-variable-3">Object</span>[] <span class="cm-variable">elements</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">initialCursor</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cursor</span> <span class="cm-operator">=</span> <span class="cm-variable">initialCursor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">snapshot</span> <span class="cm-operator">=</span> <span class="cm-variable">elements</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 4. 迭代器的方法...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-keyword">public</span> <span class="cm-variable">E</span> <span class="cm-def">next</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span> <span class="cm-variable">hasNext</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">throw</span> <span class="cm-keyword">new</span> <span class="cm-variable">NoSuchElementException</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> (<span class="cm-variable">E</span>) <span class="cm-variable">snapshot</span>[<span class="cm-variable">cursor</span><span class="cm-operator">++</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">//.... 可以发现的是，迭代器所有的操作都基于snapshot数组，而snapshot是传递进来的array数组</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 572px;"></div><div class="CodeMirror-gutters" style="display: none; height: 572px;"></div></div></div></pre><p><span>到这里，我们应该就可以想明白了！CopyOnWriteArrayList在使用迭代器遍历的时候，操作的都是</span><strong><span>原数组</span></strong><span>！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/11/7/166ebc3cd2472bcf?w=1664&amp;h=703&amp;f=png&amp;s=231843" referrerpolicy="no-referrer" alt="一张图来解析COW容器"></p><h4><a name="214copyonwritearraylist缺点" class="md-header-anchor"></a><span>2.1.4CopyOnWriteArrayList缺点</span></h4><p><span>看了上面的实现源码，我们应该也大概能分析出CopyOnWriteArrayList的缺点了。</span></p><ul><li><p><strong><span>内存占用</span></strong><span>：如果CopyOnWriteArrayList经常要增删改里面的数据，经常要执行</span><code>add()、set()、remove()</code><span>的话，那是比较耗费内存的。</span></p><ul><li><span>因为我们知道每次</span><code>add()、set()、remove()</code><span>这些增删改操作都要</span><strong><span>复制一个数组</span></strong><span>出来。</span></li></ul></li><li><p><strong><span>数据一致性</span></strong><span>：CopyOnWrite容器</span><strong><span>只能保证数据的最终一致性，不能保证数据的实时一致性</span></strong><span>。</span></p><ul><li><span>从上面的例子也可以看出来，比如线程A在迭代CopyOnWriteArrayList容器的数据。线程B在线程A迭代的间隙中将CopyOnWriteArrayList部分的数据修改了(已经调用</span><code>setArray()</code><span>了)。但是线程A迭代出来的是原有的数据。</span></li></ul></li></ul><h4><a name="215copyonwriteset" class="md-header-anchor"></a><span>2.1.5CopyOnWriteSet</span></h4><p><span>CopyOnWriteArraySet的原理就是CopyOnWriteArrayList。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-variable">CopyOnWriteArrayList</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span> <span class="cm-variable">al</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">CopyOnWriteArraySet</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">al</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CopyOnWriteArrayList</span><span class="cm-operator">&lt;</span><span class="cm-variable">E</span><span class="cm-operator">&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyzin9wzj3073073mx3.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="十一java集合面试题" class="md-header-anchor"></a><span>十一、Java集合面试题</span></h1><p>&nbsp;</p><p><span>Java容器可分为两大类：</span></p><ul><li><p><span>Collection</span></p><ul><li><p><span>List</span></p><ul><li><strong><span>ArrayList</span></strong></li><li><span>LinkedList</span></li><li><span>Vector(了解，已过时)</span></li></ul></li><li><p><span>Set</span></p><ul><li><p><strong><span>HashSet</span></strong></p><ul><li><span>LinkedHashSet</span></li></ul></li><li><p><span>TreeSet</span></p></li></ul></li></ul></li><li><p><span>Map</span></p><ul><li><p><strong><span>HashMap</span></strong></p><ul><li><span>LinkedHashMap</span></li></ul></li><li><p><span>TreeMap</span></p></li><li><p><span>ConcurrentHashMap</span></p></li><li><p><span>Hashtable(了解，，已过时)</span></p></li></ul></li></ul><p><span>着重标出的那些就是我们</span><strong><span>用得最多</span></strong><span>的容器。</span></p><p>&nbsp;</p><h2><a name="一arraylist和vector的区别" class="md-header-anchor"></a><span>一、ArrayList和Vector的区别</span></h2><p><strong><span>共同点：</span></strong></p><ul><li><span>这两个类都实现了List接口，它们都是</span><strong><span>有序</span></strong><span>的集合(存储有序)，</span><strong><span>底层是数组</span></strong><span>。我们可以按位置索引号取出某个元素，</span><strong><span>允许元素重复和为null</span></strong><span>。</span></li></ul><p><strong><span>区别：</span></strong></p><ul><li><p><strong><span>同步性：</span></strong></p><ul><li><span>ArrayList是非同步的</span></li><li><span>Vector是同步的</span></li><li><span>即便需要同步的时候，我们可以使用Collections工具类来构建出同步的ArrayList而不用Vector</span></li></ul></li><li><p><strong><span>扩容大小：</span></strong></p><ul><li><span>Vector增长原来的一倍，ArrayList增长原来的0.5倍</span></li></ul></li></ul><h2><a name="二hashmap和hashtable的区别" class="md-header-anchor"></a><span>二、HashMap和Hashtable的区别</span></h2><p><strong><span>共同点：</span></strong></p><ul><li><span>从存储结构和实现来讲基本上都是相同的，都是实现Map接口~</span></li></ul><p><strong><span>区别：</span></strong></p><ul><li><p><strong><span>同步性：</span></strong></p><ul><li><span>HashMap是非同步的</span></li><li><span>Hashtable是同步的</span></li><li><span>需要同步的时候，我们往往不使用，而使用ConcurrentHashMap</span><a href='https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247484161&amp;idx=1&amp;sn=6f52fb1f714f3ffd2f96a5ee4ebab146&amp;chksm=ebd74200dca0cb16288db11f566cb53cafc580e08fe1c570e0200058e78676f527c014ffef41#rd'><span>ConcurrentHashMap基于JDK1.8源码剖析</span></a></li></ul></li><li><p><strong><span>是否允许为null：</span></strong></p><ul><li><span>HashMap允许为null</span></li><li><span>Hashtable不允许为null</span></li></ul></li><li><p><strong><span>contains方法</span></strong></p><ul><li><span>这知识点是在牛客网刷到的，没想到这种题还会有(我不太喜欢)....</span></li><li><span>Hashtable有contains方法</span></li><li><span>HashMap把Hashtable的contains方法去掉了，改成了containsValue和containsKey</span></li></ul></li><li><p><strong><span>继承不同：</span></strong></p><ul><li><span>HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;</span></li><li><span>public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt;</span></li></ul></li></ul><h2><a name="三list和map的区别" class="md-header-anchor"></a><span>三、List和Map的区别</span></h2><p><strong><span>共同点：</span></strong></p><ul><li><span>都是Java常用的容器，都是接口(ps：写出来感觉好像和没写一样.....)</span></li></ul><p><strong><span>不同点：</span></strong></p><ul><li><p><strong><span>存储结构不同</span></strong><span>：</span></p><ul><li><span>List是存储单列的集合</span></li><li><span>Map存储的是key-value键值对的集合</span></li></ul></li><li><p><strong><span>元素是否可重复</span></strong><span>：</span></p><ul><li><span>List允许元素重复</span></li><li><span>Map不允许key重复</span></li></ul></li><li><p><strong><span>是否有序</span></strong><span>：</span></p><ul><li><span>List集合是有序的(存储有序)</span></li><li><span>Map集合是无序的(存储无序)</span></li></ul></li></ul><h2><a name="四set里的元素是不能重复的那么用什么方法来区分重复与否呢-是用还是equals" class="md-header-anchor"></a><span>四、Set里的元素是不能重复的，那么用什么方法来区分重复与否呢? 是用==还是equals()?</span></h2><p><span>我们知道Set集合实际</span><strong><span>大都使用的是Map集合的put方法来添加元素</span></strong><span>。</span></p><p><span>以HashSet为例，HashSet里的元素不能重复，在源码(HashMap)是这样体现的：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 1. 如果key 相等 &nbsp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">p</span>.<span class="cm-variable">hash</span> <span class="cm-operator">==</span> <span class="cm-variable">hash</span> <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ((<span class="cm-variable">k</span> <span class="cm-operator">=</span> <span class="cm-variable">p</span>.<span class="cm-variable">key</span>) <span class="cm-operator">==</span> <span class="cm-variable">key</span> <span class="cm-operator">||</span> (<span class="cm-variable">key</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">key</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">k</span>))))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span> <span class="cm-operator">=</span> <span class="cm-variable">p</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 2. 修改对应的value</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span> &nbsp; <span class="cm-keyword">if</span> (<span class="cm-variable">e</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) { <span class="cm-comment">// existing mapping for key</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span> <span class="cm-variable">oldValue</span> <span class="cm-operator">=</span> <span class="cm-variable">e</span>.<span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">onlyIfAbsent</span> <span class="cm-operator">||</span> <span class="cm-variable">oldValue</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">afterNodeAccess</span>(<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">oldValue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>添加元素的时候，如果key(也对应的Set集合的元素)相等，那么则修改value值。而在Set集合中，value值仅仅是一个Object对象罢了(</span><strong><span>该对象对Set本身而言是无用的</span></strong><span>)。</span></p><p><span>也就是说：Set集合如果添加的元素相同时，</span><strong><span>是根本没有插入的(仅修改了一个无用的value值)</span></strong><span>！从源码(HashMap)中也看出来，</span><strong><span>==和equals()方法都有使用</span></strong><span>！</span></p><h2><a name="五collection和collections的区别" class="md-header-anchor"></a><span>五、Collection和Collections的区别</span></h2><ol start='' ><li><span>Collection是集合的上级</span><strong><span>接口</span></strong><span>，继承它的有Set和List接口</span></li><li><span>Collections是集合的</span><strong><span>工具类</span></strong><span>，提供了一系列的静态方法对集合的搜索、查找、同步等操作</span></li></ol><h2><a name="六说出arraylistlinkedlist的存储性能和特性" class="md-header-anchor"></a><span>六、说出ArrayList,LinkedList的存储性能和特性</span></h2><p><span>ArrayList的底层是数组，LinkedList的底层是双向链表。</span></p><ul><li><span>ArrayList它支持以角标位置进行索引出对应的元素(随机访问)，而LinkedList则需要遍历整个链表来获取对应的元素。因此</span><strong><span>一般来说ArrayList的访问速度是要比LinkedList要快的</span></strong></li><li><span>ArrayList由于是数组，对于删除和修改而言消耗是比较大(复制和移动数组实现)，LinkedList是双向链表删除和修改只需要修改对应的指针即可，消耗是很小的。因此</span><strong><span>一般来说LinkedList的增删速度是要比ArrayList要快的</span></strong></li></ul><h3><a name="61扩展" class="md-header-anchor"></a><span>6.1扩展：</span></h3><p><span>ArrayList的增删</span><strong><span>未必</span></strong><span>就是比LinkedList要慢。</span></p><ul><li><p><span>如果增删都是在</span><strong><span>末尾</span></strong><span>来操作【每次调用的都是remove()和add()】，此时ArrayList就不需要移动和复制数组来进行操作了。如果数据量有百万级的时，</span><strong><span>速度是会比LinkedList要快的</span></strong><span>。(我测试过)</span></p></li><li><p><span>如果</span><strong><span>删除操作</span></strong><span>的位置是在</span><strong><span>中间</span></strong><span>。由于LinkedList的消耗主要是在遍历上，ArrayList的消耗主要是在移动和复制上(底层调用的是arraycopy()方法，是native方法)。</span></p><ul><li><span>LinkedList的遍历速度是要慢于ArrayList的复制移动速度的</span></li><li><span>如果数据量有百万级的时，</span><strong><span>还是ArrayList要快</span></strong><span>。(我测试过)</span></li></ul></li></ul><h2><a name="七enumeration和iterator接口的区别" class="md-header-anchor"></a><span>七、Enumeration和Iterator接口的区别</span></h2><p><span>这个我在前面的文章中也没有详细去讲它们，只是大概知道的是：Iterator替代了Enumeration，Enumeration是一个旧的迭代器了。</span></p><p><span>与Enumeration相比，Iterator更加安全，</span><strong><span>因为当一个集合正在被遍历的时候，它会阻止其它线程去修改集合</span></strong><span>。</span></p><ul><li><span>我们在做练习的时候，迭代时会不会经常出错，抛出ConcurrentModificationException异常，说我们在遍历的时候还在修改元素。</span></li><li><span>这其实就是fail-fast机制~具体可参考博文：</span><a href='https://blog.csdn.net/panweiwei1994/article/details/77051261'><span>https://blog.csdn.net/panweiwei1994/article/details/77051261</span></a></li></ul><p><strong><span>区别有三点：</span></strong></p><ul><li><span>Iterator的方法名比Enumeration更科学</span></li><li><span>Iterator有fail-fast机制，比Enumeration更安全</span></li><li><span>Iterator能够删除元素，Enumeration并不能删除元素</span></li></ul><h2><a name="八listiterator有什么特点" class="md-header-anchor"></a><span>八、ListIterator有什么特点</span></h2><ul><li><span>ListIterator</span><strong><span>继承了</span></strong><span>Iterator接口，它用于</span><strong><span>遍历List集合的元素</span></strong><span>。</span></li><li><span>ListIterator可以实现</span><strong><span>双向遍历,添加元素，设置元素</span></strong></li></ul><p><span>看一下源码的方法就知道了：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/4/16/162cc35a911636db?w=552&amp;h=256&amp;f=png&amp;s=5964" referrerpolicy="no-referrer"></p><h2><a name="九并发集合类是什么" class="md-header-anchor"></a><span>九、并发集合类是什么？</span></h2><p><span>Java1.5并发包（java.util.concurrent）</span><strong><span>包含线程安全集合类，允许在迭代时修改集合</span></strong><span>。</span></p><ul><li><p><span>Utils包下的集合迭代器被设计为fail-fast的，会抛出ConcurrentModificationException。但java.util.concurrent的并不会，感谢评论区提醒~</span></p></li><li><p><span>一部分类为：</span></p><ul><li><span>CopyOnWriteArrayList</span></li><li><span>ConcurrentHashMap</span></li><li><span>CopyOnWriteArraySet</span></li></ul></li></ul><h2><a name="十java中hashmap的key值要是为类对象则该类需要满足什么条件" class="md-header-anchor"></a><span>十、Java中HashMap的key值要是为类对象则该类需要满足什么条件？</span></h2><p><strong><span>需要同时重写该类的hashCode()方法和它的equals()方法</span></strong><span>。</span></p><ul><li><span>从源码可以得知，在插入元素的时候是</span><strong><span>先算出该对象的hashCode</span></strong><span>。如果hashcode相等话的。那么表明该对象是存储在同一个位置上的。</span></li><li><span>如果调用equals()方法，</span><strong><span>两个key相同</span></strong><span>，则</span><strong><span>替换元素</span></strong></li><li><span>如果调用equals()方法，</span><strong><span>两个key不相同</span></strong><span>，则说明该</span><strong><span>hashCode仅仅是碰巧相同</span></strong><span>，此时是散列冲突，将新增的元素放在桶子上</span></li></ul><p><span>一般来说，我们会认为：</span><strong><span>只要两个对象的成员变量的值是相等的，那么我们就认为这两个对象是相等的</span></strong><span>！因为，Object底层比较的是两个对象的地址，而对我们开发来说这样的意义并不大~这也就为什么我们要重写</span><code>equals()</code><span>方法</span></p><p><span>重写了equals()方法，就要重写hashCode()的方法。因为</span><strong><span>equals()认定了这两个对象相同</span></strong><span>，而</span><strong><span>同一个对象调用hashCode()方法时</span></strong><span>，是应该返回相同的值的！</span></p><p>&nbsp;</p><h2><a name="十一与java集合框架相关的有哪些最好的实践" class="md-header-anchor"></a><span>十一、与Java集合框架相关的有哪些最好的实践</span></h2><ol start='' ><li><p><strong><span>根据需要</span></strong><span>确定集合的类型。如果是单列的集合，我们考虑用Collection下的子接口ArrayList和Set。如果是映射，我们就考虑使用Map~</span></p></li><li><p><span>确定完我们的集合类型，我们接下来</span><strong><span>确定使用该集合类型下的哪个子类</span></strong><span>~我认为可以简单分成几个步骤：</span></p><ul><li><p><span>是否需要同步</span></p><ul><li><span>去找线程安全的集合类使用</span></li></ul></li><li><p><span>迭代时是否需要有序(插入顺序有序)</span></p><ul><li><span>去找Linked双向列表结构的</span></li></ul></li><li><p><span>是否需要排序(自然顺序或者手动排序)</span></p><ul><li><span>去找Tree红黑树类型的(JDK1.8) </span></li></ul></li></ul></li><li><p><span>估算存放集合的数据量有多大，无论是List还是Map，它们实现动态增长，都是有性能消耗的。在初始集合的时候给出一个</span><strong><span>合理的容量</span></strong><span>会减少动态增长时的消耗~</span></p></li><li><p><strong><span>使用泛型</span></strong><span>，避免在运行时出现ClassCastException</span></p></li><li><p><span>尽可能使用Collections工具类，或者获取只读、同步或空的集合，</span><strong><span>而非编写自己的实现</span></strong><span>。它将会提供代码重用性，它有着更好的稳定性和可维护性</span></p></li></ol><h2><a name="十二arraylist集合加入1万条数据应该怎么提高效率" class="md-header-anchor"></a><span>十二、ArrayList集合加入1万条数据，应该怎么提高效率</span></h2><p><span>ArrayList的默认初始容量为10，要插入大量数据的时候需要不断扩容，而扩容是非常影响性能的。因此，现在明确了10万条数据了，我们可以</span><strong><span>直接在初始化的时候就设置ArrayList的容量</span></strong><span>！</span></p><p><span>这样就可以提高效率了~</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmr7fsc1j3073073aa5.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p></div>
</body>
</html>