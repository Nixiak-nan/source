<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>三歪教你学Servlet</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit inherit; background-repeat: inherit inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.701961); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit inherit; background-repeat: inherit inherit; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; background-repeat: initial initial; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; background-position: initial initial; background-repeat: initial initial; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; background-position: initial initial; background-repeat: initial initial; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); background-position: initial initial; background-repeat: initial initial; }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit inherit; background-repeat: inherit inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; background-repeat: initial initial !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; background-repeat: initial initial; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); background-position: initial initial; background-repeat: initial initial; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}
#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    padding-bottom: .3em;
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
   padding-bottom: .3em;
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}
h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-mac'><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2"><a class="md-toc-inner" href="#前言">前言</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n28"><a class="md-toc-inner" href="#tomcat">Tomcat</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n29"><a class="md-toc-inner" href="#1什么是tomcat">1.什么是Tomcat</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n31"><a class="md-toc-inner" href="#2为什么我们需要用到tomcat">2.为什么我们需要用到Tomcat </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n36"><a class="md-toc-inner" href="#3配置tomcat">3.配置Tomcat </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n58"><a class="md-toc-inner" href="#4相关术语介绍">4.相关术语介绍 </a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n61"><a class="md-toc-inner" href="#5tomcat结构目录">5.tomcat结构目录</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n63"><a class="md-toc-inner" href="#51目录的简单介绍">5.1目录的简单介绍</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n87"><a class="md-toc-inner" href="#52webapps目录的详细说明">5.2webapps目录的详细说明</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n112"><a class="md-toc-inner" href="#6配置虚拟目录">6.配置虚拟目录</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n113"><a class="md-toc-inner" href="#61为什么需要配置虚拟目录">6.1为什么需要配置虚拟目录？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n122"><a class="md-toc-inner" href="#62配置虚拟目录方法一">6.2配置虚拟目录方法一</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n133"><a class="md-toc-inner" href="#63配置虚拟目录方法二">6.3配置虚拟目录方法二</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n140"><a class="md-toc-inner" href="#7配置临时域名">7.配置临时域名</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n153"><a class="md-toc-inner" href="#71配置临时域名步骤">7.1配置临时域名步骤</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n164"><a class="md-toc-inner" href="#8设置虚拟主机">8.设置虚拟主机</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n165"><a class="md-toc-inner" href="#81什么是虚拟主机">8.1什么是虚拟主机？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n167"><a class="md-toc-inner" href="#82为什么需要用到虚拟主机">8.2为什么需要用到虚拟主机？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n170"><a class="md-toc-inner" href="#83配置虚拟主机的步骤">8.3配置虚拟主机的步骤</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n180"><a class="md-toc-inner" href="#9tomcat体系结构">9.Tomcat体系结构</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n183"><a class="md-toc-inner" href="#10浏览器访问web资源的流程图">10.浏览器访问WEB资源的流程图</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n187"><a class="md-toc-inner" href="#11练习">11.练习</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n204"><a class="md-toc-inner" href="#servlet基础知识">Servlet基础知识</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n205"><a class="md-toc-inner" href="#1什么是servlet">1.什么是Servlet？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n207"><a class="md-toc-inner" href="#2为什么要用到servlet">2.为什么要用到Servlet？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n209"><a class="md-toc-inner" href="#3http协议">3.HTTP协议</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n210"><a class="md-toc-inner" href="#31什么是htpp协议">3.1什么是HTPP协议</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n216"><a class="md-toc-inner" href="#32http10和http11的区别">3.2HTTP1.0和HTTP1.1的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n220"><a class="md-toc-inner" href="#33http请求">3.3HTTP请求</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n231"><a class="md-toc-inner" href="#331请求行">3.3.1请求行</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n239"><a class="md-toc-inner" href="#332请求头">3.3.2请求头</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n263"><a class="md-toc-inner" href="#34http响应">3.4HTTP响应</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n276"><a class="md-toc-inner" href="#341状态行">3.4.1状态行</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n282"><a class="md-toc-inner" href="#342响应头">3.4.2响应头</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n318"><a class="md-toc-inner" href="#4javaweb目录结构">4.JAVAWEB目录结构</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n335"><a class="md-toc-inner" href="#5实现servlet接口编写servlet程序">5.实现Servlet接口编写Servlet程序</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n338"><a class="md-toc-inner" href="#51编写servlet程序的步骤">5.1编写Servlet程序的步骤</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n351"><a class="md-toc-inner" href="#6servlet生命周期">6.Servlet生命周期</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n361"><a class="md-toc-inner" href="#61servlet生命周期可分为5个步骤">6.1Servlet生命周期可分为5个步骤</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n378"><a class="md-toc-inner" href="#7继承httpservlet编写servlet程序">7.继承HttpServlet编写Servlet程序</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n386"><a class="md-toc-inner" href="#servletconfigservletcontext和servlet细节">ServletConfig、ServletContext和Servlet细节</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n387"><a class="md-toc-inner" href="#1servlet的调用图">1.Servlet的调用图</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n391"><a class="md-toc-inner" href="#2servlet的细节">2.Servlet的细节</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n392"><a class="md-toc-inner" href="#21-一个已经注册的servlet可以被多次映射">2.1 一个已经注册的Servlet可以被多次映射</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n398"><a class="md-toc-inner" href="#22-servlet映射的url可以使用通配符">2.2 Servlet映射的URL可以使用通配符</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n424"><a class="md-toc-inner" href="#23-servlet是单例的">2.3 Servlet是单例的</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n425"><a class="md-toc-inner" href="#231-为什么servlet是单例的">2.3.1 为什么Servlet是单例的</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n427"><a class="md-toc-inner" href="#232-每次访问请求对象和响应对象都是新的">2.3.2 每次访问请求对象和响应对象都是新的</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n429"><a class="md-toc-inner" href="#233-线程安全问题">2.3.3 线程安全问题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n437"><a class="md-toc-inner" href="#24-load-on-startup">2.4 load-on-startup</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n448"><a class="md-toc-inner" href="#25-在web访问任何资源都是在访问servlet">2.5 在web访问任何资源都是在访问Servlet</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n462"><a class="md-toc-inner" href="#3-servletconfig对象">3. ServletConfig对象</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n463"><a class="md-toc-inner" href="#31servletconfig对象有什么用">3.1ServletConfig对象有什么用？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n469"><a class="md-toc-inner" href="#32获取webxml文件配置的参数信息">3.2获取web.xml文件配置的参数信息</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n479"><a class="md-toc-inner" href="#4-servletcontext对象">4. ServletContext对象</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n480"><a class="md-toc-inner" href="#41-什么是servletcontext对象">4.1 什么是ServletContext对象？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n482"><a class="md-toc-inner" href="#42-servletcontext有什么用">4.2 ServletContext有什么用？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n493"><a class="md-toc-inner" href="#43-servlet之间实现通讯">4.3 Servlet之间实现通讯</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n504"><a class="md-toc-inner" href="#44-获取web站点配置的信息">4.4 获取web站点配置的信息</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n518"><a class="md-toc-inner" href="#45-读取资源文件">4.5 读取资源文件</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n519"><a class="md-toc-inner" href="#读取资源第一种方式">读取资源第一种方式：</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n536"><a class="md-toc-inner" href="#读取资源第二种方式">读取资源第二种方式：</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n543"><a class="md-toc-inner" href="#读取资源第三种方式">读取资源第三种方式：</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2011"><a class="md-toc-inner" href="#response对象">Response对象</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2012"><a class="md-toc-inner" href="#1-responserequest对象">1. response、request对象</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2016"><a class="md-toc-inner" href="#2-什么是httpservletresponse对象">2. 什么是HttpServletResponse对象？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n2018"><a class="md-toc-inner" href="#3-httpservletresponse的应用">3. HttpServletResponse的应用</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2019"><a class="md-toc-inner" href="#31调用getoutputstream方法向浏览器输出数据">3.1调用getOutputStream()方法向浏览器输出数据</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2056"><a class="md-toc-inner" href="#32调用getwriter方法向浏览器输出数据">3.2调用getWriter()方法向浏览器输出数据</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2077"><a class="md-toc-inner" href="#33实现文件下载">3.3实现文件下载</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2099"><a class="md-toc-inner" href="#34实现自动刷新">3.4实现自动刷新</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2117"><a class="md-toc-inner" href="#35设置缓存">3.5设置缓存</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2125"><a class="md-toc-inner" href="#36实现数据压缩">3.6实现数据压缩</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2145"><a class="md-toc-inner" href="#37生出随机图片">3.7生出随机图片</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2160"><a class="md-toc-inner" href="#36重定向跳转">3.6重定向跳转</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n2176"><a class="md-toc-inner" href="#37getwriter和getoutputstream细节">3.7getWriter和getOutputStream细节</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2010"><a class="md-toc-inner" href="#request对象">Request对象</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n559"><a class="md-toc-inner" href="#1-什么是httpservletrequest">1. 什么是HttpServletRequest</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n563"><a class="md-toc-inner" href="#2-httpservletrequest常用方法">2. HttpServletRequest常用方法</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n564"><a class="md-toc-inner" href="#21-获得客户机浏览器信息">2.1 获得客户机【浏览器】信息</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n584"><a class="md-toc-inner" href="#22-获得客户机请求头">2.2 获得客户机请求头</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n592"><a class="md-toc-inner" href="#23-获得客户机请求参数客户端提交的数据">2.3 获得客户机请求参数(客户端提交的数据)</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n602"><a class="md-toc-inner" href="#3-httpservletrequest应用">3. HttpServletRequest应用</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n604"><a class="md-toc-inner" href="#31-防盗链">3.1 防盗链</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n629"><a class="md-toc-inner" href="#32表单提交数据通过post方式提交数据">3.2表单提交数据【通过post方式提交数据】</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n640"><a class="md-toc-inner" href="#34超链接方式提交数据">3.4超链接方式提交数据</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n655"><a class="md-toc-inner" href="#35解决中文乱码问题">3.5解决中文乱码问题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n706"><a class="md-toc-inner" href="#36-实现转发">3.6 实现转发</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n725"><a class="md-toc-inner" href="#37-转发的时序图">3.7 转发的时序图</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n728"><a class="md-toc-inner" href="#371请求转发的细节">3.7.1请求转发的细节</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n740"><a class="md-toc-inner" href="#38转发和重定向的区别">3.8转发和重定向的区别</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n741"><a class="md-toc-inner" href="#381实际发生位置不同地址栏不同">3.8.1实际发生位置不同，地址栏不同</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n754"><a class="md-toc-inner" href="#382用法不同">3.8.2用法不同</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n768"><a class="md-toc-inner" href="#383能够去往的url的范围不一样">3.8.3能够去往的URL的范围不一样</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n774"><a class="md-toc-inner" href="#384传递数据的类型不同">3.8.4传递数据的类型不同</a></span><span role="listitem" class="md-toc-item md-toc-h4" data-ref="n780"><a class="md-toc-inner" href="#385跳转的时间不同">3.8.5跳转的时间不同</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n786"><a class="md-toc-inner" href="#39-转发和重定向使用哪一个">3.9 转发和重定向使用哪一个？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n795"><a class="md-toc-inner" href="#310-requestdispatcher再说明">3.10 RequestDispatcher再说明</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n808"><a class="md-toc-inner" href="#cookie">Cookie</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n810"><a class="md-toc-inner" href="#1-什么是会话技术">1. 什么是会话技术</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n813"><a class="md-toc-inner" href="#2-为什么我们要使用会话技术">2. 为什么我们要使用会话技术？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n824"><a class="md-toc-inner" href="#3-cookie">3. Cookie</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n827"><a class="md-toc-inner" href="#31-什么是cookie">3.1 什么是Cookie</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n840"><a class="md-toc-inner" href="#32cookie-api">3.2Cookie API</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n863"><a class="md-toc-inner" href="#33简单使用cookie">3.3简单使用Cookie</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n878"><a class="md-toc-inner" href="#4cookie细节">4.Cookie细节</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n879"><a class="md-toc-inner" href="#41cookie不可跨域名性">4.1Cookie不可跨域名性</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n883"><a class="md-toc-inner" href="#42-cookie保存中文">4.2 Cookie保存中文</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n897"><a class="md-toc-inner" href="#43cookie的有效期">4.3Cookie的有效期</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n906"><a class="md-toc-inner" href="#44-cookie的修改和删除">4.4 Cookie的修改和删除</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n931"><a class="md-toc-inner" href="#45-cookie的域名">4.5 Cookie的域名</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n956"><a class="md-toc-inner" href="#46-cookie的路径">4.6 Cookie的路径</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n966"><a class="md-toc-inner" href="#47-cookie的安全属性">4.7 Cookie的安全属性</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n975"><a class="md-toc-inner" href="#5-cookie的应用">5. Cookie的应用</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n976"><a class="md-toc-inner" href="#51显示用户上次访问的时间">5.1显示用户上次访问的时间</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1009"><a class="md-toc-inner" href="#52显示上次浏览过商品">5.2显示上次浏览过商品</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1068"><a class="md-toc-inner" href="#session">Session</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1069"><a class="md-toc-inner" href="#1-什么是session">1. 什么是Session</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1074"><a class="md-toc-inner" href="#2-为什么要使用session技术">2. 为什么要使用Session技术？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1077"><a class="md-toc-inner" href="#3-session--api">3. Session  API</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1103"><a class="md-toc-inner" href="#4session作为域对象">4.Session作为域对象</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1114"><a class="md-toc-inner" href="#5-session的生命周期和有效期">5. Session的生命周期和有效期</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1136"><a class="md-toc-inner" href="#6-使用session完成简单的购物功能">6. 使用Session完成简单的购物功能</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1150"><a class="md-toc-inner" href="#7session的实现原理">7.Session的实现原理</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1178"><a class="md-toc-inner" href="#8浏览器禁用了cookiesession还能用吗">8.浏览器禁用了Cookie，Session还能用吗？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1210"><a class="md-toc-inner" href="#9session禁用cookie">9.Session禁用Cookie</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1222"><a class="md-toc-inner" href="#10session案例">10.Session案例</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1223"><a class="md-toc-inner" href="#101使用session完成用户简单登陆">10.1使用Session完成用户简单登陆</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1241"><a class="md-toc-inner" href="#102利用session防止表单重复提交">10.2利用Session防止表单重复提交</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1314"><a class="md-toc-inner" href="#103一次性校验码">10.3一次性校验码</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1343"><a class="md-toc-inner" href="#11-session和cookie的区别">11. Session和Cookie的区别</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1390"><a class="md-toc-inner" href="#12-cookie和session共同使用">12. Cookie和Session共同使用</a></span><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n1407"><a class="md-toc-inner" href="#servlet面试题">Servlet面试题</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1413"><a class="md-toc-inner" href="#1-tomcat常见面试题">1. Tomcat常见面试题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1415"><a class="md-toc-inner" href="#11tomcat的缺省端口是多少怎么修改">1.1Tomcat的缺省端口是多少，怎么修改</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1434"><a class="md-toc-inner" href="#12tomcat-有哪几种connector-运行模式优化">1.2Tomcat 有哪几种Connector 运行模式(优化)？</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n1458"><a class="md-toc-inner" href="#2servlet面试题">2.Servlet面试题</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1459"><a class="md-toc-inner" href="#21servlet生命周期">2.1Servlet生命周期</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1489"><a class="md-toc-inner" href="#22get方式和post方式有何区别">2.2get方式和post方式有何区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1520"><a class="md-toc-inner" href="#23forward和redirect的区别">2.3forward和redirect的区别</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1586"><a class="md-toc-inner" href="#24-tomcat容器是如何创建servlet类实例用到了什么原理">2.4 tomcat容器是如何创建servlet类实例？用到了什么原理？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1596"><a class="md-toc-inner" href="#25什么是cookiesession和cookie有什么区别-">2.5什么是cookie？Session和cookie有什么区别 ？</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n1651"><a class="md-toc-inner" href="#26-servlet安全性问题">2.6 Servlet安全性问题</a></span></p></div><h1><a name="前言" class="md-header-anchor"></a><span>前言</span></h1><p><span>这个文档的内容</span><strong><span>纯手打</span></strong><span>，如果想要看更多的干货文章，关注我的公众号：</span><strong><span>Java3y</span></strong><span>。有更多的原创技术文章和干货！</span></p><p>&nbsp;</p><p><span>目前疯狂处于</span><strong><span>疯狂</span></strong><span>更新PDF中，只要是Java后端的知识，都会有！</span><strong><span>欢迎来我公众号催更！</span></strong><span>微信搜索：</span><strong><span>Java3y</span></strong></p><p>&nbsp;</p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！公众号有我的</span><strong><span>联系方式</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><ul><li><span>🔥</span><strong><span>Java精美脑图</span></strong></li><li><span>🔥</span><strong><span>Java学习路线</span></strong></li><li><span>🔥</span><strong><span>开发常用工具</span></strong></li><li><span>🔥</span><strong><span>精美电子书、文档</span></strong></li></ul><p><span>在公众号下回复「</span><strong><span>888</span></strong><span>」即可获取！！</span></p><p>&nbsp;</p><p><strong><span>学习不能盲目，跟着我，会让你事半功倍</span></strong></p><p>&nbsp;</p><p><strong><span>文档允许随意传播，但不能修改任何内容。</span></strong></p><p>&nbsp;</p><p><span>电子书的整理也是挺不容易，如果你觉得有帮助，想要打赏作者，那么可以通过这个收款码打赏我，</span><strong><span>金额不重要，心意最重要</span></strong><span>。主要是我可以通过这个打赏情况来预计大家对这本电子书的评价，嘻嘻</span></p><p>&nbsp;</p><p><img src='https://tva1.sinaimg.cn/large/00831rSTly1gcuu0j4wwqj30u014qako.jpg' width=200px height=200px /><img src='https://tva1.sinaimg.cn/large/00831rSTly1gcuuckh3s4j30rc0yo7jr.jpg' width=200px height=200px /></p><p>&nbsp;</p><h1><a name="tomcat" class="md-header-anchor"></a><span>Tomcat</span></h1><h2><a name="1什么是tomcat" class="md-header-anchor"></a><span>1.什么是Tomcat</span></h2><p><span>Tomcat简单的说就是一个运行JAVA的网络服务器，底层是Socket的一个程序，它也是JSP和Serlvet的一个容器。</span></p><h2><a name="2为什么我们需要用到tomcat" class="md-header-anchor"></a><span>2.为什么我们需要用到Tomcat </span></h2><p><span>如果你学过html，css，你会知道你写的页面只能自己访问，</span><strong><span>别人不能远程访问你写的页面</span></strong><span>，Tomcat就是</span><strong><span>提供能够让别人访问自己写的页面的一个程序</span></strong></p><p><img src="http://i.imgur.com/wIpjX5Z.png" referrerpolicy="no-referrer"></p><hr /><h2><a name="3配置tomcat" class="md-header-anchor"></a><span>3.配置Tomcat </span></h2><p><span>运行Tomcat需要JDK的支持【Tomcat会通过JAVA_HOME找到所需要的JDK】。</span></p><p><span>新建JAVA_HOME环境变量【路径是JDK的主目录】</span></p><p><img src="http://i.imgur.com/QrN132z.png" referrerpolicy="no-referrer"></p><p><span>进入Tomcat目录下的bin中启动startup.bat，以下是成功启动Tomcat的页面。</span></p><p><img src="http://i.imgur.com/H0IWVRQ.png" referrerpolicy="no-referrer"></p><p><span>在浏览器地址栏输入</span><a href='http://localhost:8080' target='_blank' class='url'>http://localhost:8080</a><span>,如果能够出现Tomcat页面，说明配置成功了。</span></p><p><strong><span>注意：</span></strong><span>如果在使用Tomcat时出现了</span><code>Error deploying web application directory web222</code><span>,很大原因就是jdk和tomcat的版本不匹配。</span></p><p><span>目前，</span><strong><span>jdk8不能匹配tomcat7.0</span></strong><span>，所以</span><strong><span>要降低jdk版本</span></strong><span>【换成JDK7】</span></p><p><span>当然也有可能不是一帆风顺能够直接启动Tomcat，</span><strong><span>不能正常启动Tomcat会有以下情况</span></strong></p><ol start='' ><li><p><span>JAVA_HOME配置错误</span></p></li><li><p><span>端口被占用了</span></p><ul><li><span>第一种方法：在cmd输入netstat -anb查看谁占用了该端口【Tomcat默认的是8080】,在进程中关闭它</span></li><li><span>第二种方法：主动改变tomcat的端口, </span><strong><span>到tomcat主目录下的conf/server.xml文件中修改</span></strong><span>,把8080端口改成是8088或者是其他的</span></li></ul></li></ol><p><img src="http://i.imgur.com/TGhqQ9r.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="4相关术语介绍" class="md-header-anchor"></a><span>4.相关术语介绍 </span></h2><p><img src="http://i.imgur.com/gi93vVx.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="5tomcat结构目录" class="md-header-anchor"></a><span>5.tomcat结构目录</span></h2><p><img src="http://i.imgur.com/duCr7vO.png" referrerpolicy="no-referrer"></p><h3><a name="51目录的简单介绍" class="md-header-anchor"></a><span>5.1目录的简单介绍</span></h3><ol start='' ><li><p><span>bin：启动和关闭tomcat的bat文件</span></p></li><li><p><span>conf：配置文件</span></p><ul><li><code>server.xml</code><span>该文件用于配置server相关的信息，比如tomcat启动的端口号，配置主机(Host)</span></li><li><code>web.xml</code><span>文件配置与web应用（web应用相当于一个web站点）</span></li><li><code>tomcat-user.xml</code><span>配置用户名密码和相关权限.</span></li></ul></li><li><p><span>lib：该目录放置运行tomcat运行需要的jar包</span></p></li><li><p><span>logs：存放日志，当我们需要查看日志的时候，可以查询信息</span></p></li><li><p><span>webapps：放置我们的web应用</span></p></li><li><p><span>work工作目录：该目录用于存放</span><strong><span>jsp被访问后生成对应的server文件和.class文件</span></strong><span> </span></p></li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmqukanpg30640643zd.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="52webapps目录的详细说明" class="md-header-anchor"></a><span>5.2webapps目录的详细说明</span></h3><p><span>在webapps中建立了web1目录，下面放置我们的html文件，jsp文件，图片等等，</span><strong><span>则web1就被当做web应用管理起来</span></strong><span>【tomcat6.0以后的版本才支持】</span></p><p><span>例子：</span><strong><span>在webapps下创建一个web站点，在web站点下创建一个html文件，访问html文件</span></strong></p><p><img src="http://i.imgur.com/PDRNul3.png" referrerpolicy="no-referrer"></p><p><span>web站点的目录是有规范的</span>
<img src="http://i.imgur.com/HGtlKI7.png" referrerpolicy="no-referrer"></p><p><span>为什么要这样设置web站点目录呢？</span></p><ul><li><span>需求：我有多个html文件，想把其中的一个html文件作为我web站点的首页。</span></li><li><span>如果</span><strong><span>没有WEB-INF目录下的web.xml文件支持，是无法解决我的需求的</span></strong></li><li><strong><span>这个规范是约定熟成的。</span></strong></li></ul><p><span>下面将web站点下的helloword2.xml文件作为站点的首页，新建一个WEB-INF目录</span></p><p><img src="http://i.imgur.com/gDZieAX.png" referrerpolicy="no-referrer"></p><p><span>在WEB-INF目录下创建一个web.xml</span></p><p><img src="http://i.imgur.com/GbKWbuf.png" referrerpolicy="no-referrer"></p><p><span>web.xml我们不可能会写，所以可以</span><strong><span>在webapps目录下其他的站点中抄一份过来</span></strong><span>【复制ROOT/WEB-INF/web.xml的文件到自己的站点中】</span></p><p><span>在web.xml中添加以下代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">welcome-file-list</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">welcome-file</span><span class="cm-tag cm-bracket">&gt;</span>helloword2.html<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">welcome-file</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">welcome-file-list</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="http://i.imgur.com/hA0wTmd.png" referrerpolicy="no-referrer"></p><p><span>访问web站点【</span><strong><span>helloword2.html已经是web站点的首页了，所以不需要指定资源访问了</span></strong><span>】</span></p><p><img src="http://i.imgur.com/QhYi5eu.png" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmr7fsc1j3073073aa5.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="6配置虚拟目录" class="md-header-anchor"></a><span>6.配置虚拟目录</span></h2><h3><a name="61为什么需要配置虚拟目录" class="md-header-anchor"></a><span>6.1为什么需要配置虚拟目录？</span></h3><ul><li><span>如果把所有web站点的目录都放在webapps下，可能导致</span><strong><span>磁盘空间不够用</span></strong><span>，也</span><strong><span>不利于对web站点目录的管理</span></strong><span>【如果存在非常多的web站点目录】</span></li><li><span>把</span><strong><span>web站点的目录分散到其他磁盘管理就需要配置虚拟目录【默认情况下，只有webapps下的目录才能被Tomcat自动管理成一个web站点】</span></strong></li><li><span>把web应用所在目录交给web服务器管理，这个过程称之为虚拟目录的映射</span></li></ul><h3><a name="62配置虚拟目录方法一" class="md-header-anchor"></a><span>6.2配置虚拟目录方法一</span></h3><p><span>在其他盘符下创建一个web站点目录，并创建WEB-INF目录和一个html文件。</span></p><p><img src="http://i.imgur.com/soEm66y.png" referrerpolicy="no-referrer"></p><p><span>找到Tomcat目录下/conf/server.xml文件</span></p><p><img src="http://i.imgur.com/EKCpTZZ.png" referrerpolicy="no-referrer"></p><p><span>在server.xml中的</span><code>&lt;Host&gt;</code><span>节点下添加如下代码。</span><strong><span>path表示的是访问时输入的web项目名，docBase表示的是站点目录的绝对路径</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Context</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/web1"</span> <span class="cm-attribute">docBase</span>=<span class="cm-string">"D:\web1"</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><img src="http://i.imgur.com/kKI4C9d.png" referrerpolicy="no-referrer"></p><p><span>访问配置好的web站点</span></p><p><img src="http://i.imgur.com/z1cqe2G.png" referrerpolicy="no-referrer"></p><hr /><h3><a name="63配置虚拟目录方法二" class="md-header-anchor"></a><span>6.3配置虚拟目录方法二</span></h3><p><span>进入到conf\Catalina\localhost文件下，创建一个xml文件，</span><strong><span>该文件的名字就是站点的名字。</span></strong>
<span>  </span><img src="http://img.blog.csdn.net/20170114100701752?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaG9uXzN5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" referrerpolicy="no-referrer" alt="这里写图片描述"></p><p><span>xml文件的代码如下，</span><strong><span>docBase是你web站点的绝对路径</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">&lt;?xml</span> <span class="cm-meta">version="1.0" encoding="UTF-8"?&gt;</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Context</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-attribute">docBase</span>=<span class="cm-string">"D:\web1"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-attribute">reloadable</span>=<span class="cm-string">"true"</span><span class="cm-tag cm-bracket">&gt;</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">Context</span><span class="cm-tag cm-bracket">&gt;</span> </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>访问web站点下的html资源</span></p><p><img src="http://img.blog.csdn.net/20170114104403810?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaG9uXzN5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="7配置临时域名" class="md-header-anchor"></a><span>7.配置临时域名</span></h2><p><span>访问Tomcat服务器有好几种方式</span></p><ul><li><span>使用localhost域名访问【localhost代表本机】</span></li><li><span>使用ip地址127.0.0.1访问【该ip地址也是本机】</span></li><li><span>使用机器名称访问【只限用于本机上或者局域网】</span></li><li><span>使用本机IP地址访问【</span><strong><span>在cmd中输入ipconfig可以查询到本机IP地址</span></strong><span>】</span></li><li><span>还可以为机器配置临时域名</span></li></ul><h3><a name="71配置临时域名步骤" class="md-header-anchor"></a><span>7.1配置临时域名步骤</span></h3><ul><li><span>打开到C:\Windows\System32\drivers\etc下，找到hosts文件</span></li></ul><p><img src="http://i.imgur.com/ENqdMf9.png" referrerpolicy="no-referrer"></p><ul><li><span>在hosts文件下配置临时域名</span></li></ul><p><img src="http://i.imgur.com/gdxSl2I.png" referrerpolicy="no-referrer"></p><hr /><h2><a name="8设置虚拟主机" class="md-header-anchor"></a><span>8.设置虚拟主机</span></h2><h3><a name="81什么是虚拟主机" class="md-header-anchor"></a><span>8.1什么是虚拟主机？</span></h3><p><strong><span>多个不同域名的网站共存于一个Tomcat中</span></strong></p><h3><a name="82为什么需要用到虚拟主机" class="md-header-anchor"></a><span>8.2为什么需要用到虚拟主机？</span></h3><p><span>例子：我现在开发了4个网站，有4个域名。如果我不配置虚拟主机，一个Tomcat服务器运行一个网站，我就需要4台电脑才能把4个网站运行起来。</span></p><h3><a name="83配置虚拟主机的步骤" class="md-header-anchor"></a><span>8.3配置虚拟主机的步骤</span></h3><ul><li><span>在tomcat的server.xml文件中添加主机名</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Host</span> <span class="cm-attribute">name</span>=<span class="cm-string">"zhongfucheng"</span> <span class="cm-attribute">appBase</span>=<span class="cm-string">"D:\web1"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Context</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/web1"</span> <span class="cm-attribute">docBase</span>=<span class="cm-string">"D:\web1"</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">Host</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="http://i.imgur.com/U71stln.png" referrerpolicy="no-referrer"></p><p><span>访问虚拟主机下的web站点</span></p><p><img src="http://i.imgur.com/3uVfXXs.png" referrerpolicy="no-referrer"></p><hr /><h2><a name="9tomcat体系结构" class="md-header-anchor"></a><span>9.Tomcat体系结构</span></h2><p><img src="http://i.imgur.com/R5u6kUj.png" referrerpolicy="no-referrer"></p><hr /><h2><a name="10浏览器访问web资源的流程图" class="md-header-anchor"></a><span>10.浏览器访问WEB资源的流程图</span></h2><p><img src="http://i.imgur.com/blYhhtW.png" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmrl1ylng306o06oq3t.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="11练习" class="md-header-anchor"></a><span>11.练习</span></h2><p><span>在浏览器输入</span><code>http//:zhongfucheng</code><span>直接显示到页面</span></p><p><span>分析：</span></p><ol start='' ><li><span>需要配置虚拟主机</span></li><li><span>把8080端口改成80</span></li><li><span>设置web站点首页</span></li><li><span>映射虚拟目录为/</span></li></ol><p><img src="http://i.imgur.com/oQcef60.png" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnythvd93j307806qglo.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h1><a name="servlet基础知识" class="md-header-anchor"></a><span>Servlet基础知识</span></h1><h2><a name="1什么是servlet" class="md-header-anchor"></a><span>1.什么是Servlet？</span></h2><p><span>Servlet其实就是一个</span><strong><span>遵循Servlet开发的java类</span></strong><span>。Servlet是</span><strong><span>由服务器调用的</span></strong><span>，</span><strong><span>运行在服务器端</span></strong><span>。</span></p><h2><a name="2为什么要用到servlet" class="md-header-anchor"></a><span>2.为什么要用到Servlet？</span></h2><p><span>我们编写java程序想要在网上实现 聊天、发帖、这样一些的交互功能，</span><strong><span>普通的java技术是非常难完成的</span></strong><span>。sun公司就提供了Servlet这种技术供我们使用。</span></p><h2><a name="3http协议" class="md-header-anchor"></a><span>3.HTTP协议</span></h2><h3><a name="31什么是htpp协议" class="md-header-anchor"></a><span>3.1什么是HTPP协议</span></h3><blockquote><p><span>超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。所有的WWW文件都必须遵守这个标准。它是TCP/IP协议的一个</span><strong><span>应用层协议</span></strong></p></blockquote><p><span>简单来说，</span><strong><span>HTTP协议就是客户端和服务器交互的一种通迅的格式</span></strong><span>。</span></p><p><span>例子:在浏览器点击一个链接，浏览器就为我打开这个链接的网页。</span></p><p><span>原理：当在浏览器中点击这个链接的时候，</span><strong><span>浏览器会向服务器发送一段文本</span></strong><span>，</span><strong><span>告诉服务器请求打开的是哪一个网页。服务器收到请求后，就返回一段文本给浏览器，浏览器会将该文本解析，然后显示出来。</span></strong><span>这段文本就是遵循HTTP协议规范的。</span></p><h3><a name="32http10和http11的区别" class="md-header-anchor"></a><span>3.2HTTP1.0和HTTP1.1的区别</span></h3><p><span>HTTP1.0协议中，客户端与web服务器建立连接后，只能获得一个web资源【短连接，获取资源后就断开连接】</span></p><p><span>HTTP1.1协议，允许客户端与web服务器建立连接后，在一个连接上获取多个web资源【保持连接】</span></p><h3><a name="33http请求" class="md-header-anchor"></a><span>3.3HTTP请求</span></h3><p><strong><span>浏览器向服务器请求某个web资源时，称之为浏览器向服务器发送了一个http请求。</span></strong></p><p><span>一个完整http请求应该包含三个部分：</span></p><ol start='' ><li><span>请求行【描述客户端的</span><strong><span>请求方式</span></strong><span>、</span><strong><span>请求的资源名称</span></strong><span>，以及使用的</span><strong><span>HTTP协议版本号</span></strong><span>】</span></li><li><span>多个消息头【描述客户端请求哪台主机，以及</span><strong><span>客户端的一些环境信息</span></strong><span>等】</span></li><li><span>一个空行</span></li></ol><h4><a name="331请求行" class="md-header-anchor"></a><span>3.3.1请求行</span></h4><p><span>请求行：GET /java.html HTTP/1.1</span></p><p><strong><span>请求行中的GET称之为请求方式</span></strong><span>，请求方式有：POST,GET,HEAD,OPTIONS,DELETE,TRACE,PUT。</span></p><p><strong><span>常用的有：POST,GET</span></strong></p><p><span>一般来说，当我们</span><strong><span>点击超链接，通过地址栏访问都是get请求方式</span></strong><span>。通过</span><strong><span>表单提交的数据一般是post方式</span></strong><span>。</span></p><p><span>可以简单理解</span><strong><span>GET方式用来查询数据</span></strong><span>,</span><strong><span>POST方式用来提交数据</span></strong><span>，</span><strong><span>get的提交速度比post快</span></strong></p><p><span>GET方式：在URL地址后</span><strong><span>附带的参数是有限制的</span></strong><span>，其</span><strong><span>数据容量通常不能超过1K</span></strong><span>。</span></p><p><span>POST方式：可以在</span><strong><span>请求的实体内容中向服务器发送数据</span></strong><span>，</span><strong><span>传送的数据量无限制</span></strong><span>。</span></p><h4><a name="332请求头" class="md-header-anchor"></a><span>3.3.2请求头</span></h4><ul><li><span>Accept: text/html,image/*    【浏览器告诉服务器，它支持的数据类型】</span></li><li><span>Accept-Charset: ISO-8859-1</span><span>	</span><span>【浏览器告诉服务器，它支持哪种</span><strong><span>字符集</span></strong><span>】</span></li><li><span>Accept-Encoding: gzip,compress 【浏览器告诉服务器，它支持的</span><strong><span>压缩格式</span></strong><span>】</span></li><li><span>Accept-Language: en-us,zh-cn 【浏览器告诉服务器，它的语言环境】</span></li><li><span>Host: </span><a href='www.it315.org:80' target='_blank' class='url'>www.it315.org:80</a><span>【浏览器告诉服务器，它的想访问哪台主机】</span></li><li><span>If-Modified-Since: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，缓存数据的时间】</span></li><li><span>Referer: </span><a href='http://www.it315.org/index.jsp' target='_blank' class='url'>http://www.it315.org/index.jsp</a><span>【浏览器告诉服务器，客户机是从那个页面来的---</span><strong><span>反盗链</span></strong><span>】</span></li><li><span>8.User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0)【浏览器告诉服务器，浏览器的内核是什么】</span></li><li><span>Cookie【浏览器告诉服务器，</span><strong><span>带来的Cookie是什么</span></strong><span>】</span></li><li><span>Connection: close/Keep-Alive  【浏览器告诉服务器，请求完后是断开链接还是保持链接】 </span></li><li><span>Date: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，请求的时间】 </span></li></ul><h3><a name="34http响应" class="md-header-anchor"></a><span>3.4HTTP响应</span></h3><p><span>一个HTTP响应代表着</span><strong><span>服务器向浏览器回送数据</span></strong></p><p><span>一个完整的HTTP响应应该包含四个部分:</span></p><ol start='' ><li><span>一个状态行【用于描述</span><strong><span>服务器对请求的处理结果。</span></strong><span>】</span></li><li><span>多个消息头【用于描述</span><strong><span>服务器的基本信息</span></strong><span>，以及</span><strong><span>数据的描述</span></strong><span>，</span><strong><span>服务器通过这些数据的描述信息，可以通知客户端如何处理等一会儿它回送的数据</span></strong><span>】</span></li><li><span>一个空行</span></li><li><span>实体内容【</span><strong><span>服务器向客户端回送的数据</span></strong><span>】</span></li></ol><h4><a name="341状态行" class="md-header-anchor"></a><span>3.4.1状态行</span></h4><p><span>格式： HTTP版本号　状态码　原因叙述</span></p><p><span>状态行：HTTP/1.1  200    OK</span></p><p><span>状态码用于表示</span><strong><span>服务器对请求的处理结果</span></strong><span>，它是一个</span><strong><span>三位的十进制数</span></strong><span>。响应状态码分为5类</span></p><p><img src="http://i.imgur.com/9vzLcIb.png" referrerpolicy="no-referrer"></p><h4><a name="342响应头" class="md-header-anchor"></a><span>3.4.2响应头</span></h4><ul><li><span>Location: </span><a href='http://www.it315.org/index.jsp' target='_blank' class='url'>http://www.it315.org/index.jsp</a><span> 【服务器告诉浏览器</span><strong><span>要跳转到哪个页面</span></strong><span>】</span></li><li><span>Server:apache tomcat【服务器告诉浏览器，服务器的型号是什么】</span></li><li><span>Content-Encoding: gzip 【服务器告诉浏览器</span><strong><span>数据压缩的格式</span></strong><span>】</span></li><li><span>Content-Length: 80 【服务器告诉浏览器回送数据的长度】</span></li><li><span>Content-Language: zh-cn 【服务器告诉浏览器，服务器的语言环境】</span></li><li><span>Content-Type: text/html; charset=GB2312 【服务器告诉浏览器，</span><strong><span>回送数据的类型</span></strong><span>】</span></li><li><span>Last-Modified: Tue, 11 Jul 2000 18:23:51 GMT【服务器告诉浏览器该资源上次更新时间】</span></li><li><span>Refresh: 1;url=</span><a href='http://www.it315.org' target='_blank' class='url'>http://www.it315.org</a><span>【服务器告诉浏览器要</span><strong><span>定时刷新</span></strong><span>】</span></li><li><span>Content-Disposition: attachment; filename=aaa.zip【服务器告诉浏览器</span><strong><span>以下载方式打开数据</span></strong><span>】</span></li><li><span>Transfer-Encoding: chunked  【服务器告诉浏览器数据以分块方式回送】</span></li><li><span>Set-Cookie:SS=Q0=5Lb_nQ; path=/search【服务器告诉浏览器要</span><strong><span>保存Cookie</span></strong><span>】</span></li><li><span>Expires: -1【服务器告诉浏览器</span><strong><span>不要设置缓存</span></strong><span>】</span></li><li><span>Cache-Control: no-cache  【服务器告诉浏览器</span><strong><span>不要设置缓存</span></strong><span>】</span></li><li><span>Pragma: no-cache   【服务器告诉浏览器</span><strong><span>不要设置缓存</span></strong><span>】</span></li><li><span>Connection: close/Keep-Alive   【服务器告诉浏览器连接方式】</span></li><li><span>Date: Tue, 11 Jul 2000 18:23:51 GMT【服务器告诉浏览器回送数据的时间】</span></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmsw5j75j30730733yj.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="4javaweb目录结构" class="md-header-anchor"></a><span>4.JAVAWEB目录结构</span></h2><p><img src="http://i.imgur.com/HGtlKI7.png" referrerpolicy="no-referrer"></p><p><span>以上图说明：</span></p><ul><li><span>bbs目录代表一个web应用</span></li><li><span>bbs目录下的html,jsp文件可以直接被浏览器访问</span></li><li><strong><span>WEB-INF目录下的资源是不能直接被浏览器访问的</span></strong></li><li><span>web.xml文件是web程序的主要配置文件</span></li><li><span>所有的classes文件都放在classes目录下</span></li><li><span>jar文件放在lib目录下</span></li></ul><p>&nbsp;</p><h2><a name="5实现servlet接口编写servlet程序" class="md-header-anchor"></a><span>5.实现Servlet接口编写Servlet程序</span></h2><p><span>程序我都是由idea下写，首先要在idea上配置Tomcat，在我别的博文中有教程！</span></p><h3><a name="51编写servlet程序的步骤" class="md-header-anchor"></a><span>5.1编写Servlet程序的步骤</span></h3><p><span>创建一个自定义类，</span><strong><span>实现Servlet接口</span></strong></p><p><img src="http://i.imgur.com/JDEuSqN.png" referrerpolicy="no-referrer"></p><p><span>我们发现有5个方法需要重写，有init【初始化】，destroy【销毁】,service【服务】,ServletConfig【Servlet配置】,getServletInfo【Servlet信息】。</span></p><p><span>在此一看，发现service()方法是最有可能是写逻辑代码的地方。</span></p><p><span>首先写一个hellword入门先，调用ServletResponse对象的方法向浏览器输出HelloWorld</span></p><p><img src="http://i.imgur.com/wYeoE7P.png" referrerpolicy="no-referrer"></p><p><span>配置xml文件，光写了Servlet是不行的，Tomcat还要知道浏览器怎么访问这个Servlet。</span></p><p><img src="http://i.imgur.com/bmxw9ay.png" referrerpolicy="no-referrer"></p><p><span>访问自己写的Servlet程序</span></p><p><img src="http://i.imgur.com/rMxDtUm.png" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmt86of5g306o06ojt6.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="6servlet生命周期" class="md-header-anchor"></a><span>6.Servlet生命周期</span></h2><p><span>下面我们看看Servlet的生命周期</span>
<img src="http://i.imgur.com/bhBdx7o.png" referrerpolicy="no-referrer"></p><p><strong><span>第一次访问</span></strong><span>Servlet，我们发现</span><strong><span>init()和service()都被调用了</span></strong></p><p><img src="http://i.imgur.com/n12sYq6.png" referrerpolicy="no-referrer"></p><p><strong><span>第二次访问</span></strong><span>Servlet，</span><strong><span>service()被调用了</span></strong></p><p><img src="http://i.imgur.com/OK1RwD7.png" referrerpolicy="no-referrer"></p><p><span>第三次访问Servlet，</span><strong><span>还是service()被调用了</span></strong></p><p><img src="http://i.imgur.com/OK1RwD7.png" referrerpolicy="no-referrer"></p><p><span>当我们</span><strong><span>关闭Tomcat服务器</span></strong><span>的时候，</span><strong><span>destroy()被调用了！</span></strong></p><p><img src="http://i.imgur.com/XlgUU9E.png" referrerpolicy="no-referrer"></p><h3><a name="61servlet生命周期可分为5个步骤" class="md-header-anchor"></a><span>6.1Servlet生命周期可分为5个步骤</span></h3><ol start='' ><li><strong><span>加载Servlet</span></strong><span>。当Tomcat第一次访问Servlet的时候，</span><strong><span>Tomcat会负责创建Servlet的实例</span></strong></li><li><strong><span>初始化</span></strong><span>。当Servlet被实例化后，Tomcat会</span><strong><span>调用init()方法初始化这个对象</span></strong></li><li><strong><span>处理服务</span></strong><span>。当浏览器</span><strong><span>访问Servlet</span></strong><span>的时候，Servlet </span><strong><span>会调用service()方法处理请求</span></strong></li><li><strong><span>销毁</span></strong><span>。当Tomcat关闭时或者检测到Servlet要从Tomcat删除的时候会自动调用destroy()方法，</span><strong><span>让该实例释放掉所占的资源</span></strong><span>。一个Servlet如果长时间不被使用的话，也会被Tomcat自动销毁</span></li><li><strong><span>卸载</span></strong><span>。当Servlet调用完destroy()方法后，等待垃圾回收。如果</span><strong><span>有需要再次使用这个Servlet，会重新调用init()方法进行初始化操作</span></strong><span>。</span></li></ol><p>&nbsp;</p><p><span>简单总结：</span><strong><span>只要访问Servlet，service()就会被调用。init()只有第一次访问Servlet的时候才会被调用。</span>
<span>destroy()只有在Tomcat关闭的时候才会被调用。</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmtk5zjog306o06odg1.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h2><a name="7继承httpservlet编写servlet程序" class="md-header-anchor"></a><span>7.继承HttpServlet编写Servlet程序</span></h2><p><span>在上面我们实现Servlet接口，要实现5个方法。这样太麻烦了！而</span><strong><span>HttpServlet类已经实现了Servlet接口的所有方法</span></strong><span>，编写Servlet时，只需要</span><strong><span>继承HttpServlet，重写你需要的方法即可</span></strong><span>，并且它在原有Servlet接口上</span><strong><span>添加了一些与HTTP协议处理方法</span></strong><span>，它</span><strong><span>比Servlet接口的功能更为强大</span></strong><span>。</span></p><ul><li><span>一般我们开发的时候，都是</span><strong><span>重写doGet()和doPost()方法的</span></strong><span>。对于idea而言，创建Servlet的时候已经帮你重写好了</span></li></ul><p><span> </span><img src="http://i.imgur.com/Szu07ky.png" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="servletconfigservletcontext和servlet细节" class="md-header-anchor"></a><span>ServletConfig、ServletContext和Servlet细节</span></h1><h2><a name="1servlet的调用图" class="md-header-anchor"></a><span>1.Servlet的调用图</span></h2><p><span>前面我们已经学过了Servlet的生命周期了，我们根据Servlet的生命周期画出Servlet的调用图加深理解</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e947fdf140bd?w=1892&amp;h=1139&amp;f=png&amp;s=46258" referrerpolicy="no-referrer"></p><h2><a name="2servlet的细节" class="md-header-anchor"></a><span>2.Servlet的细节</span></h2><h3><a name="21-一个已经注册的servlet可以被多次映射" class="md-header-anchor"></a><span>2.1 一个已经注册的Servlet可以被多次映射</span></h3><p><strong><span>同一个Servlet可以被映射到多个URL上。</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng.web.Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>/Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>/ouzicheng<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>无论我访问的是</span><a href='http://localhost:8080/Demo1' target='_blank' class='url'>http://localhost:8080/Demo1</a><span>还是</span><a href='http://localhost:8080/ouzicheng' target='_blank' class='url'>http://localhost:8080/ouzicheng</a><span>。我访问的都是Demo1。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e947fe03642a?w=427&amp;h=174&amp;f=png&amp;s=8902" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e947ff01e623?w=427&amp;h=174&amp;f=png&amp;s=8678" referrerpolicy="no-referrer"></p><h3><a name="22-servlet映射的url可以使用通配符" class="md-header-anchor"></a><span>2.2 Servlet映射的URL可以使用通配符</span></h3><p><span>通配符有两种格式：</span></p><ol start='' ><li><code>*.</code><span>扩展名</span></li><li><span>正斜杠（/）开头并以“/*”结尾。</span></li></ol><p><strong><span>匹配所有</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e947fff867c3?w=1054&amp;h=301&amp;f=png&amp;s=24207" referrerpolicy="no-referrer"></p><p><strong><span>匹配扩展名为.jsp的</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948003a39ec?w=1015&amp;h=327&amp;f=png&amp;s=24920" referrerpolicy="no-referrer"></p><p><span>如果</span><em><span>.扩展名和正斜杠（/）开头并以“/</span></em><span>”结尾两种通配符同时出现，匹配的是哪一个呢？</span></p><ol start='' ><li><strong><span>看谁的匹配度高，谁就被选择</span></strong></li><li><code>*.</code><span>扩展名的优先级最低</span></li></ol><p><span>Servlet映射的URL可以使用通配符和Servlet可以被映射到多个URL上的作用：</span></p><ol start='' ><li><strong><span>隐藏网站是用什么编程语言写的</span></strong><span>【.php,.net,.asp实际上访问的都是同一个资源】</span></li><li><span>用特定的</span><strong><span>后缀声明版权</span></strong><span>【公司缩写】</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng.web.Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>*.jsp<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>*.net<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>*.asp<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>*.php<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmu1lb2vg306o06ojtg.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="23-servlet是单例的" class="md-header-anchor"></a><span>2.3 Servlet是单例的</span></h3><h4><a name="231-为什么servlet是单例的" class="md-header-anchor"></a><span>2.3.1 为什么Servlet是单例的</span></h4><p><strong><span>浏览器多次对Servlet的请求</span></strong><span>，一般情况下，</span><strong><span>服务器只创建一个Servlet对象</span></strong><span>，也就是说，Servlet对象</span><strong><span>一旦创建了</span></strong><span>，就会</span><strong><span>驻留在内存中，为后续的请求做服务，直到服务器关闭</span></strong><span>。</span></p><h4><a name="232-每次访问请求对象和响应对象都是新的" class="md-header-anchor"></a><span>2.3.2 每次访问请求对象和响应对象都是新的</span></h4><p><span>对于</span><strong><span>每次访问请求</span></strong><span>，Servlet引擎都会</span><strong><span>创建一个新的HttpServletRequest请求对象和一个新的HttpServletResponse响应对象</span></strong><span>，然后将这两</span><strong><span>个对象作为参数传递给它调用的Servlet的service()方法</span></strong><span>，</span><strong><span>service方法再根据请求方式分别调用doXXX方法</span></strong><span>。</span></p><h4><a name="233-线程安全问题" class="md-header-anchor"></a><span>2.3.3 线程安全问题</span></h4><p><span>当多个用户访问Servlet的时候，</span><strong><span>服务器会为每个用户创建一个线程</span></strong><span>。</span><strong><span>当多个用户并发访问Servlet共享资源的时候就会出现线程安全问题</span></strong><span>。</span></p><p><span>原则：</span></p><ol start='' ><li><span>如果一个</span><strong><span>变量需要多个用户共享</span></strong><span>，则应当在访问该变量的时候，</span><strong><span>加同步机制synchronized (对象){}</span></strong></li><li><span>如果一个变量</span><strong><span>不需要共享</span></strong><span>，则</span><strong><span>直接在 doGet() 或者 doPost()定义</span></strong><span>.这样不会存在线程安全问题</span></li></ol><h3><a name="24-load-on-startup" class="md-header-anchor"></a><span>2.4 load-on-startup</span></h3><p><span>如果在</span><code>&lt;servlet&gt;</code><span>元素中配置了一个</span><code>&lt;load-on-startup&gt;</code><span>元素，那么</span><strong><span>WEB应用程序在启动时</span></strong><span>，就会</span><strong><span>装载并创建Servlet的实例对象</span></strong><span>、以及</span><strong><span>调用Servlet实例对象的init()方法</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e94800c00ad0?w=877&amp;h=263&amp;f=png&amp;s=11470" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948411372c5?w=1920&amp;h=1040&amp;f=png&amp;s=104483" referrerpolicy="no-referrer"></p><p><span>作用：</span></p><ol start='' ><li><span>为web应用写一个InitServlet，这个</span><strong><span>servlet配置为启动时装载</span></strong><span>，为整个web应用</span><strong><span>创建必要的数据库表和数据</span></strong></li><li><span>完成一些定时的任务【定时写日志，定时备份数据】</span></li></ol><hr /><h3><a name="25-在web访问任何资源都是在访问servlet" class="md-header-anchor"></a><span>2.5 在web访问任何资源都是在访问Servlet</span></h3><p><span>当你启动Tomcat，你在网址上输入</span><a href='http://localhost:8080' target='_blank' class='url'>http://localhost:8080</a><span>。为什么会出现Tomcat小猫的页面？</span></p><p><span>这是由</span><strong><span>缺省Servlet为你服务的</span></strong><span>！</span></p><p><span>我们先看一下web.xml文件中的配置,</span><strong><span>web.xml文件配置了一个缺省Servlet</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>default<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span>debug<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span>listings<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span>false<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">load-on-startup</span><span class="cm-tag cm-bracket">&gt;</span>1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">load-on-startup</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>default<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>/<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><span>什么叫做缺省Servlet？凡是在web.xml文件中</span><strong><span>找不到匹配的</span><servlet-mapping><span>元素的URL</span></strong><span>，它们的访问</span><strong><span>请求都将交给缺省Servlet处理</span></strong><span>，也就是说，</span><strong><span>缺省Servlet用于处理所有其他Servlet都不处理的访问请求</span></strong></p><p><span>既然我说了在web访问任何资源都是在访问Servlet，那么</span><strong><span>我访问静态资源【本地图片，本地HTML文件】也是在访问这个缺省Servlet【DefaultServlet】</span></strong></p><p><span>证实一下：当我没有手工配置缺省Servlet的时候，</span><strong><span>访问本地图片是可以访问得到的</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e94841591076?w=827&amp;h=488&amp;f=png&amp;s=685816" referrerpolicy="no-referrer"></p><p><span>现在我自己配置一个缺省Servlet,</span><strong><span>Demo1就是我手工配置的缺省Servlet，覆盖掉web.xml配置的缺省Servlet</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng.web.Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>/<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>下面我继续访问一下刚才的图片，此时输出的是</span><strong><span>Demo1这个Servlet写上的内容了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e94841d559d3?w=827&amp;h=488&amp;f=png&amp;s=13993" referrerpolicy="no-referrer"></p><p><span>总结：</span><strong><span>无论在web中访问什么资源【包括JSP】，都是在访问Servlet。</span></strong><span>没有手工配置缺省Servlet的时候，</span><strong><span>你访问静态图片，静态网页，缺省Servlet会在你web站点中寻找该图片或网页</span></strong><span>，如果有就返回给浏览器，没有就报404错误</span></p><h2><a name="3-servletconfig对象" class="md-header-anchor"></a><span>3. ServletConfig对象</span></h2><h3><a name="31servletconfig对象有什么用" class="md-header-anchor"></a><span>3.1ServletConfig对象有什么用？</span></h3><blockquote><p><span>通过此对象可以读取web.xml中配置的初始化参数。</span></p></blockquote><p><span>现在问题来了，</span><strong><span>为什么我们要把参数信息放到web.xml文件中呢</span></strong><span>？我们可以直接在程序中都可以定义参数信息，</span><strong><span>搞到web.xml文件中又有什么好处呢</span></strong><span>？</span></p><p><span>好处就是：</span><strong><span>能够让你的程序更加灵活</span></strong><span>【更换需求，更改配置文件web.xml即可，程序代码不用改】</span></p><h3><a name="32获取webxml文件配置的参数信息" class="md-header-anchor"></a><span>3.2获取web.xml文件配置的参数信息</span></h3><ul><li><span>为Demo1这个Servlet配置一个参数，参数名是name，值是zhongfucheng</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng.web.Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-class</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span>name<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">init-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span>Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span>/Demo1<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">url-pattern</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">servlet-mapping</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>在Servlet中获取ServletConfig对象，通过ServletConfig对象获取在web.xml文件配置的参数</span>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e9484b3adc1e?w=1693&amp;h=555&amp;f=png&amp;s=39352" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyv09urzj30730733ye.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h2><a name="4-servletcontext对象" class="md-header-anchor"></a><span>4. ServletContext对象</span></h2><h3><a name="41-什么是servletcontext对象" class="md-header-anchor"></a><span>4.1 什么是ServletContext对象？</span></h3><p><span>当Tomcat启动的时候，就会创建一个ServletContext对象。它</span><strong><span>代表着当前web站点</span></strong></p><h3><a name="42-servletcontext有什么用" class="md-header-anchor"></a><span>4.2 ServletContext有什么用？</span></h3><ol start='' ><li><span>ServletContext既然代表着当前web站点，那么</span><strong><span>所有Servlet都共享着一个ServletContext对象</span></strong><span>，所以</span><strong><span>Servlet之间可以通过ServletContext实现通讯</span></strong><span>。</span></li><li><span>ServletConfig获取的是配置的是单个Servlet的参数信息，</span><strong><span>ServletContext可以获取的是配置整个web站点的参数信息</span></strong></li><li><strong><span>利用ServletContext读取web站点的资源文件</span></strong></li><li><span>实现Servlet的转发【用ServletContext转发不多，主要用request转发】</span></li></ol><h3><a name="43-servlet之间实现通讯" class="md-header-anchor"></a><span>4.3 Servlet之间实现通讯</span></h3><p><span>ServletContext对象可以被称之为</span><strong><span>域对象</span></strong></p><p><span>到这里可能有一个疑问，域对象是什么呢？其实域对象可以简单理解成</span><strong><span>一个容器【类似于Map集合】</span></strong></p><p><span>实现Servlet之间通讯就要</span><strong><span>用到ServletContext的setAttribute(String name,Object obj)方法</span></strong><span>，</span>
<span>第一个参数是关键字，第二个参数是你要存储的对象</span></p><p><span>这是Demo2的代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-string">"zhongfucheng"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//MyName作为关键字，value作为值存进 &nbsp; 域对象【类型于Map集合】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">servletContext</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"MyName"</span>, <span class="cm-variable">value</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>这是Demo3的代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过关键字获取存储在域对象的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">servletContext</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"MyName"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">value</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>访问Demo3可以获取Demo2存储的信息，从而实现多个Servlet之间通讯</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e9484b605e94?w=1319&amp;h=275&amp;f=png&amp;s=27120" referrerpolicy="no-referrer"></p><h3><a name="44-获取web站点配置的信息" class="md-header-anchor"></a><span>4.4 获取web站点配置的信息</span></h3><p><span>如果我想要让所有的Servlet都能够获取到连接数据库的信息，不可能在web.xml文件中每个Servlet中都配置一下，这样代码量太大了！并且会显得非常啰嗦冗余。</span></p><ul><li><span>web.xml文件支持</span><strong><span>对整个站点进行配置参数信息</span></strong><span>【</span><strong><span>所有Servlet都可以取到该参数信息</span></strong><span>】</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">context-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span>name<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-name</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span>zhongfucheng<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">param-value</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">context-param</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>Demo4代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过名称获取值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">servletContext</span>.<span class="cm-variable">getInitParameter</span>(<span class="cm-string">"name"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">value</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948749a9dbc?w=1146&amp;h=230&amp;f=png&amp;s=18861" referrerpolicy="no-referrer"></p><p><span>试一下Demo3是否能拿到，相同的代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过名称获取值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">servletContext</span>.<span class="cm-variable">getInitParameter</span>(<span class="cm-string">"name"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">value</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e94875967f95?w=1112&amp;h=277&amp;f=png&amp;s=22286" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnmugj4irg306o06owfz.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="45-读取资源文件" class="md-header-anchor"></a><span>4.5 读取资源文件</span></h3><h4><a name="读取资源第一种方式" class="md-header-anchor"></a><span>读取资源第一种方式：</span></h4><p><strong><span>第一种方式：</span></strong><span>现在我要通过Servlet111读取1.png图片</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e9487b7aae06?w=474&amp;h=248&amp;f=png&amp;s=5871" referrerpolicy="no-referrer"></p><p><span>按我们以前的方式，代码应该是这样的。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FileInputStream</span> <span class="cm-variable">fileInputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileInputStream</span>(<span class="cm-string">"1.png"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">fileInputStream</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>当我们访问的时候，却出错了！说</span><strong><span>找不到1.png文件</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e9488072c2b8?w=980&amp;h=579&amp;f=png&amp;s=33498" referrerpolicy="no-referrer"></p><p><span>这是为什么呢？我们</span><strong><span>以前读取文件的时候，如果程序和文件在同一包名，可以直接通过文件名称获取得到的</span></strong><span>！，原因很简单，</span><strong><span>以前我们写的程序都是通过JVM来运行的，而现在，我们是通过Tomcat来运行的</span></strong></p><p><span>根据web的目录规范，Servlet编译后的class文件是存放在WEB-INF\classes文件夹中的</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948b0d81e08?w=471&amp;h=434&amp;f=png&amp;s=9837" referrerpolicy="no-referrer"></p><p><span>看到这里，我们知道了</span><strong><span>要进入classes目录中读取文件</span></strong><span>，所以我们将代码改成以下方式</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FileInputStream</span> <span class="cm-variable">fileInputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileInputStream</span>(<span class="cm-string">"D:\\zhongfucheng\\web\\WEB-INF\\classes\\zhongfucheng\\web\\1.png"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">fileInputStream</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>再去读取时，就发现可以获取到文件了。但是现在问题又来了，</span><strong><span>我读取文件的时候都要写上绝对路径，这样太不灵活了</span></strong><span>。试想一下，如果我将该</span><strong><span>读取文件的模块移到其他的web站点上</span></strong><span>，</span><strong><span>我的代码就又要修改了【因为web站点的名字不一样】</span></strong><span>。</span></p><p><span>我们通过</span><strong><span>ServletContext读取就可以避免修改代码的情况</span></strong><span>，因为ServletContext对象是根据当前web站点而生成的</span></p><p><span>代码如下所示：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//调用ServletContext方法获取到读取文件的流</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">InputStream</span> <span class="cm-variable">inputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">servletContext</span>.<span class="cm-variable">getResourceAsStream</span>(<span class="cm-string">"/WEB-INF/classes/zhongfucheng/web/1.png"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948955f6ede?w=1388&amp;h=245&amp;f=png&amp;s=21417" referrerpolicy="no-referrer"></p><h4><a name="读取资源第二种方式" class="md-header-anchor"></a><span>读取资源第二种方式：</span></h4><p><span>如果我的</span><strong><span>文件放在web目录下</span></strong><span>，那么就简单得多了！,</span><strong><span>直接通过文件名称就能获取</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948afdbc2d7?w=466&amp;h=559&amp;f=png&amp;s=6164" referrerpolicy="no-referrer"></p><p><span>代码如下所示</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到ServletContext对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletContext</span> <span class="cm-variable">servletContext</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//调用ServletContext方法获取到读取文件的流</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">InputStream</span> <span class="cm-variable">inputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">servletContext</span>.<span class="cm-variable">getResourceAsStream</span>(<span class="cm-string">"2.png"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948b8f1f013?w=901&amp;h=242&amp;f=png&amp;s=18040" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h4><a name="读取资源第三种方式" class="md-header-anchor"></a><span>读取资源第三种方式：</span></h4><p><span>通过</span><strong><span>类装载器读取资源文件</span></strong><span>。我的文件放在了</span><strong><span>src目录下【也叫做类目录】</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948c5141493?w=478&amp;h=303&amp;f=png&amp;s=6876" referrerpolicy="no-referrer"></p><p><span>代码如下所示</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到类装载器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ClassLoader</span> <span class="cm-variable">classLoader</span> <span class="cm-operator">=</span> <span class="cm-variable">Servlet111</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">getClassLoader</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过类装载器获取到读取文件流</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">InputStream</span> <span class="cm-variable">inputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">classLoader</span>.<span class="cm-variable">getResourceAsStream</span>(<span class="cm-string">"3.png"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948cc81b841?w=911&amp;h=213&amp;f=png&amp;s=15779" referrerpolicy="no-referrer"></p><p><span>我的文件放在了src目录下的包下</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615e948d492459c?w=471&amp;h=244&amp;f=png&amp;s=5833" referrerpolicy="no-referrer"></p><p><span>代码如下，添加包名路径即可。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到类装载器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ClassLoader</span> <span class="cm-variable">classLoader</span> <span class="cm-operator">=</span> <span class="cm-variable">Servlet111</span>.<span class="cm-keyword">class</span>.<span class="cm-variable">getClassLoader</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过类装载器获取到读取文件流</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">InputStream</span> <span class="cm-variable">inputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">classLoader</span>.<span class="cm-variable">getResourceAsStream</span>(<span class="cm-string">"/zhongfucheng/web/1.png"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>原则：</span><strong><span>如果文件太大，就不能用类装载器的方式去读取，会导致内存溢出</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyvh5p34j3073073t8q.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p>&nbsp;</p><h1><a name="response对象" class="md-header-anchor"></a><span>Response对象</span></h1><h2><a name="1-responserequest对象" class="md-header-anchor"></a><span>1. response、request对象</span></h2><blockquote><p><span>Tomcat收到客户端的http请求，会针对每一次请求，分别创建一个</span><strong><span>代表请求的request对象</span></strong><span>、和</span><strong><span>代表响应的response对象</span></strong></p></blockquote><p><span>既然request对象代表http请求，那么我们</span><strong><span>获取浏览器提交过来的数据，找request对象</span></strong><span>即可。response对象代表http响应，那么我们</span><strong><span>向浏览器输出数据，找response对象</span></strong><span>即可。</span></p><h2><a name="2-什么是httpservletresponse对象" class="md-header-anchor"></a><span>2. 什么是HttpServletResponse对象？</span></h2><p><span>http响应由状态行、实体内容、消息头、一个空行组成。</span><strong><span>HttpServletResponse对象就封装了http响应的信息。</span></strong></p><h2><a name="3-httpservletresponse的应用" class="md-header-anchor"></a><span>3. HttpServletResponse的应用</span></h2><h3><a name="31调用getoutputstream方法向浏览器输出数据" class="md-header-anchor"></a><span>3.1调用getOutputStream()方法向浏览器输出数据</span></h3><p><span>调用getOutputStream()方法向浏览器输出数据,</span><strong><span>getOutputStream()方法可以使用print()也可以使用write()</span></strong><span>，它们有什么区别呢？我们试验一下。代码如下</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到OutputStream流</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletOutputStream</span> <span class="cm-variable">servletOutputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//向浏览器输出数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">print</span>(<span class="cm-string">"aaaa"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>成功输出，好像没什么毛病。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a5c51cf6?w=628&amp;h=167&amp;f=png&amp;s=10718" referrerpolicy="no-referrer"></p><p><span>我们试着输出中文试试</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//获取到OutputStream流</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ServletOutputStream</span> <span class="cm-variable">servletOutputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//向浏览器输出数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">print</span>(<span class="cm-string">"中国！"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>出异常了！！！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a7ea0ae7?w=810&amp;h=535&amp;f=png&amp;s=29773" referrerpolicy="no-referrer"></p><p><span>为什么会出现异常呢？在io中我们学过，</span><strong><span>outputStream是输出二进制数据的</span></strong><span>，</span><strong><span>print()方法接收了一个字符串</span></strong><span>，</span><strong><span>print()方法要把“中国”改成二进制数据，Tomcat使用IOS 8859-1编码对其进行转换,“中国”根本对ISO 8859-1编码不支持</span></strong><span>。所以出现了异常</span></p><p><span>我们再看看write()方法，先向浏览器输出英文数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-string">"aaa"</span>.<span class="cm-variable">getBytes</span>());</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>没有问题</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a6158015?w=1204&amp;h=233&amp;f=png&amp;s=21681" referrerpolicy="no-referrer"></p><p><span>再试试输出中文数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-string">"你好呀我是中国"</span>.<span class="cm-variable">getBytes</span>());</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>貌似也没有问题。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a6026e6a?w=632&amp;h=233&amp;f=png&amp;s=16560" referrerpolicy="no-referrer"></p><p><span>为什么使用write()方法能够正常向浏览器输出中文呢？</span><code>&quot;你好呀我是中国&quot;.getBytes()</code><span>这句代码在</span><strong><span>转成byte[]数组的时候默认查的是gb2312编码</span></strong><span>，而</span><strong><span>&quot;你好呀我是中国&quot;支持gb2312编码</span></strong><span>，所以可以正常显示出来。</span></p><p><span>但是，程序</span><strong><span>要实现通用性，应该使用的是UTF-8编码</span></strong><span>，我们在</span><strong><span>字符串转换成字节数组时指定UTF-8编码</span></strong><span>，看看会怎么样。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-string">"你好呀我是中国"</span>.<span class="cm-variable">getBytes</span>(<span class="cm-string">"UTF-8"</span>));</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>好的，成功把它搞成乱码了！！！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a86f2c5e?w=632&amp;h=233&amp;f=png&amp;s=16854" referrerpolicy="no-referrer"></p><p><span>为什么它变成了乱码呢？原因是这样的：我在向服务器输出的</span><strong><span>中文是UTF-8编码的，而浏览器采用的是GBK，GBK想显示UTF-8的中文数据，不乱码才怪呢</span></strong><span>！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2a811122a?w=1513&amp;h=848&amp;f=png&amp;s=21056" referrerpolicy="no-referrer"></p><p><span>既然如此，我将浏览器的编码改成UTF-8试试。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2ec219f09?w=1477&amp;h=848&amp;f=png&amp;s=20748" referrerpolicy="no-referrer"></p><p><span>乱码问题又解决了。可是，每次</span><strong><span>编写UTF-8程序时都要去网页上改编码格式吗？这样明显不可能的</span></strong><span>。</span></p><p><span>既然HTTP响应有对浏览器说明回送数据是什么类型的消息头，那么HttpServletResponse对象就应该有相对应的方法告诉浏览器回送的数据编码格式是什么</span></p><p><span>于是乎就去查找Servlet API，找到了</span><strong><span>设置消息头的方法</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置头信息，告诉浏览器我回送的数据编码是utf-8的</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Content-Type"</span>, <span class="cm-string">"text/html;charset=UTF-8"</span>); &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-string">"你好呀我是中国"</span>.<span class="cm-variable">getBytes</span>(<span class="cm-string">"UTF-8"</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><strong><span>浏览器在显示数据时，自动把页面的编码格式置换成UTF-8</span></strong><span>，乱码问题也解决了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2ef8ba781?w=1579&amp;h=723&amp;f=png&amp;s=20049" referrerpolicy="no-referrer"></p><p><span>另外，除了使用HttpServletResponse对象设置消息头的方法，我可以</span><strong><span>使用html的</span><meta><span>标签模拟一个http消息头</span></strong><span>，下面是代码：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到servletOutputStream对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletOutputStream</span> <span class="cm-variable">servletOutputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//使用meta标签模拟http消息头，告诉浏览器回送数据的编码和格式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;meta http-equiv='content-type' content='text/html;charset=UTF-8'&gt;"</span>.<span class="cm-variable">getBytes</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">write</span>(<span class="cm-string">"我是中国"</span>.<span class="cm-variable">getBytes</span>(<span class="cm-string">"UTF-8"</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>乱码问题也可以解决</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2f385418f?w=1535&amp;h=653&amp;f=png&amp;s=19423" referrerpolicy="no-referrer"></p><h3><a name="32调用getwriter方法向浏览器输出数据" class="md-header-anchor"></a><span>3.2调用getWriter()方法向浏览器输出数据</span></h3><p><span>对于getWriter()方法而言，是Writer的子类，那么</span><strong><span>只能向浏览器输出字符数据，不能输出二进制数据</span></strong><span>，使用getWriter()方法输出中文数据,代码如下：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到printWriter对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"看完博客点赞！"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>喜闻可见的事又出现了，我又出现乱码了。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2f3a89e44?w=788&amp;h=153&amp;f=png&amp;s=6259" referrerpolicy="no-referrer"></p><p><span>为什么出现乱码了呢？由于Tomcat是外国人的写，</span><strong><span>Tomcat默认的编码是ISO 8859-1</span></strong><span>，当我们输出中文数据的时候，</span><strong><span>Tomcat会依据ISO 8859-1码表给我们的数据编码，中文不支持这个码表呀</span></strong><span>，所以出现了乱码</span></p><p><span>既然如此，我设置一下编码不就好了吗，代码如下：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//原本是ISO 8859-1的编码，我设置成UTF-8</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setCharacterEncoding</span>(<span class="cm-string">"UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到printWriter对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"看完博客点赞！"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>我再访问了一下，我的天！看起来更乱了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd30b9019fa?w=788&amp;h=153&amp;f=png&amp;s=6757" referrerpolicy="no-referrer"></p><p><span>为什么乱码问题还没有解决？细心的朋友会发现，我只是在</span><strong><span>中文转换的时候把码表设置成UTF-8</span></strong><span>，但是</span><strong><span>浏览器未必是使用UTF-8码表来显示数据的呀</span></strong></p><p><span>好的，我们来看看浏览器的编码格式，果然，浏览器使用GB2312显示UTF-8的数据，不乱码才怪呢</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd2faaf327b?w=1156&amp;h=654&amp;f=png&amp;s=25014" referrerpolicy="no-referrer"></p><p><span>这个问题我们在上面已经是有两种方法解决了【使用</span><code>&lt;meta&gt;</code><span>标签模拟消息头、设置消息头】,Servlet还提供了一个方法给我们</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置浏览器用UTF-8编码显示数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>好的，我们再来访问一下</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd332cacded?w=1156&amp;h=654&amp;f=png&amp;s=24622" referrerpolicy="no-referrer"></p><p><span>既然Servlet有那么多方法解决乱码问题，是不是有一种是最简便的呢？没错！下面这个方法是最简便的，它</span><strong><span>不仅设置浏览器用UTF-8显示数据，内部还把中文转码的码表设置成UTF-8了</span></strong><span>，也就是说，</span><code>response.setContentType(&quot;text/html;charset=UTF-8&quot;);</code><span>把</span><code>response.setCharacterEncoding(&quot;UTF-8&quot;)</code><span>的事情也干了！</span></p><p><span>使用getWriter()显示中文数据，只需要一个方法就搞掂了！</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置浏览器用UTF-8编码显示数据，</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到printWriter对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"看完博客点赞！"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd33cc8c71e?w=1090&amp;h=223&amp;f=png&amp;s=7521" referrerpolicy="no-referrer"></p><h3><a name="33实现文件下载" class="md-header-anchor"></a><span>3.3实现文件下载</span></h3><p><span>下载资源我们在日常中也很常用，它是怎么做到的呢？</span><strong><span>要能够给别人下载，服务器就应该有这个资源</span></strong></p><p><span>现在我web站点下有一个图片了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd33e745a54?w=364&amp;h=328&amp;f=png&amp;s=7267" referrerpolicy="no-referrer"></p><p><span>既然浏览器发送所有的请求都是去找Servlet的话，那么我就写一个Servlet，</span><strong><span>当别人访问我这个Servlet的时候，它们就可以下载我这个图片了</span></strong><span>！</span></p><p><span>java的文件上传下载都是通过io流来完成的，既然要下载图片，首先要能够读取到它</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到资源的路径</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">path</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-variable">getServletContext</span>().<span class="cm-variable">getRealPath</span>(<span class="cm-string">"/download/1.png"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//读取资源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">FileInputStream</span> <span class="cm-variable">fileInputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">FileInputStream</span>(<span class="cm-variable">path</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到文件名,路径在电脑上保存是\\形式的。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">fileName</span> <span class="cm-operator">=</span> <span class="cm-variable">path</span>.<span class="cm-variable">substring</span>(<span class="cm-variable">path</span>.<span class="cm-variable">lastIndexOf</span>(<span class="cm-string">"\\"</span>) <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><strong><span>告诉浏览器，我要下载这个文件</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置消息头，告诉浏览器，我要下载1.png这个图片</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Content-Disposition"</span>, <span class="cm-string">"attachment; filename="</span><span class="cm-operator">+</span><span class="cm-variable">fileName</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>将读取到的内容回送给浏览器</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把读取到的资源写给浏览器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">byte</span>[] <span class="cm-variable">bytes</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">byte</span>[<span class="cm-number">1024</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ServletOutputStream</span> <span class="cm-variable">servletOutputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span> ((<span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-variable">fileInputStream</span>.<span class="cm-variable">read</span>(<span class="cm-variable">bytes</span>)) <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">write</span>(<span class="cm-variable">bytes</span>, <span class="cm-number">0</span>, <span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//关闭资源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">servletOutputStream</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fileInputStream</span>.<span class="cm-variable">close</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>当我访问时，浏览器就提示下载了。</span>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd33f0db714?w=1090&amp;h=223&amp;f=png&amp;s=9346" referrerpolicy="no-referrer"></p><p><span>也可以成功打开！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3438e4adf?w=1234&amp;h=885&amp;f=jpeg&amp;s=176770" referrerpolicy="no-referrer"></p><p><span>现在问题又有了，如果我文件的名字是中文呢？</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3439c4dd8?w=362&amp;h=264&amp;f=png&amp;s=6106" referrerpolicy="no-referrer"></p><p><span>我们再访问一下，发现名字乱码了（怎么都是乱码）</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3693b8376?w=960&amp;h=540&amp;f=png&amp;s=57778" referrerpolicy="no-referrer"></p><p><strong><span>为了解决文件名乱码，我们要进行URL编码</span></strong><span>，代码如下：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Content-Disposition"</span>, <span class="cm-string">"attachment; filename="</span> <span class="cm-operator">+</span> <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">fileName</span>, <span class="cm-string">"UTF-8"</span>));</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>再次访问时，文件名乱码问题就解决了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd36c907d5d?w=960&amp;h=540&amp;f=png&amp;s=58067" referrerpolicy="no-referrer"></p><h3><a name="34实现自动刷新" class="md-header-anchor"></a><span>3.4实现自动刷新</span></h3><p><strong><span>以规定的时间让页面刷新，更新资源</span></strong><span>，让浏览器实现自动刷新，那肯定又是修改消息头了。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//每3秒自动刷新网页一次</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Refresh"</span>, <span class="cm-string">"3"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>为了更好的看效果，我们加入时间值进去</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"time is :"</span> <span class="cm-operator">+</span> <span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>());</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>每三秒时间值就会发生变化</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd374eb4174?w=864&amp;h=364&amp;f=png&amp;s=14816" referrerpolicy="no-referrer"></p><p><span>学完上面的，好像没有什么用，自己上网的时候谁看得见这样的东西。</span><strong><span>自动刷新，能够实现页面的跳转</span></strong><span>】</span></p><p><span>我们登陆完网站，很多时候都会看见【登陆成功，3秒后自动跳转....】，其实这个就是用Refresh来完成的。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"3秒后跳转页面....."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//三秒后跳转到index.jsp页面去，web应用的映射路径我设置成/，url没有写上应用名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Refresh"</span>, <span class="cm-string">"3;url='/index.jsp'"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>看下效果</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd37767a0eb?w=864&amp;h=364&amp;f=png&amp;s=16358" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3a71d8a1c?w=864&amp;h=364&amp;f=png&amp;s=19237" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyv09urzj30730733ye.jpg" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p>&nbsp;</p><h3><a name="35设置缓存" class="md-header-anchor"></a><span>3.5设置缓存</span></h3><p><strong><span>浏览器本身就存在着缓存机制</span></strong><span>，当我第一次访问index.jsp时，浏览器向服务器发了两次请求【一个是网页的，一个是图片的】</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3a9b04387?w=1624&amp;h=560&amp;f=png&amp;s=910661" referrerpolicy="no-referrer"></p><p><span>当我第二次访问index.jsp的时候，</span><strong><span>浏览器将图片缓存起来了！图片不是重新加载的，是从缓存里面取出来的</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3ac4aca3d?w=1701&amp;h=394&amp;f=png&amp;s=430157" referrerpolicy="no-referrer"></p><p><span>像股票类型的网页是不能取缓存的数据的，数据都是要不断更新的。下面我就禁止缓存的功能</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//浏览器有三消息头设置缓存，为了兼容性！将三个消息头都设置了</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setDateHeader</span>(<span class="cm-string">"Expires"</span>, <span class="cm-operator">-</span><span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Cache-Control"</span>,<span class="cm-string">"no-cache"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Pragma"</span>, <span class="cm-string">"no-cache"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//这里为了看效果</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">print</span>(<span class="cm-string">"你好啊"</span> <span class="cm-operator">+</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>().<span class="cm-variable">toString</span>());</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>当然了，</span><strong><span>如果页面有些数据不长期更新，你就将它设置成缓存，这样可以提高服务器的性能</span></strong></p><h3><a name="36实现数据压缩" class="md-header-anchor"></a><span>3.6实现数据压缩</span></h3><p><span>网页上的信息量是很大的，如果</span><strong><span>不将数据压缩再回送给浏览器，这样就十分耗费流量</span></strong><span>，现在我有一篇文章要输出给浏览器</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">ss</span> <span class="cm-operator">=</span> <span class="cm-string">"fsdfhsdfhuisdhfusdhfuids"</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"fsdfdsfsdfsdfdsfdafdsfhsdjfhsdjkfhkjds"</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"fdsfjdslkfjsldkfjsdlkfjsdkfsdjkff"</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"fsjdfjdsklfjdsklfjkldsfjlksdjflksdjflkds"</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"dsjfklsdjflsdjfkldsfkjsdkfjsldkfjsdlfk"</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"fdsjlkfjdslkfjsdlkfjlkasjflk"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"原来的长度是："</span><span class="cm-operator">+</span><span class="cm-variable">ss</span>.<span class="cm-variable">getBytes</span>().<span class="cm-variable">length</span><span class="cm-operator">+</span><span class="cm-string">"&lt;/br&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//输出给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-variable">ss</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>访问一下可以看到，</span><strong><span>原来的长度是201</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3bbe655a4?w=948&amp;h=259&amp;f=png&amp;s=18371" referrerpolicy="no-referrer"></p><p><span>压缩的原理是什么？我们知道</span><strong><span>getOutputStream()和getWriter()都是直接把数据输出给浏览器的</span></strong><span>。现在我要做的就是</span><strong><span>让数据不直接输出给浏览器，先让我压缩了，再输出给浏览器</span></strong><span>。</span><strong><span>java提供了GZIP压缩类给我们</span></strong></p><p><span>就让我们使用GZIP类来对数据压缩吧</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//GZIP的构造方法需要一个OutputStream子类对象，究竟哪个对象适合，我们看下write()方法</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">GZIPOutputStream</span> <span class="cm-variable">gzipOutputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">GZIPOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//查看了下API，write()接收的是byte[]类型的。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gzipOutputStream</span>.<span class="cm-variable">write</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>于是我就在</span><strong><span>构造函数上传递个ByteArrayOutputStream给它</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//既然是byte[]类型，那么我就给他一个ByteArrayOutputStream</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">GZIPOutputStream</span> <span class="cm-variable">gzipOutputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">GZIPOutputStream</span>(<span class="cm-keyword">new</span> <span class="cm-variable">ByteArrayOutputStream</span>());</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>而用</span><strong><span>GZIPOutputStream写数据的时候，是把数据写到ByteArrayOutputStream上的，等会还要把数据取出来，再写给浏览器</span></strong><span>，于是就</span><strong><span>不能以匿名内部类的方式给GZIPOutputStream，必须把ByteArrayOutputStream定义出来</span></strong><span>，</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//创建GZIPOutputStream对象，给予它ByteArrayOutputStream</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ByteArrayOutputStream</span> <span class="cm-variable">byteArrayOutputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ByteArrayOutputStream</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">GZIPOutputStream</span> <span class="cm-variable">gzipOutputStream</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">GZIPOutputStream</span>(<span class="cm-variable">byteArrayOutputStream</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//GZIP对数据压缩，GZIP写入的数据是保存在byteArrayOutputStream上的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gzipOutputStream</span>.<span class="cm-variable">write</span>(<span class="cm-variable">ss</span>.<span class="cm-variable">getBytes</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//gzipOutputStream有缓冲，把缓冲清了，并顺便关闭流</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gzipOutputStream</span>.<span class="cm-variable">close</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>把</span><strong><span>压缩后的数据取出来，写给浏览器</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//将压缩的数据取出来</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">byte</span>[] <span class="cm-variable">bytes</span> <span class="cm-operator">=</span> <span class="cm-variable">byteArrayOutputStream</span>.<span class="cm-variable">toByteArray</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//将压缩的数据写给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-variable">bytes</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>我们来对比一下压缩前的大小和压缩后的大小</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3cea6f1a6?w=1391&amp;h=174&amp;f=png&amp;s=21906" referrerpolicy="no-referrer"></p><p><span>数据的确是压缩了，然而，为什么又乱码了啊？很简单，既然</span><strong><span>你压缩了数据，你写给浏览器，浏览器是不知道你这是压缩后的数据，它是以正常的方式打开数据的</span></strong><span>。这当然造成乱码啦！，现在我要</span><strong><span>告诉浏览器我这是压缩数据</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//告诉浏览器这是gzip压缩的数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Content-Encoding"</span>,<span class="cm-string">"gzip"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//再将压缩的数据写给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>().<span class="cm-variable">write</span>(<span class="cm-variable">bytes</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>再次访问一下</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3d18969c5?w=1627&amp;h=160&amp;f=png&amp;s=19527" referrerpolicy="no-referrer"></p><h3><a name="37生出随机图片" class="md-header-anchor"></a><span>3.7生出随机图片</span></h3><p><span>生成随机图片这是非常常见的。</span><strong><span>在我们登陆的时候经常要写验证码，而那些验证码是一张图片，就是通过HttpServletResponse写给浏览器的。</span></strong></p><p><span>要生成一张图片，</span><strong><span>java提供了BufferedImage类供我们使用</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//在内存中生成一张图片,宽为80,高为20，类型是RGB</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BufferedImage</span> <span class="cm-variable">bufferedImage</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BufferedImage</span>(<span class="cm-number">80</span>, <span class="cm-number">20</span>, <span class="cm-variable">BufferedImage</span>.<span class="cm-variable">TYPE_INT_RGB</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到这张图片</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Graphics</span> <span class="cm-variable">graphics</span> <span class="cm-operator">=</span> <span class="cm-variable">bufferedImage</span>.<span class="cm-variable">getGraphics</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//往图片设置颜色和字体</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">BLUE</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics</span>.<span class="cm-variable">setFont</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Font</span>(<span class="cm-atom">null</span>, <span class="cm-variable">Font</span>.<span class="cm-variable">BOLD</span>, <span class="cm-number">20</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//往图片上写数据，先写个12345，横坐标是0，纵坐标是20【高度】</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics</span>.<span class="cm-variable">drawString</span>(<span class="cm-string">"12345"</span>, <span class="cm-number">0</span>, <span class="cm-number">20</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>好的，现在我们在内存中创建了一张图片，并写上了12345。接着，我们要</span><strong><span>把图片写给浏览器了</span></strong><span>。</span><strong><span>把图片写给浏览器，java又提供了图片流【ImageIO】给我们使用</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//要往浏览器写一张图片，那要告诉浏览器回送的类型是一张图片</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"ContentType"</span>, <span class="cm-string">"jpeg"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//java提供了图片流给我们使用，这是一个工具类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把图片传进去，类型是jpg，写给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ImageIO</span>.<span class="cm-variable">write</span>(<span class="cm-variable">bufferedImage</span>, <span class="cm-string">"jpg"</span>, <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>());</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>我们来访问一下，看下图片长什么样</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd3ea465135?w=1444&amp;h=166&amp;f=png&amp;s=20310" referrerpolicy="no-referrer"></p><p><span>这样太丑了，我们把背景改成白色看看</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把白色填充整张图片</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">white</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics</span>.<span class="cm-variable">fillRect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">80</span>, <span class="cm-number">20</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>再看看效果，这明显好看多了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd4064d484e?w=1344&amp;h=166&amp;f=png&amp;s=20420" referrerpolicy="no-referrer"></p><p><span>好的，我们的图片数字不</span><strong><span>可能是人工写的，数字应该是随机产生的！</span></strong><span>这个就简单了。现在我要生成7位的随机数，生成随机数的方法如下</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-def">makeNum</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Random</span> <span class="cm-variable">random</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Random</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//这样就会生成0-7位的随机数，现在问题又来了，如果随机数不够7位呢？如果不够7位，我们加到7位就行了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">anInt</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">9999999</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//将数字转成是字符串</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">num</span> <span class="cm-operator">=</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">valueOf</span>(<span class="cm-variable">anInt</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//判断位数有多少个，不够就加</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">StringBuffer</span> <span class="cm-variable">stringBuffer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">StringBuffer</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">7</span> <span class="cm-operator">-</span> <span class="cm-variable">num</span>.<span class="cm-variable">length</span>(); <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">stringBuffer</span>.<span class="cm-variable">append</span>(<span class="cm-string">"0"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">stringBuffer</span>.<span class="cm-variable">append</span>(<span class="cm-variable">num</span>).<span class="cm-variable">toString</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><span>如果</span><strong><span>要生成中文，就找中文映射表即可</span></strong><span>。</span></p><h3><a name="36重定向跳转" class="md-header-anchor"></a><span>3.6重定向跳转</span></h3><p><span>什么是重定向跳转呢？点击一个超链接，</span><strong><span>通知浏览器跳转到另外的一个页面</span></strong><span>就叫重定向跳转。</span><strong><span>是通知浏览器去跳转，这很重要。</span></strong><span>页面之间的跳转有两种方式：</span><strong><span>重定向和转发</span></strong><span>，至于什么时候用重定向，什么用转发，我在讲完HttpServletRequest对象的时候会详细说明。</span></p><p><span>我们来使用以下HttpServletResponse对象的重定向</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//重定向到index.jsp页面</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-string">"/zhongfucheng/index.jsp"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>在</span><strong><span>浏览器的地址栏访问Servlet222</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd40766f4d7?w=886&amp;h=172&amp;f=png&amp;s=13564" referrerpolicy="no-referrer"></p><p><strong><span>跳转到index.jsp页面，地址栏发生了变化</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd41460925a?w=1220&amp;h=197&amp;f=png&amp;s=24592" referrerpolicy="no-referrer"></p><ul><li><span>我们再来</span><strong><span>看看http协议发生了什么</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615edd41c041a7d?w=1920&amp;h=192&amp;f=png&amp;s=14200" referrerpolicy="no-referrer"></p><p><span>从图上看，我们看到了两个状态码，一个是302。一个是200。</span><strong><span>302状态码在http协议中代表的是临时重定向</span></strong><span>。举个例子：</span><strong><span>我找纪律委员说：给我一份请假表，我要回家。纪律委员告诉我：我这里没有请假表，你去找辅导员吧</span></strong><span>。再看回我访问Sevlet222时：我找Servlet222，Servlet222告诉浏览器：我没有你想要的资源，你要的资源在index.jsp页面中，你自己去找吧。</span></p><p><span>很容易看</span><strong><span>出重定向是通过302状态码和跳转地址实现的</span></strong><span>。于是乎，</span><strong><span>我们设置http消息头就可以实现重定向跳转</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置状态码是302</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setStatus</span>(<span class="cm-number">302</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//HttpServletResponse把常用的状态码封装成静态常量了，所以我们可以使用SC_MOVED_TEMPORARILY代表着302</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setStatus</span>(<span class="cm-variable">HttpServletResponse</span>.<span class="cm-variable">SC_MOVED_TEMPORARILY</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//跳转的地址是index.jsp页面</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Location"</span>, <span class="cm-string">"/zhongfucheng/index.jsp"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><strong><span>其实sendRedirect()方法就是对setStatus()和setHeader()进行封装</span></strong><span>，原理就是setStatus()和setHeader()</span></p><h3><a name="37getwriter和getoutputstream细节" class="md-header-anchor"></a><span>3.7getWriter和getOutputStream细节</span></h3><ol><li><strong><span>getWriter()和getOutputStream()两个方法不能同时调用</span></strong><span>。如果同时调用就会出现异常</span></li><li><span>Servlet程序向ServletOutputStream或PrintWriter对象中</span><strong><span>写入的数据将被Servlet引擎从response里面获取，Servlet引擎将这些数据当作响应消息的正文，然后再与响应状态行和各响应头组合后输出到客户端</span></strong><span>。 </span></li><li><span>Servlet的</span><strong><span>serice()方法结束后【也就是doPost()或者doGet()结束后】</span></strong><span>，Servlet引擎将检查getWriter或getOutputStream方法返回的输出流对象是否已经调用过close方法，</span><strong><span>如果没有，Servlet引擎将调用close方法关闭该输出流对象.</span></strong></li></ol><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz2dvm1xg3073073q65.gif" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p><span>如果⽂档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的联系⽅式。更多</span><strong><span>原创</span></strong><span>技术⽂章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="request对象" class="md-header-anchor"></a><span>Request对象</span></h1><p>&nbsp;</p><h2><a name="1-什么是httpservletrequest" class="md-header-anchor"></a><span>1. 什么是HttpServletRequest</span></h2><blockquote><p><span>HttpServletRequest对象代表客户端的请求，当客户端通过HTTP协议访问服务器时，HTTP请求头中的所有信息都封装在这个对象中，开发人员通过这个对象的方法，可以获得客户这些信息。</span></p></blockquote><p><span>简单来说，</span><strong><span>要得到浏览器信息，就找HttpServletRequest对象</span></strong></p><h2><a name="2-httpservletrequest常用方法" class="md-header-anchor"></a><span>2. HttpServletRequest常用方法</span></h2><h3><a name="21-获得客户机浏览器信息" class="md-header-anchor"></a><span>2.1 获得客户机【浏览器】信息</span></h3><ul><li><strong><span>getRequestURL方法返回客户端发出请求时的完整URL。</span></strong></li><li><span>getRequestURI方法返回请求行中的资源名部分。</span></li><li><strong><span>getQueryString 方法返回请求行中的参数部分。</span></strong></li><li><span>getPathInfo方法返回请求URL中的额外路径信息。额外路径信息是请求URL中的位于Servlet的路径之后和查询参数之前的内容，它以“/”开头。</span></li><li><strong><span>getRemoteAddr方法返回发出请求的客户机的IP地址</span></strong></li><li><span>getRemoteHost方法返回发出请求的客户机的完整主机名</span></li><li><span>getRemotePort方法返回客户机所使用的网络端口号</span></li><li><strong><span>getLocalAddr方法返回WEB服务器的IP地址。</span></strong></li><li><span>getLocalName方法返回WEB服务器的主机名</span></li></ul><h3><a name="22-获得客户机请求头" class="md-header-anchor"></a><span>2.2 获得客户机请求头</span></h3><ul><li><strong><span>getHeader方法</span></strong></li><li><span>getHeaders方法 </span></li><li><span>getHeaderNames方法 </span></li></ul><h3><a name="23-获得客户机请求参数客户端提交的数据" class="md-header-anchor"></a><span>2.3 获得客户机请求参数(客户端提交的数据)</span></h3><ul><li><strong><span>getParameter方法</span></strong></li><li><strong><span>getParameterValues（String name）方法</span></strong></li><li><span>getParameterNames方法 </span></li><li><span>getParameterMap方法</span></li></ul><h2><a name="3-httpservletrequest应用" class="md-header-anchor"></a><span>3. HttpServletRequest应用</span></h2><h3><a name="31-防盗链" class="md-header-anchor"></a><span>3.1 防盗链</span></h3><p><span>什么是防盗链呢？比如：</span><strong><span>我现在有海贼王最新的资源，想要看海贼王的要在我的网页上看。现在别的网站的人看到我有海贼王的资源，想要把我的资源粘贴在他自己的网站上。这样我独家的资源就被一个CTRL+C和CTRL+V抢走了</span></strong><span>？而反盗链就是不能被他们CRTL+C和CRTL+V</span></p><p>&nbsp;</p><p><span>下面我模拟一下场景。现在我首页先有一个超链接，指向着海贼王最新资源</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7ba6f5fb4?w=733&amp;h=248&amp;f=png&amp;s=14143" referrerpolicy="no-referrer"></p><p><span>当我点进去，就能看到海贼王最新资源了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7badb3c2d?w=733&amp;h=248&amp;f=png&amp;s=14144" referrerpolicy="no-referrer"></p><p><span>其他的人可以通过复制粘贴我的地址，放到它们的网页上</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7baa9aa62?w=733&amp;h=248&amp;f=png&amp;s=18968" referrerpolicy="no-referrer"></p><p><span>这样我就划不来啦【我的广告你来没看呢！】。</span><strong><span>想要看我的资源，就必须经过我的首页点进去看</span></strong><span>。</span></p><p><span>想要实现这样的效果，就要</span><strong><span>获取Referer这个消息头</span></strong><span>，</span><strong><span>判断Referer是不是从我的首页来的。如果不是从我的首页来的，跳转回我的首页</span></strong><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到网页是从哪里来的</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">referer</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getHeader</span>(<span class="cm-string">"Referer"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//如果不是从我的首页来或者从地址栏直接访问的，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> ( <span class="cm-variable">referer</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">||</span> <span class="cm-operator">!</span><span class="cm-variable">referer</span>.<span class="cm-variable">contains</span>(<span class="cm-string">"localhost:8080/zhongfucheng/index.jsp"</span>) ) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//回到首页去</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-string">"/zhongfucheng/index.jsp"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//能执行下面的语句，说明是从我的首页点击进来的，那没问题，照常显示</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"路飞做了XXXXxxxxxxxxxxxxxxxx"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>首先按正常预想的，</span><strong><span>别人从首页点击我的资源，访问我海贼王最新的资源</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7bbd51b0a?w=910&amp;h=163&amp;f=png&amp;s=15233" referrerpolicy="no-referrer"></p><p><span>能够成功访问到资源</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7bbe46a2c?w=1010&amp;h=327&amp;f=png&amp;s=16410" referrerpolicy="no-referrer"></p><p><span>如果我在浏览器直接输入地址【此时Referer是为null的】，我们来看看</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d7bce5930b?w=1010&amp;h=327&amp;f=png&amp;s=14818" referrerpolicy="no-referrer"></p><p><strong><span>跳回到首页上，不能访问到海贼王资源</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d802eb88ef?w=1010&amp;h=327&amp;f=png&amp;s=17036" referrerpolicy="no-referrer"></p><p><span>再试试，如果</span><strong><span>别人粘贴了我的资源url，在它的网页上挂了一个网址呢。</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d804395bc8?w=1010&amp;h=327&amp;f=png&amp;s=18489" referrerpolicy="no-referrer"></p><p><span>在别人网页上点击的时候</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d804a50826?w=1010&amp;h=327&amp;f=png&amp;s=18489" referrerpolicy="no-referrer"></p><p><strong><span>又跳回到了我的首页了。</span></strong>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d806f5ee2b?w=1010&amp;h=327&amp;f=png&amp;s=17420" referrerpolicy="no-referrer"></p><h3><a name="32表单提交数据通过post方式提交数据" class="md-header-anchor"></a><span>3.2表单提交数据【通过post方式提交数据】</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/zhongfucheng/Servlet111"</span> <span class="cm-attribute">method</span>=<span class="cm-string">"post"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">table</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>用户名<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>密码<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"password"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>性别<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"gender"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"男"</span><span class="cm-tag cm-bracket">&gt;</span>男</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"radio"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"gender"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"女"</span><span class="cm-tag cm-bracket">&gt;</span>女</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>爱好<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"checkbox"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"hobbies"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"游泳"</span><span class="cm-tag cm-bracket">&gt;</span>游泳</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"checkbox"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"hobbies"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"跑步"</span><span class="cm-tag cm-bracket">&gt;</span>跑步</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"checkbox"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"hobbies"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"飞翔"</span><span class="cm-tag cm-bracket">&gt;</span>飞翔</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"hidden"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"aaa"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"my name is zhongfucheng"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>你的来自于哪里<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">select</span> <span class="cm-attribute">name</span>=<span class="cm-string">"address"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"广州"</span><span class="cm-tag cm-bracket">&gt;</span>广州<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"深圳"</span><span class="cm-tag cm-bracket">&gt;</span>深圳<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">option</span> <span class="cm-attribute">value</span>=<span class="cm-string">"北京"</span><span class="cm-tag cm-bracket">&gt;</span>北京<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">option</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">select</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span>详细说明:<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">textarea</span> <span class="cm-attribute">cols</span>=<span class="cm-string">"30"</span> <span class="cm-attribute">rows</span>=<span class="cm-string">"2"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"textarea"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">textarea</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"提交"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"reset"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"重置"</span><span class="cm-tag cm-bracket">&gt;&lt;/</span><span class="cm-tag">td</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">tr</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">table</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1056px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1056px;"></div></div></div></pre><p><span>在Servlet111中获取到提交的数据，代码如下</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置request字符编码的格式</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">setCharacterEncoding</span>(<span class="cm-string">"UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过html的name属性，获取到值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"username"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">password</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"password"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">gender</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"gender"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//复选框和下拉框有多个值，获取到多个值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span>[] <span class="cm-variable">hobbies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameterValues</span>(<span class="cm-string">"hobbies"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span>[] <span class="cm-variable">address</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameterValues</span>(<span class="cm-string">"address"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到文本域的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">description</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"textarea"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到隐藏域的值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">hiddenValue</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"aaa"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">....<span class="cm-variable">各种System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>().......</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>向表单输入数据</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d81460cd3d?w=851&amp;h=375&amp;f=png&amp;s=24765" referrerpolicy="no-referrer"></p><p><span>Servlet111得到表单带过来的数据，最后的一个数据是隐藏域带过来的。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d822f028a7?w=539&amp;h=275&amp;f=png&amp;s=4384" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyvxnfymj30730733yf.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="34超链接方式提交数据" class="md-header-anchor"></a><span>3.4超链接方式提交数据</span></h3><p><strong><span>常见的get方式提交数据有</span></strong><span>：</span><strong><span>使用超链接，sendRedirect()</span></strong></p><p><span>格式如下：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sendRedirect</span>(<span class="cm-string">"servlet的地址?参数名="</span><span class="cm-operator">+</span><span class="cm-variable">参数值</span> <span class="cm-operator">&amp;</span><span class="cm-string">"参数名="</span><span class="cm-operator">+</span><span class="cm-variable">参数值</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>我们来使用一下，</span><strong><span>通过超链接将数据带给浏览器</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">a</span> <span class="cm-variable">href</span><span class="cm-operator">=</span><span class="cm-string">"/zhongfucheng/Servlet111?username=xxx"</span><span class="cm-operator">&gt;</span><span class="cm-variable">使用超链接将数据带给浏览器</span><span class="cm-operator">&lt;/</span><span class="cm-variable">a</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>在Servlet111接收数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//接收以username为参数名带过来的值</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"username"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">username</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>注意</span><strong><span>看浏览器左下角</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d833ba81cb?w=853&amp;h=215&amp;f=png&amp;s=19008" referrerpolicy="no-referrer"></p><p><span>服务器成功接收到浏览器发送过来的数据</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d842311ae6?w=1119&amp;h=83&amp;f=png&amp;s=1531" referrerpolicy="no-referrer"></p><p><span>并且，</span><strong><span>传输数据明文的出现在浏览器的地址栏上</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d84e0470b7?w=987&amp;h=314&amp;f=png&amp;s=15378" referrerpolicy="no-referrer"></p><p><strong><span>sendRedirect()和超链接类似，在这里就不赘述了</span></strong></p><h3><a name="35解决中文乱码问题" class="md-header-anchor"></a><span>3.5解决中文乱码问题</span></h3><p><span>细心的朋友会发现，我在获取表单数据的时候，有这句代码</span><code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code><span>，如果没有这句代码，会发生什么事呢？我们看看。</span></p><p><span>再重新填写数据</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d85ab7f59c?w=987&amp;h=314&amp;f=png&amp;s=27697" referrerpolicy="no-referrer"></p><p><span>在服务器查看提交过来的数据，</span><strong><span>所有的中文数据都乱码了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d85ac3b601" referrerpolicy="no-referrer"></p><p><span>来这里我们来分析一下乱码的原因，在前面的博客中我已经介绍了，Tomcat服务器默认编码是ISO 8859-1，而</span><strong><span>浏览器使用的是UTF-8编码</span></strong><span>。浏览器的中文数据提交给服务器，</span><strong><span>Tomcat以ISO 8859-1编码对中文编码，当我在Servlet读取数据的时候，拿到的当然是乱码。</span></strong><span>而我设置request的编码为UTF-8，乱码就解决了。</span></p><p>&nbsp;</p><p><span>接下来使用get方式传递中文数据，</span><strong><span>把表单的方式改成get即可</span></strong><span>，当我们访问的时候，又出现乱码了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8673aa643?w=1135&amp;h=827&amp;f=png&amp;s=38585" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d86fcaaebc?w=647&amp;h=211&amp;f=png&amp;s=3031" referrerpolicy="no-referrer"></p><p><span>于是我按照上面的方式，把request对象设置编码为UTF-8试试</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">setCharacterEncoding</span>(<span class="cm-string">"UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"name"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>结果还是乱码。这是为什么呢？</span><strong><span>我明明已经把编码设置成UTF-8了，按照post方式，乱码问题已经解决了</span></strong><span>！。我们来看看get和post方式的区别在哪？</span><strong><span>为什么post方式设置了request编码就可以解决乱码问题，而get方式不能呢。</span></strong></p><p><span>首先我们来看一下post方法是怎么进行参数传递的。当我们</span><strong><span>点击提交按钮的时候，数据封装进了Form Data中</span></strong><span>，</span><strong><span>http请求中把实体主体带过去了【传输的数据称之为实体主体】</span></strong><span>，既然request对象封装了http请求，所以</span><strong><span>request对象可以解析到发送过来的数据</span></strong><span>，于是只要</span><strong><span>把编码设置成UTF-8就可以解决乱码问题了</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d88026981a?w=1920&amp;h=950&amp;f=png&amp;s=129642" referrerpolicy="no-referrer"></p><p><span>而get方式不同，它的</span><strong><span>数据是从消息行带过去的，没有封装到request对象里面</span></strong><span>，所以使用request设置编码是无效的。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d898f8c897?w=1920&amp;h=950&amp;f=png&amp;s=114675" referrerpolicy="no-referrer"></p><p><span>要解决get方式乱码问题也不难，我们既然知道Tomcat默认的编码是ISO 8859-1，那么</span><strong><span>get方式由消息体带过去给浏览器的时候肯定是用ISO 8859-1编码了</span></strong><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//此时得到的数据已经是被ISO 8859-1编码后的字符串了，这个是乱码</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"username"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//乱码通过反向查ISO 8859-1得到原始的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">byte</span>[] <span class="cm-variable">bytes</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>.<span class="cm-variable">getBytes</span>(<span class="cm-string">"ISO8859-1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过原始的数据，设置正确的码表，构建字符串</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">String</span>(<span class="cm-variable">bytes</span>, <span class="cm-string">"UTF-8"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>上面的代码有些难理解，我画张图说明一下：</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8a5101146?w=725&amp;h=495&amp;f=png&amp;s=32892" referrerpolicy="no-referrer"></p><p><span>经过我们手工转换，再来访问一下</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8b3a8fc54?w=1061&amp;h=197&amp;f=png&amp;s=16043" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>好的，成功解决掉乱码问题了。除了手工转换，</span><strong><span>get方式还可以改Tomcat服务器的配置来解决乱码，但是不推荐使用，这样不灵活。</span></strong><span>“</span></p><p><span>我们都知道</span><strong><span>Tomcat默认的编码是ISO 8859-1,如果在Tomcat服务器的配置下改成是UTF-8的编码，那么就解决服务器在解析数据的时候造成乱码问题了</span></strong></p><p><span>在8080端口的Connector上加入</span><code>URIEncoding=&quot;utf-8&quot;</code><span>，设置Tomcat的访问该端口时的编码为utf-8，从而解决乱码，</span><strong><span>这种改法是固定使用UTF-8编码的</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Connector</span> <span class="cm-attribute">port</span>=<span class="cm-string">"8080"</span> <span class="cm-attribute">protocol</span>=<span class="cm-string">"HTTP/1.1"</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">connectionTimeout</span>=<span class="cm-string">"20000"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">redirectPort</span>=<span class="cm-string">"8443"</span> <span class="cm-attribute">URIEncoding</span>=<span class="cm-string">"utf-8"</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>设置了编码后，没有做任何手工转换，成功拿到数据</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8d92ff970?w=945&amp;h=529&amp;f=png&amp;s=34701" referrerpolicy="no-referrer"></p><p><span>当然也有另一种改服务器编码的方式。设置Tomcat的访问该端口时的编码</span><strong><span>为页面的编码，这种改法是随着页面的编码而变</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Connector</span> <span class="cm-attribute">port</span>=<span class="cm-string">"8080"</span> <span class="cm-attribute">protocol</span>=<span class="cm-string">"HTTP/1.1"</span> </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">connectionTimeout</span>=<span class="cm-string">"20000"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">redirectPort</span>=<span class="cm-string">"8443"</span> <span class="cm-attribute">useBodyEncodingForURI</span>=<span class="cm-string">"true"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>设置编码为UTF-8</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">setCharacterEncoding</span>(<span class="cm-string">"UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"name"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>再次访问</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8e7d0018b?w=1203&amp;h=388&amp;f=png&amp;s=28362" referrerpolicy="no-referrer"></p><p><strong><span>手写超链接如果附带中文参数问题，要URL重写，在JSP博客中会讲到</span></strong></p><p><span>总结：</span></p><ul><li><span>post方式直接改request对象的编码</span></li><li><span>get方式需要手工转换编码</span></li><li><strong><span>get方式也可以修改Tomcat服务器的编码，不推荐，因为会太依赖服务器了！</span></strong></li><li><strong><span>提交数据能用post就用post</span></strong></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnywdweibj3078079glj.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="36-实现转发" class="md-header-anchor"></a><span>3.6 实现转发</span></h3><p><span>之前讲过使用response的sendRedirect()可以</span><strong><span>实现重定向，做到的功能是页面跳转</span></strong><span>，使用request的getRequestDispatcher.forward(request,response)</span><strong><span>实现转发，做到的功能也是页面跳转</span></strong><span>，他们有什么区别呢？现在我先来说下转发</span></p><p><span>代码如下所示</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到requestDispatcher对象，跳转到index.jsp</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">RequestDispatcher</span> <span class="cm-variable">requestDispatcher</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/index.jsp"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//调用requestDispatcher对象的forward()实现转发,传入request和response方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">requestDispatcher</span>.<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>访问Servlet111</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8f5b25fec?w=1116&amp;h=229&amp;f=png&amp;s=25978" referrerpolicy="no-referrer"></p><p><span>上面已经说了，可以</span><strong><span>通过sendRedirect()重定向可以在资源尾部添加参数提交数据给服务器。那么转发能不能提交数据给服务器呢？答案明显是可以的，并且使用这种方法非常频繁</span></strong></p><p>&nbsp;</p><p><span>在讲ServletContext的时候，</span><strong><span>曾经说过Servlet之间可以通过ServletContext实现通讯，ServletContext也能称之为域对象</span></strong><span>。而</span><strong><span>request也可以称之为域对象</span></strong><span>，只不过</span><strong><span>ServletContext的域是整个web应用，而request的域仅仅代表一次http请求</span></strong></p><p>&nbsp;</p><p><span>下面我们来使用request实现Servlet之间的通讯，Servlet111代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//以username为关键字存zhongfucheng值</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"username"</span>, <span class="cm-string">"zhongfucheng"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到requestDispatcher对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">RequestDispatcher</span> <span class="cm-variable">requestDispatcher</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/Servlet222"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//调用requestDispatcher对象的forward()实现转发,传入request和response方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">requestDispatcher</span>.<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>Servlet222代码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到存进request对象的值</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">userName</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">request</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"username"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//在浏览器输出该值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"i am :"</span><span class="cm-operator">+</span><span class="cm-variable">userName</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>访问Servlet111看下效果</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8fcca5db7?w=1116&amp;h=229&amp;f=png&amp;s=16442" referrerpolicy="no-referrer"></p><p><span>如上图所示，</span><strong><span>Servlet222成功拿到了request对象在Servlet111存进的数据</span></strong><span>。</span></p><p>&nbsp;</p><p><span>现在问题又来了，我们可以</span><strong><span>使用ServletContext和request实现Servlet之间的通讯，那么我们用哪一种呢</span></strong><span>？一般的原则：</span><strong><span>可以使用request就尽可能使用request</span></strong><span>。因为ServletContext代表着整个web应用，使用ServletContext会消耗大量的资源，而</span><strong><span>request对象会随着请求的结束而结束，资源会被回收</span></strong><span>。</span><strong><span>使用request域进行Servlet之间的通讯在开发中是非常频繁的</span></strong><span>。</span></p><h3><a name="37-转发的时序图" class="md-header-anchor"></a><span>3.7 转发的时序图</span></h3><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d8fe3e1465?w=915&amp;h=547&amp;f=png&amp;s=183664" referrerpolicy="no-referrer"></p><h4><a name="371请求转发的细节" class="md-header-anchor"></a><span>3.7.1请求转发的细节</span></h4><p><span>如果在</span><strong><span>调用forward方法之前</span></strong><span>，在</span><strong><span>Servlet程序中写入的部分内容已经被真正地传送到了客户端</span></strong><span>，forward方法将抛出IllegalStateException异常。 也就是说：</span><strong><span>不要在转发之前写数据给浏览器</span></strong></p><p><span>我们来试试是不是真的会出现异常。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">OutputStream</span> <span class="cm-variable">outputStream</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">outputStream</span>.<span class="cm-variable">write</span>(<span class="cm-string">"--------------------------------------------"</span>.<span class="cm-variable">getBytes</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//关闭流，确保让数据到浏览器中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">outputStream</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//跳转</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/Foot"</span>).<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>访问的时候，看到浏览器可以输出数据，Tomcat后台抛出了异常</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d90c67c612?w=1242&amp;h=415&amp;f=png&amp;s=50385" referrerpolicy="no-referrer"></p><p><span>如果在调用forward方法之前向Servlet引擎的缓冲区中写入了内容，</span><strong><span>只要写入到缓冲区中的内容还没有被真正输出到客户端</span></strong><span>，forward方法就可以被正常执行，</span><strong><span>原来写入到输出缓冲区中的内容将被清空</span></strong><span>，但是，</span><strong><span>已写入到HttpServletResponse对象中的响应头字段信息保持有效</span></strong><span>。</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnywo71jrg308c08caa4.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="38转发和重定向的区别" class="md-header-anchor"></a><span>3.8转发和重定向的区别</span></h3><h4><a name="381实际发生位置不同地址栏不同" class="md-header-anchor"></a><span>3.8.1实际发生位置不同，地址栏不同</span></h4><ul><li><p><span>转发是发生在服务器的</span></p><ul><li><strong><span>转发是由服务器进行跳转的</span></strong><span>，细心的朋友会发现，在转发的时候，</span><strong><span>浏览器的地址栏是没有发生变化的</span></strong><span>，在我访问Servlet111的时候，即使跳转到了Servlet222的页面，浏览器的地址还是Servlet111的。也就是说</span><strong><span>浏览器是不知道该跳转的动作，转发是对浏览器透明的</span></strong><span>。通过上面的转发时序图我们也可以发现，</span><strong><span>实现转发只是一次的http请求</span></strong><span>，</span><strong><span>一次转发中request和response对象都是同一个</span></strong><span>。这也解释了，为什么可以使用</span><strong><span>request作为域对象进行Servlet之间的通讯。</span></strong></li></ul></li><li><p><span>重定向是发生在浏览器的</span></p><ul><li><strong><span>重定向是由浏览器进行跳转的</span></strong><span>，进行重定向跳转的时候，</span><strong><span>浏览器的地址会发生变化的</span></strong><span>。曾经介绍过：实现重定向的原理是由response的状态码和Location头组合而实现的。</span><strong><span>这是由浏览器进行的页面跳转</span></strong><span>实现重定向</span><strong><span>会发出两个http请求</span></strong><span>，</span><strong><span>request域对象是无效的，因为它不是同一个request对象</span></strong></li></ul></li></ul><h4><a name="382用法不同" class="md-header-anchor"></a><span>3.8.2用法不同</span></h4><p><span>很多人都搞不清楚转发和重定向的时候，</span><strong><span>资源地址究竟怎么写</span></strong><span>。有的时候要把应用名写上，有的时候不用把应用名写上。很容易把人搞晕。记住一个原则：</span><strong><span>给服务器用的直接从资源名开始写，给浏览器用的要把应用名写上</span></strong></p><ul><li><p><span>request.getRequestDispatcher(&quot;/资源名 URI&quot;).forward(request,response)</span></p><ul><li><strong><span>转发时&quot;/&quot;代表的是本应用程序的根目录【zhongfucheng】</span></strong></li></ul></li><li><p><span>response.send(&quot;/web应用/资源名 URI&quot;);</span></p><ul><li><strong><span>重定向时&quot;/&quot;代表的是webapps目录</span></strong></li></ul></li></ul><h4><a name="383能够去往的url的范围不一样" class="md-header-anchor"></a><span>3.8.3能够去往的URL的范围不一样</span></h4><ul><li><strong><span>转发是服务器跳转只能去往当前web应用的资源</span></strong></li><li><strong><span>重定向是服务器跳转，可以去往任何的资源</span></strong></li></ul><h4><a name="384传递数据的类型不同" class="md-header-anchor"></a><span>3.8.4传递数据的类型不同</span></h4><ul><li><strong><span>转发的request对象可以传递各种类型的数据，包括对象</span></strong></li><li><strong><span>重定向只能传递字符串</span></strong></li></ul><h4><a name="385跳转的时间不同" class="md-header-anchor"></a><span>3.8.5跳转的时间不同</span></h4><ul><li><strong><span>转发时：执行到跳转语句时就会立刻跳转</span></strong></li><li><strong><span>重定向：整个页面执行完之后才执行跳转</span></strong></li></ul><h3><a name="39-转发和重定向使用哪一个" class="md-header-anchor"></a><span>3.9 转发和重定向使用哪一个？</span></h3><p><span>根据上面说明了转发和重定向的区别也可以很容易概括出来</span><strong><span>。转发是带着转发前的请求的参数的。重定向是新的请求</span></strong><span>。</span></p><p><span>典型的应用场景：</span></p><ol start='' ><li><span>转发: 访问 Servlet 处理业务逻辑，然后 forward 到 jsp 显示处理结果，浏览器里 URL 不变</span></li><li><span>重定向: 提交表单，处理成功后 redirect 到另一个 jsp，防止表单重复提交，浏览器里 URL 变了</span></li></ol><hr /><h3><a name="310-requestdispatcher再说明" class="md-header-anchor"></a><span>3.10 RequestDispatcher再说明</span></h3><p><span>RequestDispatcher对象调用forward()可以实现转发上面已经说过了。RequestDispatcher还有另外一个方法include()，该方法可以实现包含，有什么用呢？</span></p><p><span>我们在写网页的时候，一般网</span><strong><span>页的头部和尾部是不需要改变的</span></strong><span>。如果我们</span><strong><span>多个地方使用Servlet输出网头和网尾的话，需要把代码重新写一遍</span></strong><span>。而使用RequestDispatcher的</span><strong><span>include()方法就可以实现包含网头和网尾的效果了</span></strong><span>。</span></p><p>&nbsp;</p><p><span>我们来操作吧！现在我有网头和网尾的Servlet</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d91e13a9d3?w=359&amp;h=394&amp;f=png&amp;s=7958" referrerpolicy="no-referrer"></p><p><span>使用Servlet111将网头和网尾包含</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/Head"</span>).<span class="cm-variable">include</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"--------------------------------------------"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/Foot"</span>).<span class="cm-variable">include</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>访问一下Servlet111,成功把网头和网尾包含了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/1615f9d9298d691d?w=873&amp;h=369&amp;f=png&amp;s=17953" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyx2nezzg306o06o3yb.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h1><a name="cookie" class="md-header-anchor"></a><span>Cookie</span></h1><p>&nbsp;</p><h2><a name="1-什么是会话技术" class="md-header-anchor"></a><span>1. 什么是会话技术</span></h2><blockquote><p><span>基本概念: 指用户开一个浏览器，</span><strong><span>访问一个网站,只要不关闭该浏览器，不管该用户点击多少个超链接，访问多少资源，直到用户关闭浏览器，整个这个过程我们称为一次会话</span></strong><span>.</span></p></blockquote><h2><a name="2-为什么我们要使用会话技术" class="md-header-anchor"></a><span>2. 为什么我们要使用会话技术？</span></h2><p><span>会话跟踪技术可以解决我们很多很多问题。</span></p><ul><li><span>在论坛登陆的时候，</span><strong><span>很多时候会有一个小框框问你是否要自动登陆，当你下次登陆的时候就不用输入密码了</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1b9e06857?w=412&amp;h=412&amp;f=png&amp;s=10406" referrerpolicy="no-referrer"></p><ul><li><strong><span>根据我以前浏览过的商品，猜我喜欢什么商品</span></strong><span>（要猜我喜欢，总得知道”我是谁“）</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1b987e57d?w=1583&amp;h=490&amp;f=png&amp;s=699056" referrerpolicy="no-referrer"></p><hr /><h2><a name="3-cookie" class="md-header-anchor"></a><span>3. Cookie</span></h2><p><strong><span>会话跟踪技术有Cookie和Session</span></strong><span>，</span><strong><span>Cookie技术是先出现的</span></strong><span>。我们先讲Cookie技术吧。</span></p><h3><a name="31-什么是cookie" class="md-header-anchor"></a><span>3.1 什么是Cookie</span></h3><blockquote><p><span>Cookie是由W3C组织提出，最早由netscape社区发展的一种机制</span></p></blockquote><ul><li><span>网页之间的</span><strong><span>交互是通过HTTP协议传输数据的，</span></strong><span>而Http协议是</span><strong><span>无状态的协议</span></strong><span>。无状态的协议是什么意思呢？</span><strong><span>一旦数据提交完后，浏览器和服务器的连接就会关闭，再次交互的时候需要重新建立新的连接</span></strong><span>。</span></li><li><span>服务器无法确认用户的信息，于是乎，W3C就提出了：</span><strong><span>给每一个用户都发一个通行证，无论谁访问的时候都需要携带通行证，这样服务器就可以从通行证上确认用户的信息</span></strong><span>。通行证就是Cookie</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba505779d02b?w=842&amp;h=390&amp;f=png&amp;s=20785" referrerpolicy="no-referrer"></p><hr /><p>&nbsp;</p><p><span>Cookie的流程：浏览器访问服务器，</span><strong><span>如果服务器需要记录该用户的状态，就使用response向浏览器发送一个Cookie，浏览器会把Cookie保存起来。当浏览器再次访问服务器的时候，浏览器会把请求的网址连同Cookie一同交给服务器</span></strong><span>。</span></p><h3><a name="32cookie-api" class="md-header-anchor"></a><span>3.2Cookie API</span></h3><ul><li><span>Cookie类用于创建一个Cookie对象</span></li><li><span>response接口中定义了一个addCookie方法，它用于在其响应头中增加一个相应的Set-Cookie头字段</span></li><li><span>request接口中定义了一个getCookies方法，它用于获取客户端提交的Cookie</span></li></ul><p><span>常用的Cookie方法：</span></p><ul><li><span>public Cookie(String name,String value)</span></li><li><span>setValue与getValue方法 </span></li><li><span>setMaxAge与getMaxAge方法 </span></li><li><span>setPath与getPath方法 </span></li><li><span>setDomain与getDomain方法</span></li><li><span>getName方法 </span></li></ul><h3><a name="33简单使用cookie" class="md-header-anchor"></a><span>3.3简单使用Cookie</span></h3><p><span>创建Cookie对象，发送Cookie给浏览器、</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置response的编码</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//创建Cookie对象，指定名称和值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"username"</span>, <span class="cm-string">"zhongfucheng"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//向浏览器给一个Cookie</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"我已经向浏览器发送了一个Cookie"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><span>浏览器本身没有任何Cookie</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1ba885e8b?w=1079&amp;h=356&amp;f=png&amp;s=17546" referrerpolicy="no-referrer"></p><p><span>访问Servlet1，</span><strong><span>再回到文件夹中，还是没有发现Cookie，这是为什么呢？我明明向浏览器发送了一个Cookie的</span></strong><span>。</span></p><p>&nbsp;</p><p><span>原来</span><strong><span>发送Cookie给浏览器是需要设置Cookie的时间的</span></strong><span>。在给浏览器之前，设置一下Cookie的时间</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置Cookie的时间</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">1000</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>再次访问，已经发现文件夹中多了个Cookie的文本了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1bba8c2da?w=772&amp;h=351&amp;f=png&amp;s=10855" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyxk0p5kj3073073glh.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="4cookie细节" class="md-header-anchor"></a><span>4.Cookie细节</span></h2><h3><a name="41cookie不可跨域名性" class="md-header-anchor"></a><span>4.1Cookie不可跨域名性</span></h3><p><span>很多人在初学的时候可能有一个疑问：在访问Servlet的时候浏览器</span><strong><span>是不是把所有的Cookie都带过去给服务器</span></strong><span>，</span><strong><span>会不会修改了别的网站的Cookie</span></strong></p><p>&nbsp;</p><p><span>答案是否定的。Cookie具有不可跨域名性。浏览器判断</span><strong><span>一个网站是否能操作另一个网站的Cookie的依据是域名</span></strong><span>。所以一般来说，</span><strong><span>当我访问baidu的时候，浏览器只会把baidu颁发的Cookie带过去，而不会带上google的Cookie。</span></strong></p><h3><a name="42-cookie保存中文" class="md-header-anchor"></a><span>4.2 Cookie保存中文</span></h3><p><span>上面我们的例子保存的是英文字符，下面我们来看下保存中文字符会怎么样。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"中国"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"country"</span>, <span class="cm-variable">name</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">2000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"我颁发了一个Cookie，值保存的是中文数据"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><span>访问Servlet1，好吧。出异常了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1bcba9bf4?w=1264&amp;h=578&amp;f=png&amp;s=28832" referrerpolicy="no-referrer"></p><p><strong><span>中文属于Unicode字符，英文数据ASCII字符，中文占4个字符或者3个字符，英文占2个字符。</span></strong><span>解决：</span><strong><span>Cookie使用Unicode字符时需要对Unicode字符进行编码。</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//对Unicode字符进行编码</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"country"</span>, <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">name</span>, <span class="cm-string">"UTF-8"</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>再次访问Servlet1，已经把Cookie成功颁发给浏览器了</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1bf4c839d?w=919&amp;h=254&amp;f=png&amp;s=7971" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1fe11e39b?w=1475&amp;h=151&amp;f=png&amp;s=5677" referrerpolicy="no-referrer"></p><p><span>我们发现Cookie保存在硬盘的中文数据是经过编码的，那么我们在</span><strong><span>取出Cookie的时候要对中文数据进行解码</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">cookies</span>.<span class="cm-variable">length</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getName</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//经过URLEncoding就要URLDecoding</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">URLDecoder</span>.<span class="cm-variable">decode</span>(<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getValue</span>(), <span class="cm-string">"UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">name</span> <span class="cm-operator">+</span> <span class="cm-string">"------"</span> <span class="cm-operator">+</span> <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><span>取出存进Cookie的值</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e1fe39da73?w=1233&amp;h=193&amp;f=png&amp;s=7812" referrerpolicy="no-referrer"></p><h3><a name="43cookie的有效期" class="md-header-anchor"></a><span>4.3Cookie的有效期</span></h3><p><strong><span>Cookie的有效期是通过setMaxAge()来设置的</span></strong><span>。</span></p><ul><li><span>如果MaxAge为</span><strong><span>正数</span></strong><span>，</span><strong><span>浏览器会把Cookie写到硬盘中，只要还在MaxAge秒之前，登陆网站时该Cookie就有效</span></strong><span>【不论关闭了浏览器还是电脑】</span></li><li><span>如果MaxAge为</span><strong><span>负数</span></strong><span>，</span><strong><span>Cookie是临时性的，仅在本浏览器内有效</span></strong><span>，关闭浏览器Cookie就失效了，Cookie不会写到硬盘中。Cookie默认值就是-1。这也就为什么在我第一个例子中，如果我没设置Cookie的有效期，在硬盘中就找不到对应的文件。</span></li><li><span>如果MaxAge为</span><strong><span>0</span></strong><span>，则表示</span><strong><span>删除该Cookie</span></strong><span>。Cookie机制没有提供删除Cookie对应的方法，把MaxAge设置为0等同于删除Cookie</span></li></ul><h3><a name="44-cookie的修改和删除" class="md-header-anchor"></a><span>4.4 Cookie的修改和删除</span></h3><p><span>上面我们已经知道了Cookie机制没有提供删除Cookie的方法。其实细心点我们可以发现，Cookie机制也没有提供修改Cookie的方法。那么我们</span><strong><span>怎么修改Cookie的值呢</span></strong><span>？</span></p><p>&nbsp;</p><p><span>Cookie存储的方式</span><strong><span>类似于Map集合</span></strong><span>，如下图所示</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2004ad196?w=167&amp;h=228&amp;f=png&amp;s=5322" referrerpolicy="no-referrer"></p><p><strong><span>Cookie的名称相同，通过response添加到浏览器中，会覆盖原来的Cookie</span></strong><span>。以country为名保存的是%E4%B8%AD%E5%9B%BD，下面我</span><strong><span>再以country为名，把值改变一下</span></strong><span>。</span>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e238321536?w=1475&amp;h=151&amp;f=png&amp;s=5683" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"看完博客就点赞"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//对Unicode字符进行编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"country"</span>, <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">name</span>, <span class="cm-string">"UTF-8"</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>再次查看Cookie的时候，</span><strong><span>值已经改变了，但是文件还是那一份</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e238035d72?w=1475&amp;h=151&amp;f=png&amp;s=6067" referrerpolicy="no-referrer"></p><p><span>现在我要删除该Cookie，</span><strong><span>把MaxAge设置为0，并添加到浏览器中即可</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"看完博客就点赞"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//对Unicode字符进行编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"country"</span>, <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">name</span>, <span class="cm-string">"UTF-8"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//一定不要忘记添加到浏览器中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"我删除了该Cookie"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><span>访问Servlet，在硬盘已经找不到Cookie的文件了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e238b1ca49?w=1233&amp;h=193&amp;f=png&amp;s=7999" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e23a18f3b4?w=1347&amp;h=589&amp;f=png&amp;s=18212" referrerpolicy="no-referrer"></p><p><span>注意：删除，修改Cookie时，</span><strong><span>新建的Cookie除了value、maxAge之外的所有属性都要与原Cookie相同</span></strong><span>。否则浏览器将</span><strong><span>视为不同的Cookie，不予覆盖，导致删除修改失败</span></strong><span>！我们来试验一下把。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"看完博客就点赞"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//对Unicode字符进行编码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"country"</span>, <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">name</span>, <span class="cm-string">"UTF-8"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//一定不要忘记添加到浏览器中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">10000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2392656ca?w=1523&amp;h=720&amp;f=png&amp;s=40182" referrerpolicy="no-referrer"></p><p><span>上面新建了一个Cookie，我</span><strong><span>修改下Cookie的其他属性，再删除，看能否把Cookie删除掉</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//一定不要忘记添加到浏览器中</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setPath</span>(<span class="cm-string">"/ouzicheng"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"删除一个Cookie"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>结果Cookie还在硬盘中</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e27692c203?w=1348&amp;h=379&amp;f=png&amp;s=8342" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyxzxet3j307d06uglp.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h3><a name="45-cookie的域名" class="md-header-anchor"></a><span>4.5 Cookie的域名</span></h3><p><span>Cookie的</span><strong><span>domain属性决定运行访问Cookie的域名。domain的值规定为“.域名”</span></strong></p><ul><li><span>Cookie的隐私安全机制决定Cookie是不可跨域名的。也就是说</span><a href='http://www.baidu.com' target='_blank' class='url'>www.baidu.com</a><span>和</span><a href='http://www.google.com' target='_blank' class='url'>www.google.com</a><span>之间的Cookie是互不交接的。</span><strong><span>即使是同一级域名，不同二级域名也不能交接</span></strong><span>，也就是说：</span><a href='http://www.goole.com' target='_blank' class='url'>www.goole.com</a><span>和</span><a href='http://www.image.goole.com' target='_blank' class='url'>www.image.goole.com</a><span>的Cookie也不能访问</span></li><li><span>我在本地上</span><strong><span>配置了3个虚拟主机</span></strong><span>，localhost,</span><a href='http://www.zhongfucheng.com,www.image.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com,www.image.zhongfucheng.com</a><span>【如果不知道怎么配置，在我Tomcat的博客有】</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e26ea41868?w=1137&amp;h=639&amp;f=png&amp;s=36043" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e28570077b?w=886&amp;h=290&amp;f=png&amp;s=14864" referrerpolicy="no-referrer"></p><p><span>我用</span><a href='http://www.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com</a><span>域名发送了一个Cookie给浏览器</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"name"</span>, <span class="cm-string">"zhongfucheng"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"使用www.zhongfucheng.com域名添加了一个Cookie"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e287ad79e5?w=1185&amp;h=604&amp;f=png&amp;s=56239" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>首先，证明了Cookie不可跨名性，localhost域名拿不到</span><a href='http://www.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com</a><span>颁发给浏览器的Cookie</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e29e344264?w=1920&amp;h=1040&amp;f=png&amp;s=111819" referrerpolicy="no-referrer"></p><p><span>再使用</span><a href='http://www.image.zhongfucheng.com' target='_blank' class='url'>www.image.zhongfucheng.com</a><span>域名访问,</span><strong><span>证明即使一级域名相同，二级域名不同，也不能获取到Cookie</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2a16b2b17?w=1920&amp;h=1040&amp;f=png&amp;s=122704" referrerpolicy="no-referrer"></p><p><span>当然，使用</span><a href='http://www.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com</a><span>当然能获取到Cookie，Cookie通过请求头带给服务器</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2a1a6b4fe?w=1327&amp;h=739&amp;f=png&amp;s=58715" referrerpolicy="no-referrer"></p><p><span>现在我希望</span><strong><span>一级域名相同的网页Cookie之间可以相互访问。也就是说</span><a href='http://www.image.zhongfucheng.com' target='_blank' class='url'>www.image.zhongfucheng.com</a><span>可以获取到</span><a href='http://www.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com</a><span>的Cookie</span></strong><span>就需要使用到domain方法。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"name"</span>, <span class="cm-string">"ouzicheng"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setDomain</span>(<span class="cm-string">".zhongfucheng.com"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"使用www.zhongfucheng.com域名添加了一个Cookie,只要一级是zhongfucheng.com即可访问"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>使用</span><a href='http://www.zhongfucheng.com' target='_blank' class='url'>www.zhongfucheng.com</a><span>发布一个Cookie</span>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2a195d523?w=1174&amp;h=238&amp;f=png&amp;s=23501" referrerpolicy="no-referrer"></p><p><span>使用</span><a href='http://www.image.zhongfucheng.com' target='_blank' class='url'>www.image.zhongfucheng.com</a><span>域名访问一下。</span><strong><span>发现可以获取到Cookie了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2b3db7f59?w=1174&amp;h=729&amp;f=png&amp;s=59885" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h3><a name="46-cookie的路径" class="md-header-anchor"></a><span>4.6 Cookie的路径</span></h3><p><strong><span>Cookie的path属性决定允许访问Cookie的路径</span></strong><span>。一般地，</span><strong><span>Cookie发布出来，整个网页的资源都可以使用。现在我只想Servlet1可以获取到Cookie，其他的资源不能获取</span></strong><span>。</span></p><p>&nbsp;</p><p><span>使用Servlet2颁发一个Cookie给浏览器,设置路径为&quot;/Servlet1&quot;。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"username"</span>, <span class="cm-string">"java"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setPath</span>(<span class="cm-string">"/Servlet1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"该Cookie只有Servlet1获取得到"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>使用Servlet3访问服务器，看看浏览器是否把Cookie带上。显然，浏览器访问Servlet3并没有把Cookie带上。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2bd640d09?w=1174&amp;h=729&amp;f=png&amp;s=77560" referrerpolicy="no-referrer"></p><p><span>使用Servlet1访问服务器，看看浏览器是否把Cookie带上。答案是肯定的！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2ef26f80e?w=1174&amp;h=729&amp;f=png&amp;s=55210" referrerpolicy="no-referrer"></p><hr /><h3><a name="47-cookie的安全属性" class="md-header-anchor"></a><span>4.7 Cookie的安全属性</span></h3><ul><li><span>HTTP协议不仅仅是无状态的，而且是不安全的！如果不希望Cookie在非安全协议中传输，可以</span><strong><span>设置Cookie的secure属性为true，浏览器只会在HTTPS和SSL等安全协议中传输该Cookie</span></strong><span>。</span></li><li><span>当然了，设置secure属性不会将Cookie的内容加密。如果想要保证安全，最好使用md5算法加密【后面有】。</span></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyycpfyog308c08cmyo.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h2><a name="5-cookie的应用" class="md-header-anchor"></a><span>5. Cookie的应用</span></h2><h3><a name="51显示用户上次访问的时间" class="md-header-anchor"></a><span>5.1显示用户上次访问的时间</span></h3><ul><li><p><span>其实就是</span><strong><span>每次登陆的时候，取到Cookie保存的值，再更新下Cookie的值</span></strong><span>。</span></p></li><li><p><span>访问Serlvet有两种情况</span></p><ul><li><span>第一次访问</span></li><li><span>已经访问过了</span></li></ul></li><li><p><span>全部代码如下：</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">SimpleDateFormat</span> <span class="cm-variable">simpleDateFormat</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>(<span class="cm-string">"yyyy-MM-dd HH:mm:ss"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取网页上所有的Cookie</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//判断Cookie的值是否为空</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">cookieValue</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">cookies</span>.<span class="cm-variable">length</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//获取到以time为名的Cookie</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getName</span>().<span class="cm-variable">equals</span>(<span class="cm-string">"time"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"您上次登陆的时间是："</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cookieValue</span> <span class="cm-operator">=</span> <span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">cookieValue</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">setValue</span>(<span class="cm-variable">simpleDateFormat</span>.<span class="cm-variable">format</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Date</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//既然已经找到了就可以break循环了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//如果Cookie的值是空的，那么就是第一次访问</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">cookieValue</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//创建一个Cookie对象，日期为当前时间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"time"</span>, <span class="cm-variable">simpleDateFormat</span>.<span class="cm-variable">format</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Date</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//设置Cookie的生命期</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">20000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//response对象回送Cookie给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"您是第一次登陆啊！"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 902px;"></div><div class="CodeMirror-gutters" style="display: none; height: 902px;"></div></div></div></pre><ul><li><strong><span>按照正常的逻辑来写，程序流程应该是这样子的。先创建Cookie对象，回送Cookie给浏览器。再遍历Cookie，更新Cookie的值</span></strong><span>。</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2d890fbb4?w=826&amp;h=442&amp;f=png&amp;s=25152" referrerpolicy="no-referrer"></p><ul><li><span>但是，按照上面的逻辑是做不到的！</span><strong><span>因为每次访问Servlet的时候都会覆盖原来的Cookie，取到Cookie的值永远都是当前时间，而不是上次保存的时间。</span></strong></li><li><span>我们换一个逻辑写：</span><strong><span>先检查（遍历）所有Cookie有没有我要的，如果得不到我想要的Cookie，Cookie的值是null，那么就是第一次登陆</span></strong><span>，于是就有了上面的代码了。</span></li></ul><ul><li><span>我们来看下效果吧！当我第一次登陆的时候</span></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e2f62572a0?w=1566&amp;h=578&amp;f=png&amp;s=11238" referrerpolicy="no-referrer"></p><p><span>Cookie保存在硬盘中。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e31a745a66?w=1475&amp;h=151&amp;f=png&amp;s=5729" referrerpolicy="no-referrer"></p><p><span>再次访问Servlet。</span><strong><span>明显地，取到的就是Cookie的值</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e329bcd824?w=1566&amp;h=578&amp;f=png&amp;s=12049" referrerpolicy="no-referrer"></p><h3><a name="52显示上次浏览过商品" class="md-header-anchor"></a><span>5.2显示上次浏览过商品</span></h3><p><span>我就以书籍为例子了！</span><strong><span>首先设计Book对象</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">id</span> ;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">name</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">author</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Book</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-variable">Book</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">id</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">author</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">name</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">author</span> <span class="cm-operator">=</span> <span class="cm-variable">author</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span>...<span class="cm-variable">各种set、get方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>设计一个简单的数据库存储数据。就用</span><strong><span>LinkedHashMap集合【根据商品的id找书籍所以用Map，删改较多所以用Linked】</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">linkedHashMap</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedHashMap</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//简化开发复杂度，book的id和商品的id相同</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">put</span>(<span class="cm-string">"1"</span>, <span class="cm-keyword">new</span> <span class="cm-variable">Book</span>(<span class="cm-string">"1"</span>, <span class="cm-string">"javaweb"</span>, <span class="cm-string">"zhong"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">put</span>(<span class="cm-string">"2"</span>, <span class="cm-keyword">new</span> <span class="cm-variable">Book</span>(<span class="cm-string">"2"</span>, <span class="cm-string">"java"</span>, <span class="cm-string">"fu"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">put</span>(<span class="cm-string">"3"</span>, <span class="cm-keyword">new</span> <span class="cm-variable">Book</span>(<span class="cm-string">"3"</span>, <span class="cm-string">"oracle"</span>, <span class="cm-string">"cheng"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">put</span>(<span class="cm-string">"4"</span>, <span class="cm-keyword">new</span> <span class="cm-variable">Book</span>(<span class="cm-string">"4"</span>, <span class="cm-string">"mysql"</span>, <span class="cm-string">"ou"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">put</span>(<span class="cm-string">"5"</span>, <span class="cm-keyword">new</span> <span class="cm-variable">Book</span>(<span class="cm-string">"5"</span>, <span class="cm-string">"ajax"</span>, <span class="cm-string">"zi"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到所有书籍</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">LinkedHashMap</span> <span class="cm-def">getAll</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">linkedHashMap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 396px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><p><strong><span>显示网页上所有的书籍【首页】</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"网页上所有的书籍："</span><span class="cm-operator">+</span><span class="cm-string">"&lt;br/&gt;"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//拿到数据库所有的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">linkedHashMap</span> <span class="cm-operator">=</span> <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable">Map</span>.<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;&gt;</span> <span class="cm-variable">entry</span> <span class="cm-operator">=</span> <span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">entrySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//显示所有的书到网页上</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">Map</span>.<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">stringBookEntry</span> : <span class="cm-variable">entry</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> <span class="cm-variable">stringBookEntry</span>.<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">book</span>.<span class="cm-variable">getId</span>() <span class="cm-operator">+</span><span class="cm-string">" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "</span><span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e330cffe74?w=1005&amp;h=335&amp;f=png&amp;s=21084" referrerpolicy="no-referrer"></p><p><span>接着，我们要做的就是</span><strong><span>给显示的书籍挂上一个超链接</span></strong><span>，当用户点击想看的书籍时，就</span><strong><span>跳转到该书籍的详细信息页面</span></strong></p><p><strong><span>超链接应该把书的id传递过去，不然处理页面是不知道用户想看的是哪一本书的！</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//显示所有的书到网页上</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">Map</span>.<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">stringBookEntry</span> : <span class="cm-variable">entry</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> <span class="cm-variable">stringBookEntry</span>.<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;a href='/ouzicheng/Servlet2?id="</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getId</span>() <span class="cm-operator">+</span> <span class="cm-string">"''target=_blank' +"</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getName</span>() <span class="cm-operator">+</span> <span class="cm-string">"&lt;/a&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e34899125a?w=1005&amp;h=335&amp;f=png&amp;s=22551" referrerpolicy="no-referrer"></p><p><strong><span>接收id，找到用户想要看哪一本书，输出该书的详细信息</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"id"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//由于book的id和商品的id是一致的。获取到用户点击的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> (<span class="cm-variable">Book</span>) <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>().<span class="cm-variable">get</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//输出书的详细信息</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"书的编号是："</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getId</span>()<span class="cm-operator">+</span><span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"书的名称是："</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"书的作者是："</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getAuthor</span>()<span class="cm-operator">+</span><span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 220px;"></div><div class="CodeMirror-gutters" style="display: none; height: 220px;"></div></div></div></pre><p><span>点击想要的书籍。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e36a3dc312?w=1005&amp;h=519&amp;f=png&amp;s=25550" referrerpolicy="no-referrer"></p><p><span>得到书籍的详细信息</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e3728e8bfd?w=1005&amp;h=519&amp;f=png&amp;s=24723" referrerpolicy="no-referrer"></p><p><span>既然用户点击了书籍，那么</span><strong><span>服务器就应该颁发Cookie给浏览器，记住用户点击了该书籍</span></strong><span>。现在问题来了，Cookie的值应该是什么呢？试想一下，</span><strong><span>待会还要把浏览过的书籍显示出来，所以用书籍的id是最好不过的</span></strong><span>。想到了用书籍的id作为Cookie的值，我们还要定义一些规则！</span></p><p>&nbsp;</p><p><span>我们可能有非常多的书籍，不可能把用户浏览过的书籍都显示出来。所以我们定义</span><strong><span>只能显示3本浏览过的书籍</span></strong></p><p><span>书籍的id都是数字，</span><strong><span>如果不做任何修改，存到Cookie里边可能就是231，345，123此类的数字</span></strong><span>，这样</span><strong><span>取出某一个id的时候就十分费劲并且后面还要判断该书是否存在Cookie里边了</span></strong><span>，所以我们要把存储到Cookie的书籍id分割起来。所以</span><strong><span>我们定义”_“作为分隔符</span></strong></p><p><span>按上面的应用，</span><strong><span>我们的逻辑应该是：先遍历下Cookie，看下有没有我们想要的Cookie。如果找到想要的Cookie，那就取出Cookie的值</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">bookHistory</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">cookies</span>.<span class="cm-variable">length</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getName</span>().<span class="cm-variable">equals</span>(<span class="cm-string">"bookHistory"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">bookHistory</span> <span class="cm-operator">=</span> <span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><ul><li><p><span>取出了Cookie的值也分几种情况</span></p><ol start='' ><li><span>Cookie的值为null【直接把传入进来的id当做是Cookie的值】</span></li><li><span>Cookie的值长度有3个了【把排在最后的id去掉，把传进来的id排在最前边】</span></li><li><span>Cookie的值已经包含有传递进来的id了【把已经包含的id先去掉，再把id排在最前面】</span></li><li><span>Cookie的值就只有1个或2个，直接把id排在最前边</span></li></ol></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">bookHistory</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">id</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//如果Cookie的值不是null的，那么就分解Cookie的得到之前的id。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span>[] <span class="cm-variable">strings</span> <span class="cm-operator">=</span> <span class="cm-variable">bookHistory</span>.<span class="cm-variable">split</span>(<span class="cm-string">"\\_"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//为了增删容易并且还要判断id是否存在于该字符串内-----我们使用LinkedList集合装载分解出来的id</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">List</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-variable">Arrays</span>.<span class="cm-variable">asList</span>(<span class="cm-variable">strings</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LinkedList</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span> <span class="cm-variable">linkedList</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">LinkedList</span><span class="cm-operator">&lt;&gt;</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">linkedList</span>.<span class="cm-variable">addAll</span>(<span class="cm-variable">list</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">linkedList</span>.<span class="cm-variable">contains</span>(<span class="cm-variable">id</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedList</span>.<span class="cm-variable">remove</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">linkedList</span>.<span class="cm-variable">addFirst</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}<span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">linkedList</span>.<span class="cm-variable">size</span>() <span class="cm-operator">&gt;=</span> <span class="cm-number">3</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">linkedList</span>.<span class="cm-variable">removeLast</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">linkedList</span>.<span class="cm-variable">addFirst</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  } <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">linkedList</span>.<span class="cm-variable">addFirst</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>这么折腾完了，我们的Cookie值就在LinkedList集合里边了。接下来，</span><strong><span>我们要做的就是把集合中的值取出来，拼接成一个字符串</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">StringBuffer</span> <span class="cm-variable">stringBuffer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">StringBuffer</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//遍历LinkedList集合，添加个下划线“_”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">String</span> <span class="cm-variable">s</span> : <span class="cm-variable">linkedList</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">stringBuffer</span>.<span class="cm-variable">append</span>(<span class="cm-variable">s</span> <span class="cm-operator">+</span> <span class="cm-string">"_"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//最后一个元素后面就不需要下划线了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">stringBuffer</span>.<span class="cm-variable">deleteCharAt</span>(<span class="cm-variable">stringBuffer</span>.<span class="cm-variable">length</span>() <span class="cm-operator">-</span> <span class="cm-number">1</span>).<span class="cm-variable">toString</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>好的，我们现在已经完成了Cookie值了。接下来设置Cookie的生命周期，回送给浏览器即可</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">bookHistory</span> <span class="cm-operator">=</span> <span class="cm-variable">makeHistory</span>(<span class="cm-variable">request</span>, <span class="cm-variable">id</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"bookHistory"</span>, <span class="cm-variable">bookHistory</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">30000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>既然我们已经把Cookie回送给浏览器了。那么接下来我们</span><strong><span>就在首页上获取Cookie的值，显示用户浏览过什么商品就行了</span></strong><span>！</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"您曾经浏览过的商品："</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//显示用户浏览过的商品</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">cookies</span>.<span class="cm-variable">length</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getName</span>().<span class="cm-variable">equals</span>(<span class="cm-string">"bookHistory"</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//获取到的bookHistory是2_3_1之类的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">bookHistory</span> <span class="cm-operator">=</span> <span class="cm-variable">cookies</span>[<span class="cm-variable">i</span>].<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//拆解成每一个id值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">String</span>[] <span class="cm-variable">ids</span> <span class="cm-operator">=</span> <span class="cm-variable">bookHistory</span>.<span class="cm-variable">split</span>(<span class="cm-string">"\\_"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//得到每一个id值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">String</span> <span class="cm-variable">id</span> : <span class="cm-variable">ids</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-comment">//通过id找到每一本书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> <span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">get</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">book</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 638px;"></div><div class="CodeMirror-gutters" style="display: none; height: 638px;"></div></div></div></pre><p><span>好的，我们来试验一下吧！！，第一次访问首页，并没有浏览过的商品</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e39c692722?w=1103&amp;h=373&amp;f=png&amp;s=23799" referrerpolicy="no-referrer"></p><p><span>当我点击javaweb书籍再访问首页的时候</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e3a812dab6?w=1103&amp;h=373&amp;f=png&amp;s=26442" referrerpolicy="no-referrer"></p><p><span>再点击ajax然后访问首页</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e3aa21e338?w=1103&amp;h=373&amp;f=png&amp;s=27038" referrerpolicy="no-referrer"></p><p><span>再点击javaweb然后访问首页</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e3b313e3fc?w=1103&amp;h=373&amp;f=png&amp;s=27090" referrerpolicy="no-referrer"></p><p><span>点击oracle然后访问首页</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/161609e3b8092589?w=1103&amp;h=373&amp;f=png&amp;s=27617" referrerpolicy="no-referrer"></p><p><span>好的，经过测试，该程序应该没有什么问题了！</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyz2o9x6g308c08cmxn.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h1><a name="session" class="md-header-anchor"></a><span>Session</span></h1><h2><a name="1-什么是session" class="md-header-anchor"></a><span>1. 什么是Session</span></h2><blockquote><p><span>Session 是另一种记录浏览器状态的机制。不同的是Cookie保存在浏览器中，Session保存在服务器中。用户使用浏览器访问服务器的时候，服务器把用户的信息以某种的形式记录在服务器，这就是Session</span></p></blockquote><p><span>如果说Cookie是检查用户身上的”通行证“来确认用户的身份，那么Session就是通过检查服务器上的”客户明细表“来确认用户的身份的。Session相当于在服务器中建立了一份“客户明细表”。</span></p><h2><a name="2-为什么要使用session技术" class="md-header-anchor"></a><span>2. 为什么要使用Session技术？</span></h2><p><strong><span>Session比Cookie使用方便，Session可以解决Cookie解决不了的事情【Session可以存储对象，Cookie只能存储字符串。】。</span></strong></p><h2><a name="3-session--api" class="md-header-anchor"></a><span>3. Session  API</span></h2><ul><li><span>long getCreationTime();【获取Session被创建时间】</span></li><li><strong><span>String getId();【获取Session的id】</span></strong></li><li><span>long getLastAccessedTime();【返回Session最后活跃的时间】</span></li><li><span>ServletContext getServletContext();【获取ServletContext对象】</span></li><li><strong><span>void setMaxInactiveInterval(int var1);【设置Session超时时间】</span></strong></li><li><strong><span>int getMaxInactiveInterval();【获取Session超时时间】</span></strong></li><li><strong><span>Object getAttribute(String var1);【获取Session属性</span></strong><span>】</span></li><li><span>Enumeration</span><String><span> getAttributeNames();【获取Session所有的属性名】</span></li><li><strong><span>void setAttribute(String var1, Object var2);【设置Session属性】</span></strong></li><li><strong><span>void removeAttribute(String var1);【移除Session属性】</span></strong></li><li><strong><span>void invalidate();【销毁该Session】</span></strong></li><li><span>boolean isNew();【该Session是否为新的】</span></li></ul><h2><a name="4session作为域对象" class="md-header-anchor"></a><span>4.Session作为域对象</span></h2><p><span>从上面的API看出，Session有着request和ServletContext类似的方法。其实</span><strong><span>Session也是一个域对象</span></strong><span>。Session作为一种记录浏览器状态的机制，</span><strong><span>只要Session对象没有被销毁，Servlet之间就可以通过Session对象实现通讯</span></strong></p><p>&nbsp;</p><p><span>我们来试试吧，在Servlet4中设置Session属性</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到Session对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置Session属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"name"</span>, <span class="cm-string">"看完博客就要点赞！！"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>在Servlet5中获取到Session存进去的属性</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到从Servlet4的Session存进去的值</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">httpSession</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"name"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">value</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>访问Servlet4，再访问Servlet5</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1fd0533ffd?w=1029&amp;h=602&amp;f=png&amp;s=21497" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><span>一般来讲，当我们要存进的是</span><strong><span>用户级别的数据就用Session</span></strong><span>，那什么是用户级别呢？</span><strong><span>只要浏览器不关闭，希望数据还在，就使用Session来保存</span></strong><span>。</span></p><h2><a name="5-session的生命周期和有效期" class="md-header-anchor"></a><span>5. Session的生命周期和有效期</span></h2><p><span>Session在用户</span><strong><span>第一次访问服务器Servlet，jsp等动态资源就会被自动创建，Session对象保存在内存里</span></strong><span>，这也就为什么上面的例子可以</span><strong><span>直接使用request对象获取得到Session对象</span></strong><span>。如果访问HTML,IMAGE等静态资源Session不会被创建。</span></p><p>&nbsp;</p><p><span>Session生成后，只要用户继续访问，服务器就会更新Session的最后访问时间，无论</span><strong><span>是否对Session进行读写，服务器都会认为Session活跃了一次</span></strong><span>。</span></p><p>&nbsp;</p><p><span>由于会有越来越多的用户访问服务器，因此Session也会越来越多。</span><strong><span>为了防止内存溢出，服务器会把长时间没有活跃的Session从内存中删除，这个时间也就是Session的超时时间</span></strong><span>。</span></p><p><span>Session的超时时间默认是30分钟，有三种方式可以对Session的超时时间进行修改</span></p><p>&nbsp;</p><p><span>第一种方式：</span><strong><span>在tomcat/conf/web.xml文件中设置，时间值为20分钟，</span></strong><span>所有的WEB应用都有效</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">session-config</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">session-timeout</span><span class="cm-tag cm-bracket">&gt;</span>20<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">session-timeout</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">session-config</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1f906bd6ed?w=977&amp;h=331&amp;f=png&amp;s=10257" referrerpolicy="no-referrer"></p><p><strong><span>第二种方式：</span></strong><span>在单个的web.xml文件中设置，对单个web应用有效，</span><strong><span>如果有冲突，以自己的web应用为准</span></strong><span>。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">session-config</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">session-timeout</span><span class="cm-tag cm-bracket">&gt;</span>20<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">session-timeout</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">session-config</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tab" role="presentation" cm-text="	"> </span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><strong><span>第三种方式：</span></strong><span>通过setMaxInactiveInterval()方法设置</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置Session最长超时时间为60秒，这里的单位是秒</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">httpSession</span>.<span class="cm-variable">setMaxInactiveInterval</span>(<span class="cm-number">60</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">httpSession</span>.<span class="cm-variable">getMaxInactiveInterval</span>());</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1f9041ed5f?w=881&amp;h=314&amp;f=png&amp;s=12446" referrerpolicy="no-referrer"></p><p><span>Session的有效期与Cookie的是不同的</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1f905d0cbf?w=770&amp;h=516&amp;f=png&amp;s=83117" referrerpolicy="no-referrer"></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyzin9wzj3073073mx3.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h2><a name="6-使用session完成简单的购物功能" class="md-header-anchor"></a><span>6. 使用Session完成简单的购物功能</span></h2><p><span>我们还是以书籍为例，所以可以copy“显示浏览过的商品“例子部分的代码。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=UTF-8"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">PrintWriter</span> <span class="cm-variable">printWriter</span> <span class="cm-operator">=</span> <span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"网页上所有的书籍："</span> <span class="cm-operator">+</span> <span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//拿到数据库所有的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">LinkedHashMap</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">linkedHashMap</span> <span class="cm-operator">=</span> <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Set</span><span class="cm-operator">&lt;</span><span class="cm-variable">Map</span>.<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;&gt;</span> <span class="cm-variable">entry</span> <span class="cm-operator">=</span> <span class="cm-variable">linkedHashMap</span>.<span class="cm-variable">entrySet</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//显示所有的书到网页上</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-variable">Map</span>.<span class="cm-variable">Entry</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">stringBookEntry</span> : <span class="cm-variable">entry</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> <span class="cm-variable">stringBookEntry</span>.<span class="cm-variable">getValue</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">url</span> <span class="cm-operator">=</span> <span class="cm-string">"/ouzicheng/Servlet6?id="</span> <span class="cm-operator">+</span> <span class="cm-variable">book</span>.<span class="cm-variable">getId</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">book</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;a href='"</span> <span class="cm-operator">+</span> <span class="cm-variable">url</span> <span class="cm-operator">+</span> <span class="cm-string">"'&gt;购买&lt;/a&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><span>在购物车页面上，获取到用户想买的书籍【用户可能不单想买一本书，于是乎，就用一个List容器装载书籍】，有了：</span><strong><span>先遍历Cookie，再判断是否是第一次访问Servlet的逻辑思路</span></strong><span>，我们就可以先获取到Session的属性，如果Session的属性为null，那么就是还没有该属性</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到用户想买书籍的id</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"id"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//根据书籍的id找到用户想买的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> (<span class="cm-variable">Book</span>) <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>().<span class="cm-variable">get</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到Session对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//由于用户可能想买多本书的，所以我们用一个容器装着书籍</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">List</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> (<span class="cm-variable">List</span>) <span class="cm-variable">httpSession</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"list"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">list</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//设置Session属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"list"</span>,<span class="cm-variable">list</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把书籍加入到list集合中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-variable">book</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>按我们正常的逻辑思路：先创建一个ArrayList对象，把书加到list集合中，然后设置Session的属性。</span><strong><span>这样是行不通的</span></strong><span>。每次Servlet被访问的时候都会创建一个ArrayList集合，书籍会被分发到不同的ArrayList中去。所以下面的代码是不行的！</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到用户想买书籍的id</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"id"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//根据书籍的id找到用户想买的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> (<span class="cm-variable">Book</span>) <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>().<span class="cm-variable">get</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到Session对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//创建List集合</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">List</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-variable">book</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"list"</span>, <span class="cm-variable">list</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>既然用户已经购买了书籍，那么也应该给提供页面显示用户购买过哪些书籍</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到用户想买书籍的id</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"id"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//根据书籍的id找到用户想买的书</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Book</span> <span class="cm-variable">book</span> <span class="cm-operator">=</span> (<span class="cm-variable">Book</span>) <span class="cm-variable">DB</span>.<span class="cm-variable">getAll</span>().<span class="cm-variable">get</span>(<span class="cm-variable">id</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到Session对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//由于用户可能想买多本书的，所以我们用一个容器装着书籍</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">List</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> (<span class="cm-variable">List</span>) <span class="cm-variable">httpSession</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"list"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">list</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//设置Session属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"list"</span>,<span class="cm-variable">list</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把书籍加入到list集合中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-variable">book</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">url</span> <span class="cm-operator">=</span> <span class="cm-string">"/ouzicheng/Servlet7"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-variable">url</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><p><span>列出用户购买过的书籍</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//要得到用户购买过哪些书籍，得到Session的属性遍历即可</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">Book</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> (<span class="cm-variable">List</span>) <span class="cm-variable">httpSession</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"list"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">list</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">||</span> <span class="cm-variable">list</span>.<span class="cm-variable">size</span>() <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"对不起，你还没有买过任何商品"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} <span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"您购买过以下商品："</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">Book</span> <span class="cm-variable">book</span> : <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">book</span>.<span class="cm-variable">getName</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-string">"&lt;br/&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><p><span>效果如下</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1f93825692?w=1028&amp;h=283&amp;f=png&amp;s=20824" referrerpolicy="no-referrer"></p><h2><a name="7session的实现原理" class="md-header-anchor"></a><span>7.Session的实现原理</span></h2><p><span>用现象说明问题，我</span><strong><span>在Servlet4中的代码设置了Session的属性</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//得到Session对象</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置Session属性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"name"</span>, <span class="cm-string">"看完博客就要点赞！！"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>接着在Servlet7把Session的属性取出来</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">getAttribute</span>(<span class="cm-string">"name"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">printWriter</span>.<span class="cm-variable">write</span>(<span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>自然地，我们</span><strong><span>能取到在Servlet4中Session设置的属性</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1f936eb7df?w=1235&amp;h=134&amp;f=png&amp;s=7422" referrerpolicy="no-referrer"></p><p><span>接着，我在浏览器中新建一个会话，再次访问Servlet7</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1fdc46ae75?w=1566&amp;h=463&amp;f=png&amp;s=22440" referrerpolicy="no-referrer"></p><p><span>发现报了空指针异常的错误</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1fdd9732ba?w=1235&amp;h=429&amp;f=png&amp;s=21069" referrerpolicy="no-referrer"></p><p><span>现在问题来了：</span><strong><span>服务器是如何实现一个session为一个用户浏览器服务的？换个说法：为什么服务器能够为不同的用户浏览器提供不同session？</span></strong></p><p>&nbsp;</p><p><span>HTTP协议是无状态的，</span><strong><span>Session不能依据HTTP连接来判断是否为同一个用户</span></strong><span>。于是乎：</span><strong><span>服务器向用户浏览器发送了一个名为JESSIONID的Cookie，它的值是Session的id值</span></strong><span>。其实Session依据Cookie来识别是否是同一个用户。</span></p><p>&nbsp;</p><p><span>简单来说：Session </span><strong><span>之所以可以识别不同的用户，依靠的就是Cookie</span></strong></p><p>&nbsp;</p><p><span>该Cookie是</span><strong><span>服务器自动颁发给浏览器的</span></strong><span>，不用我们手工创建的。</span><strong><span>该Cookie的maxAge值默认是-1，也就是说仅当前浏览器使用，不将该Cookie存在硬盘中</span></strong></p><p>&nbsp;</p><p><span>我们来捋一捋思路流程：当我们访问Servlet4的时候，</span><strong><span>服务器就会创建一个Session对象，执行我们的程序代码，并自动颁发个Cookie给用户浏览器</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f1ff929f22a?w=1246&amp;h=583&amp;f=png&amp;s=55515" referrerpolicy="no-referrer"></p><p><span>当我们</span><strong><span>用同一个浏览器访问Servlet7</span></strong><span>的时候，</span><strong><span>浏览器会把Cookie的值通过http协议带过去给服务器，服务器就知道用哪一Session</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f202c181484?w=1246&amp;h=583&amp;f=png&amp;s=57702" referrerpolicy="no-referrer"></p><p><span>而当我们</span><strong><span>使用新会话的浏览器访问Servlet7的时候</span></strong><span>，</span><strong><span>该新浏览器并没有Cookie，服务器无法辨认使用哪一个Session，所以就获取不到值</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz01y1rfg306o06oweh.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><p>&nbsp;</p><h2><a name="8浏览器禁用了cookiesession还能用吗" class="md-header-anchor"></a><span>8.浏览器禁用了Cookie，Session还能用吗？</span></h2><p><span>上面说了Session是依靠Cookie来识别用户浏览器的。如果我的用户浏览器禁用了Cookie了呢？绝大多数的手机浏览器都不支持Cookie，那我的Session怎么办？</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f202efb2f94?w=1230&amp;h=466&amp;f=png&amp;s=30873" referrerpolicy="no-referrer"></p><p><span>好的，我们来看看情况是怎么样的。用户浏览器访问Servlet4的时候，服务器向用户浏览器颁发了一个Cookie</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f2049be75e8?w=1246&amp;h=583&amp;f=png&amp;s=53992" referrerpolicy="no-referrer"></p><p><span>但是呢，当用户浏览器访问Servlet7的时候，由于我们</span><strong><span>禁用了Cookie，所以用户浏览器并没有把Cookie带过去给服务器</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f2072d3eb09?w=1246&amp;h=583&amp;f=png&amp;s=77888" referrerpolicy="no-referrer"></p><p><span>一看，Session好像不能用了。但是Java Web提供了解决方法：</span><strong><span>URL地址重写</span></strong></p><p><span>HttpServletResponse类提供了两个URL地址重写的方法：</span></p><ul><li><strong><span>encodeURL(String url)</span></strong></li><li><strong><span>encodeRedirectURL(String url)</span></strong></li></ul><p><span>需要值得注意的是：这两个方法会自动判断该浏览器是否支持Cookie，如果支持Cookie，重写后的URL地址就不会带有jsessionid了【当然了，即使浏览器支持Cookie，第一次输出URL地址的时候还是会出现jsessionid（因为没有任何Cookie可带）】</span></p><p><span>下面我们就以上面“购物”的例子来做试验吧！</span><strong><span>首先我们来看看禁用掉Cookie对原来的小例子有什么影响</span></strong><span>。</span></p><p><span>访问Servlet1，随便点击一本书籍购买</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20896f8452?w=598&amp;h=309&amp;f=png&amp;s=19407" referrerpolicy="no-referrer"></p><p><span>无论点击多少次，都会直接提示我们有买过任何商品</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20aa54abd7?w=996&amp;h=583&amp;f=png&amp;s=39062" referrerpolicy="no-referrer"></p><p><span>原因也非常简单，没有Cookie传递给服务器，</span><strong><span>服务器每次创建的时候都是新的Session</span></strong><span>，导致最后获取到的List集合一定是空的。</span></p><p><strong><span>不同Servlet获取到的Session的id号都是不同的</span></strong><span>。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f2098264d3a?w=666&amp;h=220&amp;f=png&amp;s=5813" referrerpolicy="no-referrer"></p><p><span>下面我们就对URL进行重写，看看能不能恢复没有禁掉Cookie之前的效果。</span></p><p><span>原则：</span><strong><span>把Session的属性带过去【传递给】另外一个Servlet，都要URL地址重写</span></strong></p><p><span>在跳转到显示购买过商品的Servlet的时候，URL地址重写。</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">url</span> <span class="cm-operator">=</span> <span class="cm-string">"/ouzicheng/Servlet7"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-variable">response</span>.<span class="cm-variable">encodeURL</span>(<span class="cm-variable">url</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>再次访问Servlet1，当我点击javaweb的时候，已经能够成功出现我买过的商品了。并且</span><strong><span>Session的id通过URL地址重写，使用的是同一个Session</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20b5625e0c?w=1035&amp;h=334&amp;f=png&amp;s=21299" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20df22bf39?w=658&amp;h=285&amp;f=png&amp;s=7303" referrerpolicy="no-referrer"></p><p><span>URL地址重写的原理：</span><strong><span>将Session的id信息重写到URL地址中</span></strong><span>。</span><strong><span>服务器解析重写后URL，获取Session的id</span></strong><span>。这样一来，即使浏览器禁用掉了Cookie，但Session的id通过服务器端传递，还是可以使用Session来记录用户的状态。</span></p><h2><a name="9session禁用cookie" class="md-header-anchor"></a><span>9.Session禁用Cookie</span></h2><p><span>Java Web规范支持通过配置禁用Cookie，禁用自己项目的Cookie，</span><strong><span>在META-INF文件夹下的context.xml文件中修改（没有则创建）</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20f8e929dd?w=873&amp;h=249&amp;f=png&amp;s=10986" referrerpolicy="no-referrer"></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-meta">&lt;?xml</span> <span class="cm-meta">version='1.0' encoding='utf-8'?&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Context</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/ouzicheng"</span> <span class="cm-attribute">cookies</span>=<span class="cm-string">"false"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">Context</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>禁用全部web应用的Cookie</span></p><ul><li><strong><span>在conf/context.xml中修改</span></strong></li></ul><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f20f7170b6e?w=1145&amp;h=512&amp;f=png&amp;s=19525" referrerpolicy="no-referrer"></p><p><span>注意：</span><strong><span>该配置只是让服务器不能自动维护名为jsessionid的Cookie，并不能阻止Cookie的读写。</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz0ljrp5g306o06o416.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h2><a name="10session案例" class="md-header-anchor"></a><span>10.Session案例</span></h2><h3><a name="101使用session完成用户简单登陆" class="md-header-anchor"></a><span>10.1使用Session完成用户简单登陆</span></h3><p><span>先创建User类</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-variable">password</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">User</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">User</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">password</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-variable">username</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">this</span>.<span class="cm-variable">password</span> <span class="cm-operator">=</span> <span class="cm-variable">password</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">....<span class="cm-variable">各种set、get方法</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><ul><li><span>使用简单的集合模拟一个数据库</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-variable">List</span><span class="cm-operator">&lt;</span><span class="cm-variable">User</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">ArrayList</span><span class="cm-operator">&lt;&gt;</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//装载些数据进数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">static</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"aaa"</span>,<span class="cm-string">"111"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"bbb"</span>,<span class="cm-string">"222"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">list</span>.<span class="cm-variable">add</span>(<span class="cm-keyword">new</span> <span class="cm-variable">User</span>(<span class="cm-string">"ccc"</span>,<span class="cm-string">"333"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通过用户名和密码查找用户</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">User</span> <span class="cm-def">find</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">password</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable">User</span> <span class="cm-variable">user</span> : <span class="cm-variable">list</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">user</span>.<span class="cm-variable">getUsername</span>().<span class="cm-variable">equals</span>(<span class="cm-variable">username</span>) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">user</span>.<span class="cm-variable">getPassword</span>().<span class="cm-variable">equals</span>(<span class="cm-variable">password</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">user</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>表单提交的工作我就在jsp写了，如果在Servlet写太麻烦了！</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/ouzicheng/LoginServlet"</span> <span class="cm-attribute">method</span>=<span class="cm-string">"post"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  用户名：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  密码：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"password"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"提交"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">form</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><strong><span>获取到表单提交的数据，查找数据库是否有相对应的用户名和密码</span></strong><span>。如果没有就提示用户名或密码出错了，如果有就跳转到另外一个页面</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"username"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">password</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"password"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">User</span> <span class="cm-variable">user</span> <span class="cm-operator">=</span> <span class="cm-variable">UserDB</span>.<span class="cm-variable">find</span>(<span class="cm-variable">username</span>, <span class="cm-variable">password</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//如果找不到，就是用户名或密码出错了。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">user</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"you can't login"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//标记着该用户已经登陆了！</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HttpSession</span> <span class="cm-variable">httpSession</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">httpSession</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"user"</span>, <span class="cm-variable">user</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//跳转到其他页面，告诉用户成功登陆了。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-variable">response</span>.<span class="cm-variable">encodeURL</span>(<span class="cm-string">"index.jsp"</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><p><span>我们来试试下数据库没有的用户名和密码，提示我不能登陆。</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f21176b331c?w=1010&amp;h=322&amp;f=png&amp;s=18347" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f212adfe9ca?w=1010&amp;h=322&amp;f=png&amp;s=16794" referrerpolicy="no-referrer"></p><p><span>试试数据库存在的用户名和密码</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f213244e998?w=1010&amp;h=322&amp;f=png&amp;s=18219" referrerpolicy="no-referrer"></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f214c5634f2?w=1010&amp;h=695&amp;f=png&amp;s=22170" referrerpolicy="no-referrer"></p><hr /><h3><a name="102利用session防止表单重复提交" class="md-header-anchor"></a><span>10.2利用Session防止表单重复提交</span></h3><ul><li><p><span>重复提交的危害：</span></p><ul><li><span>在投票的网页上不停地提交，实现了刷票的效果。</span></li><li><span>注册多个用户，不断发帖子，扰乱正常发帖秩序。</span></li></ul></li><li><p><span>首先我们来看一下常见的重复提交。</span></p><ul><li><span>在处理表单的Servlet中刷新。</span></li><li><span>后退再提交</span></li><li><span>网络延迟，多次点击提交按钮</span></li></ul></li></ul><p><span>下面的gif是</span><strong><span>后退再提交</span></strong><span>，</span><strong><span>在处理提交请求的Servlet中刷新</span></strong>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f2faadc4d90?w=1220&amp;h=814&amp;f=gif&amp;s=201492" referrerpolicy="no-referrer"></p><p><span>下面的gif是</span><strong><span>网络延迟，多次点击提交按钮</span></strong>
<img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f216b3bc059?w=1220&amp;h=814&amp;f=gif&amp;s=136754" referrerpolicy="no-referrer"></p><p><span>对于网络延迟造成的多次提交数据给服务器，其实是客户端的问题。于是，我们可以使用javaScript来防止这种情况</span></p><p><span>要做的事情也非常简单：</span><strong><span>当用户第一次点击提交按钮时，把数据提交给服务器。当用户再次点击提交按钮时，就不把数据提交给服务器了。</span></strong></p><p>&nbsp;</p><p><span>监听用户提交事件。只能让用户提交一次表单！</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%@</span> <span class="cm-attribute">page</span> <span class="cm-attribute">contentType</span>=<span class="cm-string">"text/html;charset=UTF-8"</span> <span class="cm-attribute">language</span>=<span class="cm-string">"java"</span> <span class="cm-attribute">%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">title</span><span class="cm-tag cm-bracket">&gt;</span>表单提交<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">title</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text/javascript"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//定义一个全局标识量：是否已经提交过表单数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">isCommitted</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-def">doSubmit</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//false表示的是没有提交过，于是就可以让表单提交给Servlet</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">isCommitted</span><span class="cm-operator">==</span><span class="cm-atom">false</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">isCommitted</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }<span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">head</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/ouzicheng/Servlet7"</span> <span class="cm-attribute">onsubmit</span>=<span class="cm-string">"return doSubmit()"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  用户名：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"提交"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">form</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">body</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">html</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 748px;"></div><div class="CodeMirror-gutters" style="display: none; height: 748px;"></div></div></div></pre><p><span>好的，我们来试一下是不是真的可以解决网络延迟所造成的多次提交表单数据，注意鼠标，我已经点击过很多次的了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f21e9a00095?w=1220&amp;h=814&amp;f=gif&amp;s=102980" referrerpolicy="no-referrer"></p><p><span>由于网络延迟造成的多次提交数据给服务器，我们还可以使用javaScript代码这样解决：</span><strong><span>当我点击过一次提交按钮时，我就把提交的按钮隐藏起来。不能让用户点击了</span></strong><span>！</span></p><p><span>想要让按钮隐藏起来，也很简单。</span><strong><span>只要获取到按钮的节点，就可以控制按钮的隐藏或显示了！</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">script</span> <span class="cm-variable">type</span><span class="cm-operator">=</span><span class="cm-string">"text/javascript"</span><span class="cm-operator">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">function</span> <span class="cm-def">doSubmit</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">var</span> <span class="cm-def">button</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>(<span class="cm-string">"button"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-2">button</span>.<span class="cm-property">disabled</span> <span class="cm-operator">=</span> <span class="cm-variable">disabled</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-string-2">/script&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><span>我们再来看一下效果</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f21f4c44539?w=1220&amp;h=814&amp;f=gif&amp;s=124766" referrerpolicy="no-referrer"></p><p><strong><span>在处理表单的Servlet中刷新</span></strong><span>和</span><strong><span>后退再提交</span></strong><span>这两种方式不能只靠客户端来限制了。也就是说javaScript代码无法阻止这两种情况的发生。</span></p><p><span>于是乎，我们就想得用其他办法来阻止表单数据重复提交了。我们现在学了Session，</span><strong><span>Session可以用来标识一个用户是否登陆了</span></strong><span>。Session的原理也说了：</span><strong><span>不同的用户浏览器会拥有不同的Session</span></strong><span>。而request和ServletContext为什么就不行呢？</span><strong><span>request的域对象只能是一次http请求</span></strong><span>，</span><strong><span>提交表单数据的时候request域对象的数据取不出来</span></strong><span>。ServletContext代表整个web应用，</span><strong><span>如果有几个用户浏览器同时访问</span></strong><span>，</span><strong><span>ServletContext域对象的数据会被多次覆盖掉</span></strong><span>，也就是说域对象的数据就毫无意义了。</span></p><p><span>可能到这里，我们会想到：在提交数据的时候，存进Session域对象的数据，在处理提交数据的Servlet中判断Session域对象数据????。究竟判断Session什么？判断Session域对象的数据不为null？</span><strong><span>没用呀，既然已经提交过来了，那肯定不为null。</span></strong></p><ul><li><p><span>此时，我们就想到了，在</span><strong><span>表单中还有一个隐藏域，可以通过隐藏域把数据交给服务器</span></strong><span>。</span></p><ul><li><strong><span>判断Session域对象的数据和jsp隐藏域提交的数据是否对应</span></strong><span>。</span></li><li><strong><span>判断隐藏域的数据是否为空</span></strong><span>【如果为空，</span><strong><span>就是直接访问表单处理页面的Servlet</span></strong><span>】</span></li><li><strong><span>判断Session的数据是否为空</span></strong><span>【servlet判断完是否重复提交，</span><strong><span>最好能立马移除Session的数据</span></strong><span>，不然还没有移除的时候，客户端那边儿的请求又来了，就又能匹配了，产生了重复提交。</span><strong><span>如果Session域对象数据为空，证明已经提交过数据了！</span></strong><span>】</span></li></ul></li></ul><p><span>我们向Session域对象的存入数据究竟是什么呢？简单的一个数字？好像也行啊。因为</span><strong><span>只要Session域对象的数据和jsp隐藏域带过去的数据对得上号就行了呀，反正在Servlet上判断完是否重复提交，会立马把Session的数据移除掉的</span></strong><span>。更专业的做法是：</span><strong><span>向Session域对象存入的数据是一个随机数【Token--令牌</span></strong><span>】。</span></p><p><strong><span>生成一个独一无二的随机数</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">* 产生随机数就应该用一个对象来生成，这样可以避免随机数的重复。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">* 所以设计成单例</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">* */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TokenProcessor</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-variable">TokenProcessor</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">private</span> <span class="cm-keyword">final</span> <span class="cm-keyword">static</span> <span class="cm-variable">TokenProcessor</span> <span class="cm-variable">TOKEN_PROCESSOR</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">TokenProcessor</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable">TokenProcessor</span> <span class="cm-variable">getInstance</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">TOKEN_PROCESSOR</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">String</span> <span class="cm-variable">makeToken</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//这个随机生成出来的Token的长度是不确定的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">token</span> <span class="cm-operator">=</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">valueOf</span>(<span class="cm-variable">System</span>.<span class="cm-variable">currentTimeMillis</span>() <span class="cm-operator">+</span> <span class="cm-keyword">new</span> <span class="cm-variable">Random</span>().<span class="cm-variable">nextInt</span>(<span class="cm-number">99999999</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">try</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//我们想要随机数的长度一致，就要获取到数据指纹</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MessageDigest</span> <span class="cm-variable">messageDigest</span> <span class="cm-operator">=</span> <span class="cm-variable">MessageDigest</span>.<span class="cm-variable">getInstance</span>(<span class="cm-string">"md5"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">byte</span>[] <span class="cm-variable">md5</span> <span class="cm-operator">=</span> <span class="cm-variable">messageDigest</span>.<span class="cm-variable">digest</span>(<span class="cm-variable">token</span>.<span class="cm-variable">getBytes</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//如果我们直接 return  new String(md5)出去，得到的随机数会乱码。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//因为随机数是任意的01010101010，在转换成字符串的时候，会查gb2312的码表，gb2312码表不一定支持该二进制数据，得到的就是乱码</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//于是乎经过base64编码成了明文的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">BASE64Encoder</span> <span class="cm-variable">base64Encoder</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BASE64Encoder</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">base64Encoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">md5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  } <span class="cm-keyword">catch</span> (<span class="cm-variable">NoSuchAlgorithmException</span> <span class="cm-variable">e</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1056px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1056px;"></div></div></div></pre><p><strong><span>创建Token随机数，并跳转到jsp页面</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//生出随机数</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">TokenProcessor</span> <span class="cm-variable">tokenProcessor</span> <span class="cm-operator">=</span> <span class="cm-variable">TokenProcessor</span>.<span class="cm-variable">getInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">token</span> <span class="cm-operator">=</span> <span class="cm-variable">tokenProcessor</span>.<span class="cm-variable">makeToken</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//将随机数存进Session中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">setAttribute</span>(<span class="cm-string">"token"</span>, <span class="cm-variable">token</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">//跳转到显示页面</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/login.jsp"</span>).<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><strong><span>jsp隐藏域获取到Session的值</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/ouzicheng/Servlet7"</span> <span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  用户名：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"提交"</span> <span class="cm-attribute">id</span>=<span class="cm-string">"button"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">%--使用EL表达式取出session中的Token--%</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"hidden"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"token"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"${token}"</span> <span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag cm-error">form</span><span class="cm-tag cm-bracket cm-error">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p><span>在处理表单提交页面中判断：</span><strong><span>jsp隐藏域是否有值带过来，Session中的值是否为空，Session中的值和jsp隐藏域带过来的值是否相等</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">serverValue</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">getAttribute</span>(<span class="cm-string">"token"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">clientValue</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"token"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">serverValue</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">clientValue</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">serverValue</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">clientValue</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"处理请求"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//清除Session域对象数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">removeAttribute</span>(<span class="cm-string">"token"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}<span class="cm-keyword">else</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"请不要重复提交数据！"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>下面我们再来看一下,已经可以解决表单重复提交的问题了！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f223b0ef833?w=1220&amp;h=814&amp;f=gif&amp;s=206379" referrerpolicy="no-referrer"></p><p><span>实现原理是非常简单的：</span></p><ul><li><span>在session域中存储一个token</span></li><li><span>然后前台页面的隐藏域获取得到这个token</span></li><li><span>在第一次访问的时候，我们就判断seesion有没有值，如果有就比对。对比正确后我们就处理请求，接着就把session存储的数据给删除了</span></li><li><span>等到再次访问的时候，我们session就没有值了，就不受理前台的请求了！</span></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz11wqoaj3073073t8l.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h3><a name="103一次性校验码" class="md-header-anchor"></a><span>10.3一次性校验码</span></h3><p><span>一次性校验码其实就是为了</span><strong><span>防止暴力猜测密码</span></strong><span>，在讲response对象的时候，我们使用response对象输出过验证码，但是没有去验证！</span></p><p>&nbsp;</p><p><span>验证的原理也非常简单：</span><strong><span>生成验证码后，把验证码的数据存进Session域对象中，判断用户输入验证码是否和Session域对象的数据一致</span></strong><span>。</span></p><p>&nbsp;</p><p><strong><span>生成验证码图片，并将验证码存进Session域中</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//在内存中生成图片</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BufferedImage</span> <span class="cm-variable">bufferedImage</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BufferedImage</span>(<span class="cm-number">80</span>, <span class="cm-number">20</span>, <span class="cm-variable">BufferedImage</span>.<span class="cm-variable">TYPE_INT_RGB</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取到这张图片</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Graphics2D</span> <span class="cm-variable">graphics2D</span> <span class="cm-operator">=</span> (<span class="cm-variable">Graphics2D</span>) <span class="cm-variable">bufferedImage</span>.<span class="cm-variable">getGraphics</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置背景色为白色</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics2D</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">white</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics2D</span>.<span class="cm-variable">fillRect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">80</span>, <span class="cm-number">20</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//设置图片的字体和颜色</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics2D</span>.<span class="cm-variable">setFont</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Font</span>(<span class="cm-atom">null</span>, <span class="cm-variable">Font</span>.<span class="cm-variable">BOLD</span>, <span class="cm-number">20</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics2D</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">BLUE</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//生成随机数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">randomNum</span> <span class="cm-operator">=</span> <span class="cm-variable">makeNum</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//往这张图片上写数据,横坐标是0，纵坐标是20</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">graphics2D</span>.<span class="cm-variable">drawString</span>(<span class="cm-variable">randomNum</span>, <span class="cm-number">0</span>, <span class="cm-number">20</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//将随机数存进Session域中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">setAttribute</span>(<span class="cm-string">"randomNum"</span>, <span class="cm-variable">randomNum</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//控制浏览器不缓存该图片</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Expires"</span>, <span class="cm-string">"-1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Cache-Control"</span>, <span class="cm-string">"no-cache"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Pragma"</span>, <span class="cm-string">"no-cache"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//通知浏览器以图片的方式打开</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">response</span>.<span class="cm-variable">setHeader</span>(<span class="cm-string">"Content-type"</span>, <span class="cm-string">"image/jpeg"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//把图片写给浏览器</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ImageIO</span>.<span class="cm-variable">write</span>(<span class="cm-variable">bufferedImage</span>, <span class="cm-string">"jpg"</span>, <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 748px;"></div><div class="CodeMirror-gutters" style="display: none; height: 748px;"></div></div></div></pre><p><span>生成随机数的方法：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span> <span class="cm-variable-3">String</span> <span class="cm-def">makeNum</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">Random</span> <span class="cm-variable">random</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Random</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//生成0-6位的随机数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">num</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">999999</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//验证码的数位全都要6位数，于是将该随机数转换成字符串，不够位数就添加</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">String</span> <span class="cm-variable">randomNum</span> <span class="cm-operator">=</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">valueOf</span>(<span class="cm-variable">num</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//使用StringBuffer来拼凑字符串</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable-3">StringBuffer</span> <span class="cm-variable">stringBuffer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable-3">StringBuffer</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">6</span> <span class="cm-operator">-</span> <span class="cm-variable">randomNum</span>.<span class="cm-variable">length</span>(); <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">stringBuffer</span>.<span class="cm-variable">append</span>(<span class="cm-string">"0"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">stringBuffer</span>.<span class="cm-variable">append</span>(<span class="cm-variable">randomNum</span>).<span class="cm-variable">toString</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>jsp显示页面</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="html"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="html"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/ouzicheng/Login2Servlet"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  用户名：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  密码：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"password"</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  验证码：<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"randomNum"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">img</span> <span class="cm-attribute">src</span>=<span class="cm-string">"/ouzicheng/ImageServlet"</span> <span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">&gt;&lt;</span><span class="cm-tag">br</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"提交"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">form</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><span>处理提交表单数据的Servlet，</span><strong><span>判断用户带过来验证码的数据是否和Session的数据相同。</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取用户输入验证码的数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">client_randomNum</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"randomNum"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//获取Session中的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">String</span> <span class="cm-variable">session_randomNum</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">getAttribute</span>(<span class="cm-string">"randomNum"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//判断他俩数据是否相等，用户是否有输入验证码，Session中是否为空</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span> (<span class="cm-variable">client_randomNum</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">||</span> <span class="cm-variable">session_randomNum</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">||</span> <span class="cm-operator">!</span><span class="cm-variable">client_randomNum</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">session_randomNum</span>)) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"验证码错误了！！！"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">return</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//下面就是验证用户名和密码...................</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p>&nbsp;</p><p><span>显示页面是这样子的</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f22873227a9?w=1045&amp;h=392&amp;f=png&amp;s=27202" referrerpolicy="no-referrer"></p><p><span>我们来看一下效果！</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f228c490ad4?w=1220&amp;h=814&amp;f=gif&amp;s=204697" referrerpolicy="no-referrer"></p><p><span>对于校验码实现思路是这样子的：</span></p><ul><li><span>使用awt语法来描写一张验证码，生成随机数保存在seesion域中，我们让验证码不能缓存起来【做到验证码都不一样】</span></li><li><span>页面直接访问Servlet来获取我们的验证码，于是我们验证码的值就会改变【同时session的值也会被改变】</span></li><li><span>当用户验证的时候，就是session内的值的验证了。</span></li></ul><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz1m5s4ag303k03k74o.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h2><a name="11-session和cookie的区别" class="md-header-anchor"></a><span>11. Session和Cookie的区别</span></h2><ul><li><p><strong><span>从存储方式上比较</span></strong></p><ul><li><span>Cookie只能存储字符串，如果要存储非ASCII字符串还要对其编码。</span></li><li><span>Session可以存储任何类型的数据，可以把Session看成是一个容器</span></li></ul></li><li><p><strong><span>从隐私安全上比较</span></strong></p><ul><li><strong><span>Cookie存储在浏览器中，对客户端是可见的</span></strong><span>。信息容易泄露出去。如果使用Cookie，最好将Cookie加密</span></li><li><strong><span>Session存储在服务器上，对客户端是透明的</span></strong><span>。不存在敏感信息泄露问题。</span></li></ul></li><li><p><strong><span>从有效期上比较</span></strong></p><ul><li><span>Cookie保存在硬盘中，只需要设置maxAge属性为比较大的正整数，即使关闭浏览器，Cookie还是存在的</span></li><li><strong><span>Session的保存在服务器中，设置maxInactiveInterval属性值来确定Session的有效期。并且Session依赖于名为JSESSIONID的Cookie，该Cookie默认的maxAge属性为-1。如果关闭了浏览器，该Session虽然没有从服务器中消亡，但也就失效了。</span></strong></li></ul></li><li><p><strong><span>从对服务器的负担比较</span></strong></p><ul><li><span>Session是保存在服务器的，每个用户都会产生一个Session，如果是并发访问的用户非常多，是不能使用Session的，Session会消耗大量的内存。</span></li><li><span>Cookie是保存在客户端的。不占用服务器的资源。像baidu、Sina这样的大型网站，一般都是使用Cookie来进行会话跟踪。</span></li></ul></li><li><p><strong><span>从浏览器的支持上比较</span></strong></p><ul><li><span>如果浏览器禁用了Cookie，那么Cookie是无用的了！</span></li><li><span>如果浏览器禁用了Cookie，Session可以通过URL地址重写来进行会话跟踪。</span></li></ul></li></ul><ul><li><p><strong><span>从跨域名上比较</span></strong></p><ul><li><span>Cookie可以设置domain属性来实现跨域名</span></li><li><span>Session只在当前的域名内有效，不可夸域名</span></li></ul></li></ul><hr /><h2><a name="12-cookie和session共同使用" class="md-header-anchor"></a><span>12. Cookie和Session共同使用</span></h2><p><strong><span>如果仅仅使用Cookie或仅仅使用Session可能达不到理想的效果</span></strong><span>。这时应该尝试一下同时使用Session和Cookie。那么，什么时候才需要同时使用Cookie和Session呢？</span></p><p>&nbsp;</p><p><span>在上一篇博客中，我们使用了Session来进行简单的购物，功能也的确实现了。现在有一个问题：</span><strong><span>我在购物的途中，不小心关闭了浏览器。当我再返回进去浏览器的时候，发现我购买过的商品记录都没了！！为什么会没了呢？原因也非常简单：服务器为Session自动维护的Cookie的maxAge属性默认是-1的，当浏览器关闭掉了，该Cookie就自动消亡了。当用户再次访问的时候，已经不是原来的Cookie了。</span></strong></p><p>&nbsp;</p><p><span>我们现在想的是：</span><strong><span>即使我不小心关闭了浏览器了，我重新进去网站，我还能找到我的购买记录</span></strong><span>。</span></p><p><span>要实现该功能也十分简单，问题其实就在：服务器为Session自动维护的Cookie的maxAge属性是-1，Cookie没有保存在硬盘中。我现在要做的就是：</span><strong><span>把Cookie保存在硬盘中，即使我关闭了浏览器，浏览器再次访问页面的时候，可以带上Cookie，从而服务器识别出Session。</span></strong></p><p>&nbsp;</p><p><strong><span>第一种方式：</span></strong><span>只需要在处理购买页面上创建Cookie，Cookie的值是Session的id返回给浏览器即可</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"JSESSIONID"</span>,<span class="cm-variable">session</span>.<span class="cm-variable">getId</span>());</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">30</span><span class="cm-operator">*</span><span class="cm-number">60</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">cookie</span>.<span class="cm-variable">setPath</span>(<span class="cm-string">"/ouzicheng/"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><strong><span>第二种方式：</span></strong><span> </span><strong><span>在server.xml文件中配置，将每个用户的Session在服务器关闭的时候序列化到硬盘或数据库上保存</span></strong><span>。但此方法不常用，知道即可！</span></p><p>&nbsp;</p><p><span>下面看一下效果</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/4/16160f2faad988f7?w=1900&amp;h=897&amp;f=gif&amp;s=2371567" referrerpolicy="no-referrer"></p><p>&nbsp;</p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz20pp88g306o06oabm.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><h1><a name="servlet面试题" class="md-header-anchor"></a><span>Servlet面试题</span></h1><p>&nbsp;</p><p><span>下面是我整理下来的Servlet知识点:</span></p><p>&nbsp;</p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba61c25bbcc9?w=4531&amp;h=2453&amp;f=png&amp;s=791844" referrerpolicy="no-referrer"></p><p><strong><span>图上的知识点都可以在我其他的文章内找到相应内容。</span></strong></p><h2><a name="1-tomcat常见面试题" class="md-header-anchor"></a><span>1. Tomcat常见面试题</span></h2><h3><a name="11tomcat的缺省端口是多少怎么修改" class="md-header-anchor"></a><span>1.1Tomcat的缺省端口是多少，怎么修改</span></h3><blockquote><p><span>Tomcat的缺省端口是多少，怎么修改</span></p></blockquote><ol start='' ><li><span>找到Tomcat目录下的conf文件夹</span></li><li><span>进入conf文件夹里面找到server.xml文件</span></li><li><span>打开server.xml文件</span></li><li><span>在server.xml文件里面找到下列信息</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Service</span> <span class="cm-attribute">name</span>=<span class="cm-string">"Catalina"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Connector</span> <span class="cm-attribute">port</span>=<span class="cm-string">"8080"</span> <span class="cm-attribute">protocol</span>=<span class="cm-string">"HTTP/1.1"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">connectionTimeout</span>=<span class="cm-string">"20000"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-attribute">redirectPort</span>=<span class="cm-string">"8443"</span> <span class="cm-tag cm-bracket">/&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><ol start='5' ><li><span>把port=”8080″改成port=”8888″，并且保存</span></li><li><span>启动Tomcat，并且在IE浏览器里面的地址栏输入</span><a href='http://127.0.0.1:8888/' target='_blank' class='url'>http://127.0.0.1:8888/</a></li></ol><p><strong><span>到tomcat主目录下的conf/server.xml文件中修改</span></strong><span>,把8080端口改成是8088或者是其他的</span>
<img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba4fdb1dd132?w=855&amp;h=318&amp;f=png&amp;s=26183" referrerpolicy="no-referrer"></p><h3><a name="12tomcat-有哪几种connector-运行模式优化" class="md-header-anchor"></a><span>1.2Tomcat 有哪几种Connector 运行模式(优化)？</span></h3><blockquote><p><span>tomcat 有哪几种Connector 运行模式(优化)？</span></p></blockquote><ol start='' ><li><span>bio(blocking I/O)</span></li><li><span>nio(non-blocking I/O)</span></li><li><span>apr(Apache Portable Runtime/Apache可移植运行库)</span></li></ol><p><span>相关解释:</span></p><ul><li><span>bio: </span><strong><span>传统的Java I/O操作，同步且阻塞IO。</span></strong></li><li><span>nio: </span><strong><span>JDK1.4开始支持，同步阻塞或同步非阻塞IO</span></strong></li><li><span>aio(nio.2): </span><strong><span>JDK7开始支持，异步非阻塞IO</span></strong></li><li><span>apr: Tomcat将以JNI的形式调用Apache HTTP服务器的核心动态链接库来处理文件读取或网络传输操作，从而大大地 </span><strong><span>提高Tomcat对静态文件的处理性能</span></strong></li></ul><p><span>下面是</span><strong><span>配置Tomcat运行模式改成是NIO模式，并配置连接池相关参数来进行优化</span></strong><span>:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="xml" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="xml"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!--</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;Connector port="8080" protocol="HTTP/1.1"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">connectionTimeout="20000"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">redirectPort="8443" /&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!-- protocol 启用 nio模式，(tomcat8默认使用的是nio)(apr模式利用系统级异步io) --&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!-- minProcessors最小空闲连接线程数--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!-- maxProcessors最大连接线程数--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!-- acceptCount允许的最大连接数，应大于等于maxProcessors--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">&lt;!-- enableLookups 如果为true,requst.getRemoteHost会执行DNS查找，反向解析ip对应域名或主机名--&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Connector</span> <span class="cm-attribute">port</span>=<span class="cm-string">"8080"</span> <span class="cm-attribute">protocol</span>=<span class="cm-string">"org.apache.coyote.http11.Http11NioProtocol"</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">connectionTimeout</span>=<span class="cm-string">"20000"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-attribute">redirectPort</span>=<span class="cm-string">"8443</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">maxThreads=“500” </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">minSpareThreads=“100” </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">maxSpareThreads=“200”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">acceptCount="</span><span class="cm-attribute">200</span><span class="cm-string cm-error">"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-error">enableLookups="</span><span class="cm-attribute">false</span><span class="cm-string cm-error">" &nbsp; &nbsp; &nbsp; </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-error">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>apr模式启动起来是比较复杂的，详情可参考:</span><a href='http://blog.csdn.net/wanglei_storage/article/details/50225779'><span>http://blog.csdn.net/wanglei_storage/article/details/50225779</span></a></p><p><span>对于bio,nio,nio.2的理解可参考:</span><a href='http://blog.csdn.net/itismelzp/article/details/50886009'><span>http://blog.csdn.net/itismelzp/article/details/50886009</span></a></p><h2><a name="2servlet面试题" class="md-header-anchor"></a><span>2.Servlet面试题</span></h2><h3><a name="21servlet生命周期" class="md-header-anchor"></a><span>2.1Servlet生命周期</span></h3><blockquote><p><span>Servlet生命周期?</span></p></blockquote><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba5017b08de8?w=1920&amp;h=1040&amp;f=png&amp;s=88055" referrerpolicy="no-referrer"></p><p><strong><span>第一次访问</span></strong><span>Servlet，我们发现</span><strong><span>init()和service()都被调用了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba501d733248?w=400&amp;h=300&amp;f=png&amp;s=4528" referrerpolicy="no-referrer"></p><p><strong><span>第二次访问</span></strong><span>Servlet，</span><strong><span>service()被调用了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba502595cde9?w=400&amp;h=300&amp;f=png&amp;s=5783" referrerpolicy="no-referrer"></p><p><span>第三次访问Servlet，</span><strong><span>还是service()被调用了</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba502595cde9?w=400&amp;h=300&amp;f=png&amp;s=5783" referrerpolicy="no-referrer"></p><p><span>当我们</span><strong><span>关闭Tomcat服务器</span></strong><span>的时候，</span><strong><span>destroy()被调用了！</span></strong></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba5051d778ed?w=400&amp;h=300&amp;f=png&amp;s=18790" referrerpolicy="no-referrer"></p><p><span> Servlet生命周期可分为5个步骤</span></p><ol start='' ><li><strong><span>加载Servlet</span></strong><span>。当Tomcat第一次访问Servlet的时候，</span><strong><span>Tomcat会负责创建Servlet的实例</span></strong></li><li><strong><span>初始化</span></strong><span>。当Servlet被实例化后，Tomcat会</span><strong><span>调用init()方法初始化这个对象</span></strong></li><li><strong><span>处理服务</span></strong><span>。当浏览器</span><strong><span>访问Servlet</span></strong><span>的时候，Servlet </span><strong><span>会调用service()方法处理请求</span></strong></li><li><strong><span>销毁</span></strong><span>。当Tomcat关闭时或者检测到Servlet要从Tomcat删除的时候会自动调用destroy()方法，</span><strong><span>让该实例释放掉所占的资源</span></strong><span>。一个Servlet如果长时间不被使用的话，也会被Tomcat自动销毁</span></li><li><strong><span>卸载</span></strong><span>。当Servlet调用完destroy()方法后，等待垃圾回收。如果</span><strong><span>有需要再次使用这个Servlet，会重新调用init()方法进行初始化操作</span></strong><span>。</span></li></ol><p>&nbsp;</p><p><span>简单总结：</span><strong><span>只要访问Servlet，service()就会被调用。init()只有第一次访问Servlet的时候才会被调用。destroy()只有在Tomcat关闭的时候才会被调用。</span></strong></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz2dvm1xg3073073q65.gif" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a><span>。更多原创技术文章可关注我的GitHub</span></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p><h3><a name="22get方式和post方式有何区别" class="md-header-anchor"></a><span>2.2get方式和post方式有何区别</span></h3><blockquote><p><span>get方式和post方式有何区别</span></p></blockquote><p><span>数据携带上:</span></p><ul><li><span>GET方式：在URL地址后附带的参数是有限制的，其数据容量通常不能超过1K。</span></li><li><span>POST方式：可以在请求的实体内容中向服务器发送数据，传送的数据量无限制。</span></li></ul><p><span>请求参数的位置上:</span></p><ul><li><span>GET方式：请求参数放在URL地址后面，以?的方式来进行拼接</span></li><li><span>POST方式:请求参数放在HTTP请求包中</span></li></ul><p><span>用途上:</span></p><ul><li><p><span>GET方式一般用来获取数据</span></p></li><li><p><span>POST方式一般用来提交数据</span></p><ul><li><p><span>原因:</span></p><ul><li><span>首先是因为GET方式携带的数据量比较小，无法带过去很大的数量</span></li><li><span>POST方式提交的参数后台更加容易解析(使用POST方式提交的中文数据，后台也更加容易解决)</span></li><li><span>GET方式比POST方式要快</span>
<span>GET方式比POST方式要快，详情可看:</span><a href='https://www.cnblogs.com/strayling/p/3580048.html'><span>https://www.cnblogs.com/strayling/p/3580048.html</span></a></li></ul></li></ul></li></ul><h3><a name="23forward和redirect的区别" class="md-header-anchor"></a><span>2.3forward和redirect的区别</span></h3><blockquote><p><span>forward和redirect的区别</span></p></blockquote><ul><li><p><strong><span>实际发生位置不同，地址栏不同</span></strong></p><ul><li><p><span>转发是发生在服务器的</span></p><ul><li><strong><span>转发是由服务器进行跳转的</span></strong><span>，细心的朋友会发现，在转发的时候，</span><strong><span>浏览器的地址栏是没有发生变化的</span></strong><span>，在我访问Servlet111的时候，即使跳转到了Servlet222的页面，浏览器的地址还是Servlet111的。也就是说</span><strong><span>浏览器是不知道该跳转的动作，转发是对浏览器透明的</span></strong><span>。通过上面的转发时序图我们也可以发现，</span><strong><span>实现转发只是一次的http请求</span></strong><span>，</span><strong><span>一次转发中request和response对象都是同一个</span></strong><span>。这也解释了，为什么可以使用</span><strong><span>request作为域对象进行Servlet之间的通讯。</span></strong></li></ul></li><li><p><span>重定向是发生在浏览器的</span></p><ul><li><strong><span>重定向是由浏览器进行跳转的</span></strong><span>，进行重定向跳转的时候，</span><strong><span>浏览器的地址会发生变化的</span></strong><span>。曾经介绍过：实现重定向的原理是由response的状态码和Location头组合而实现的。</span><strong><span>这是由浏览器进行的页面跳转</span></strong><span>实现重定向</span><strong><span>会发出两个http请求</span></strong><span>，</span><strong><span>request域对象是无效的，因为它不是同一个request对象</span></strong></li></ul></li></ul></li><li><p><strong><span>用法不同:</span></strong></p><ul><li><p><span>很多人都搞不清楚转发和重定向的时候，</span><strong><span>资源地址究竟怎么写</span></strong><span>。有的时候要把应用名写上，有的时候不用把应用名写上。很容易把人搞晕。记住一个原则： </span><strong><span>给服务器用的直接从资源名开始写，给浏览器用的要把应用名写上</span></strong></p><ul><li><p><span>request.getRequestDispatcher(&quot;/资源名 URI&quot;).forward(request,response)</span></p><ul><li><strong><span>转发时&quot;/&quot;代表的是本应用程序的根目录【zhongfucheng】</span></strong></li></ul></li><li><p><span>response.send(&quot;/web应用/资源名 URI&quot;);</span></p><ul><li><strong><span>重定向时&quot;/&quot;代表的是webapps目录</span></strong></li></ul></li></ul></li></ul></li><li><p><strong><span>能够去往的URL的范围不一样:</span></strong></p><ul><li><strong><span>转发是服务器跳转只能去往当前web应用的资源</span></strong></li><li><strong><span>重定向是服务器跳转，可以去往任何的资源</span></strong></li></ul></li><li><p><strong><span>传递数据的类型不同</span></strong></p><ul><li><strong><span>转发的request对象可以传递各种类型的数据，包括对象</span></strong></li><li><strong><span>重定向只能传递字符串</span></strong></li></ul></li><li><p><strong><span>跳转的时间不同</span></strong></p><ul><li><strong><span>转发时：执行到跳转语句时就会立刻跳转</span></strong></li><li><strong><span>重定向：整个页面执行完之后才执行跳转</span></strong></li></ul></li></ul><p><span>那么转发(forward)和重定向(redirect)使用哪一个？</span></p><ul><li><span>根据上面说明了转发和重定向的区别也可以很容易概括出来。</span><strong><span>转发是带着转发前的请求的参数的。重定向是新的请求</span></strong><span>。</span></li></ul><p><span>典型的应用场景：</span></p><ol start='' ><li><span>转发: 访问 Servlet 处理业务逻辑，然后 forward 到 jsp 显示处理结果，浏览器里 URL 不变</span></li><li><span>重定向: 提交表单，处理成功后 redirect 到另一个 jsp，防止表单重复提交，浏览器里 URL 变了</span></li></ol><h3><a name="24-tomcat容器是如何创建servlet类实例用到了什么原理" class="md-header-anchor"></a><span>2.4 tomcat容器是如何创建servlet类实例？用到了什么原理？</span></h3><blockquote><p><span>tomcat容器是如何创建servlet类实例？用到了什么原理</span></p></blockquote><ol start='' ><li><span>当容器启动时，会读取在webapps目录下所有的web应用中的web.xml文件，然后对 </span><strong><span>xml文件进行解析，并读取servlet注册信息</span></strong><span>。然后，将每个应用中注册的servlet类都进行加载，并通过 </span><strong><span>反射的方式实例化</span></strong><span>。（有时候也是在第一次请求时实例化）</span></li><li><span>在servlet注册时加上</span><code>&lt;load-on-startup&gt;</code><span>1</span><code>&lt;/load-on-startup&gt;</code><span>如果为正数，则在一开始就实例化，如果不写或为负数，则第一次请求实例化。</span></li></ol><h3><a name="25什么是cookiesession和cookie有什么区别-" class="md-header-anchor"></a><span>2.5什么是cookie？Session和cookie有什么区别 ？</span></h3><blockquote><p><span>什么是cookie？</span></p></blockquote><p><span> Cookie是由W3C组织提出，最早由netscape社区发展的一种机制</span></p><p><span>网页之间的</span><strong><span>交互是通过HTTP协议传输数据的，</span></strong><span>而Http协议是</span><strong><span>无状态的协议</span></strong><span>。无状态的协议是什么意思呢？</span><strong><span>一旦数据提交完后，浏览器和服务器的连接就会关闭，再次交互的时候需要重新建立新的连接</span></strong><span>。</span></p><p><span>服务器无法确认用户的信息，于是乎，W3C就提出了：</span><strong><span>给每一个用户都发一个通行证，无论谁访问的时候都需要携带通行证，这样服务器就可以从通行证上确认用户的信息</span></strong><span>。通行证就是Cookie</span></p><p><img src="https://user-gold-cdn.xitu.io/2018/2/3/1615ba505779d02b?w=842&amp;h=390&amp;f=png&amp;s=20785" referrerpolicy="no-referrer"></p><blockquote><p><span>Session和cookie有什么区别？</span></p></blockquote><ul><li><p><strong><span>从存储方式上比较</span></strong></p><ul><li><span>Cookie只能存储字符串，如果要存储非ASCII字符串还要对其编码。</span></li><li><span>Session可以存储任何类型的数据，可以把Session看成是一个容器</span></li></ul></li><li><p><strong><span>从隐私安全上比较</span></strong></p><ul><li><strong><span>Cookie存储在浏览器中，对客户端是可见的</span></strong><span>。信息容易泄露出去。如果使用Cookie，最好将Cookie加密</span></li><li><strong><span>Session存储在服务器上，对客户端是透明的</span></strong><span>。不存在敏感信息泄露问题。</span></li></ul></li><li><p><strong><span>从有效期上比较</span></strong></p><ul><li><span>Cookie保存在硬盘中，只需要设置maxAge属性为比较大的正整数，即使关闭浏览器，Cookie还是存在的</span></li><li><strong><span>Session的保存在服务器中，设置maxInactiveInterval属性值来确定Session的有效期。并且Session依赖于名为JSESSIONID的Cookie，该Cookie默认的maxAge属性为-1。如果关闭了浏览器，该Session虽然没有从服务器中消亡，但也就失效了。</span></strong></li></ul></li><li><p><strong><span>从对服务器的负担比较</span></strong></p><ul><li><span>Session是保存在服务器的，每个用户都会产生一个Session，如果是并发访问的用户非常多，是不能使用Session的，Session会消耗大量的内存。</span></li><li><span>Cookie是保存在客户端的。不占用服务器的资源。像baidu、Sina这样的大型网站，一般都是使用Cookie来进行会话跟踪。</span></li></ul></li><li><p><strong><span>从浏览器的支持上比较</span></strong></p><ul><li><span>如果浏览器禁用了Cookie，那么Cookie是无用的了！</span></li><li><span>如果浏览器禁用了Cookie，Session可以通过URL地址重写来进行会话跟踪。</span></li></ul></li></ul><ul><li><p><strong><span>从跨域名上比较</span></strong></p><ul><li><span>Cookie可以设置domain属性来实现跨域名</span></li><li><span>Session只在当前的域名内有效，不可夸域名</span></li></ul></li></ul><h3><a name="26-servlet安全性问题" class="md-header-anchor"></a><span>2.6 Servlet安全性问题</span></h3><p><span>由于Servlet是单例的，当多个用户访问Servlet的时候，</span><strong><span>服务器会为每个用户创建一个线程</span></strong><span>。</span><strong><span>当多个用户并发访问Servlet共享资源的时候就会出现线程安全问题</span></strong><span>。</span></p><p><span>原则：</span></p><ol start='' ><li><span>如果一个</span><strong><span>变量需要多个用户共享</span></strong><span>，则应当在访问该变量的时候，</span><strong><span>加同步机制synchronized (对象){}</span></strong></li><li><span>如果一个变量</span><strong><span>不需要共享</span></strong><span>，则</span><strong><span>直接在 doGet() 或者 doPost()定义</span></strong><span>.这样不会存在线程安全问题</span></li></ol><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnz2wwo0lj30730743ye.jpg" referrerpolicy="no-referrer"></p><p><span>如果文档中有任何的不懂的问题，都可以直接来找我询问，我乐意帮助你们！微信搜</span><strong><span>Java3y</span></strong><span>公众号有我的</span><strong><span>联系方式</span></strong><span>。更多原创技术文章可关注我的GitHub：</span><a href='https://github.com/ZhongFuCheng3y/3y' target='_blank' class='url'>https://github.com/ZhongFuCheng3y/3y</a></p><p><img src="https://tva1.sinaimg.cn/large/00831rSTly1gcnyqyo2bnj3076076dga.jpg" referrerpolicy="no-referrer"></p></div>
</body>
</html>